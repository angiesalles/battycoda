<!DOCTYPE html>
{% load static %}
<html>
<head>
    <title>{% block title %}BattyCoda{% endblock %}</title>
    <!-- Favicons -->
    <link rel="shortcut icon" href="{% static 'img/favicon.ico' %}" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon/favicon-16x16.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="48x48" href="{% static 'img/favicon/favicon-48x48.png' %}">
    <link rel="icon" type="image/png" sizes="96x96" href="{% static 'img/favicon/favicon-96x96.png' %}">
    <link rel="icon" type="image/png" sizes="128x128" href="{% static 'img/favicon/favicon-128x128.png' %}">
    <link rel="apple-touch-icon" sizes="57x57" href="{% static 'img/favicon/apple-touch-icon-57x57.png' %}">
    <link rel="apple-touch-icon" sizes="60x60" href="{% static 'img/favicon/apple-touch-icon-60x60.png' %}">
    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'img/favicon/apple-touch-icon-76x76.png' %}">
    <link rel="apple-touch-icon" sizes="120x120" href="{% static 'img/favicon/apple-touch-icon-120x120.png' %}">
    
    <!-- Maisonnette Core CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'lib/stroke-7/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'lib/perfect-scrollbar/css/perfect-scrollbar.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'lib/font-awesome/css/font-awesome.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/app.min.css' %}">
    
    <!-- Custom BattyCoda CSS -->
    <link href="{% static 'css/main.css' %}" rel="stylesheet">
    <link href="{% static 'css/themes.css' %}" rel="stylesheet">
    
    <!-- Load theme CSS based on user preference (only if not using default theme) -->
    {% if user.profile.theme != 'default' %}
    <link id="theme-css-{{ user.profile.theme }}" rel="stylesheet" href="{% static 'css/themes/'|add:user.profile.theme|add:'.css' %}">
    {% endif %}
    
    {% block extra_css %}{% endblock %}
</head>
<body class="theme-{{ user.profile.theme|default:'default' }} {% block body_class %}{% endblock %}">
<nav id="mainNavbar" class="navbar navbar-expand-lg navbar-dark mai-top-header mb-3">
    <div id="navContainer" class="container-fluid px-4 ms-0">
        <!-- Logo and brand name -->
        <a id="navBrand" class="navbar-brand d-flex align-items-center" href="{% url 'battycoda_app:index' %}">
            <img id="navLogo" src="{% static 'img/brandmark-design.png' %}" alt="BattyCoda Logo" class="me-2" style="height: 40px;">
            <div id="navBrandText">
                <h2 id="navTitle" class="mb-0 fs-4">BattyCoda</h2>
                <p id="navSubtitle" class="small text-muted mb-0">Animal Vocalization Analysis Tool</p>
            </div>
        </a>
        
        <!-- Hamburger menu for mobile -->
        <button id="navToggler" class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" 
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        
        <!-- Navigation links and user controls -->
        <div id="navbarContent" class="collapse navbar-collapse">
            <!-- Navigation links using Maisonnette classes -->
            <ul id="navLinks" class="nav navbar-nav mai-top-nav">
                {% if user.is_authenticated %}
                <li class="nav-item">
                    <a id="navHome" class="nav-link px-3" href="{% url 'battycoda_app:index' %}">
                        <span class="s7-home me-1"></span> Home
                    </a>
                </li>
                <li class="nav-item">
                    <a id="navRecordings" class="nav-link px-3" href="{% url 'battycoda_app:recording_list' %}">
                        <span class="s7-micro me-1"></span> Recordings
                    </a>
                </li>
                <li class="nav-item">
                    <a id="navSegmentation" class="nav-link px-3" href="{% url 'battycoda_app:batch_segmentation' %}">
                        <span class="s7-scissors me-1"></span> Segmentation
                    </a>
                </li>
                <li class="nav-item">
                    <a id="navClassification" class="nav-link px-3" href="{% url 'battycoda_app:automation_home' %}">
                        <span class="s7-display1 me-1"></span> Classification
                    </a>
                </li>
                <li class="nav-item">
                    <a id="navTaskBatches" class="nav-link px-3" href="{% url 'battycoda_app:task_batch_list' %}">
                        <span class="s7-box1 me-1"></span> Task Batches
                    </a>
                </li>
                <li class="nav-item">
                    <a id="navProjects" class="nav-link px-3" href="{% url 'battycoda_app:project_list' %}">
                        <span class="s7-portfolio me-1"></span> Projects
                    </a>
                </li>
                <li class="nav-item">
                    <a id="navSpecies" class="nav-link px-3" href="{% url 'battycoda_app:species_list' %}">
                        <span class="s7-leaf me-1"></span> Species
                    </a>
                </li>
                {% if user.profile.is_admin and user.profile.group %}
                <li class="nav-item">
                    <a id="navUsers" class="nav-link px-3" href="{% url 'battycoda_app:group_users' %}">
                        <span class="s7-users me-1"></span> Users
                    </a>
                </li>
                {% endif %}
                {% if user.is_staff %}
                <li class="nav-item">
                    <a id="navAdmin" class="nav-link px-3" href="{% url 'admin:index' %}">
                        <span class="s7-tools me-1"></span> Admin
                    </a>
                </li>
                {% endif %}
                {% endif %}
            </ul>
            
            <!-- User controls using Maisonnette classes -->
            <ul id="userControls" class="navbar-nav float-lg-right mai-icons-nav">
                {% if user.is_authenticated %}
                <li class="nav-item">
                    <a id="getTaskBtn" href="{% url 'battycoda_app:get_next_task' %}" class="btn btn-success btn-sm me-3">
                        <span class="s7-next me-1"></span> Get Task
                    </a>
                </li>
                <li class="nav-item">
                    <a id="profileButton" href="{% url 'battycoda_app:edit_profile' %}" class="btn btn-outline-light btn-sm me-3">
                        <span class="s7-user me-1"></span> {{ user.username }}
                    </a>
                </li>
                
                <!-- Theme Selector Dropdown -->
                <li class="dropdown nav-item">
                    <a id="themeSelector" class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" role="button" aria-expanded="false">
                        <span class="s7-paint-bucket"></span><span class="angle-down s7-angle-down"></span>
                    </a>
                    <ul id="themeSelectorMenu" class="dropdown-menu dropdown-menu-end" aria-labelledby="themeSelector">
                        <li><h6 id="themeSelectorHeader" class="dropdown-header">Choose Theme</h6></li>
                        
                        <li><a id="theme-default" class="dropdown-item theme-switcher-link {% if user.profile.theme == 'default' %}active{% endif %}" href="#" data-theme="default">
                            <span class="theme-color-preview"></span> Default Green
                        </a></li>
                        
                        <li><a id="theme-blue-sky" class="dropdown-item theme-switcher-link {% if user.profile.theme == 'blue-sky' %}active{% endif %}" href="#" data-theme="blue-sky">
                            <span class="theme-color-preview"></span> Blue Sky
                        </a></li>
                        
                        <li><a id="theme-little-fox" class="dropdown-item theme-switcher-link {% if user.profile.theme == 'little-fox' %}active{% endif %}" href="#" data-theme="little-fox">
                            <span class="theme-color-preview"></span> Little Fox
                        </a></li>
                        
                        <li><a id="theme-night-city" class="dropdown-item theme-switcher-link {% if user.profile.theme == 'night-city' %}active{% endif %}" href="#" data-theme="night-city">
                            <span class="theme-color-preview"></span> Night City
                        </a></li>
                        
                        <li><a id="theme-orange-juice" class="dropdown-item theme-switcher-link {% if user.profile.theme == 'orange-juice' %}active{% endif %}" href="#" data-theme="orange-juice">
                            <span class="theme-color-preview"></span> Orange Juice
                        </a></li>
                        
                        <li><a id="theme-passion" class="dropdown-item theme-switcher-link {% if user.profile.theme == 'passion' %}active{% endif %}" href="#" data-theme="passion">
                            <span class="theme-color-preview"></span> Passion
                        </a></li>
                        
                        <li><a id="theme-pink-love" class="dropdown-item theme-switcher-link {% if user.profile.theme == 'pink-love' %}active{% endif %}" href="#" data-theme="pink-love">
                            <span class="theme-color-preview"></span> Pink Love
                        </a></li>
                    </ul>
                </li>
                
                <!-- Group Dropdown -->
                <li class="dropdown nav-item">
                    <a id="groupDropdown" class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" role="button" aria-expanded="false">
                        <span class="s7-users"></span><span class="angle-down s7-angle-down"></span>
                    </a>
                    <ul id="groupDropdownMenu" class="dropdown-menu dropdown-menu-end" aria-labelledby="groupDropdown">
                        <li><h6 id="groupDropdownHeader" class="dropdown-header">Your Groups</h6></li>
                        {% for membership in user.group_memberships.all %}
                        <li id="group-{{ membership.group.id }}">
                            <a class="dropdown-item {% if user.profile.group == membership.group %}active{% endif %}" 
                               href="{% url 'battycoda_app:switch_group' group_id=membership.group.id %}">
                                {{ membership.group.name }}
                                {% if membership.is_admin %}<span class="s7-shield ms-1" title="Admin"></span>{% endif %}
                                {% if user.profile.group == membership.group %}<span class="s7-check ms-2"></span>{% endif %}
                            </a>
                        </li>
                        {% empty %}
                        <li id="noGroupsMessage"><span class="dropdown-item">No groups available</span></li>
                        {% endfor %}
                        <li><hr class="dropdown-divider"></li>
                        <li id="createGroupLink"><a class="dropdown-item" href="{% url 'battycoda_app:create_group' %}">
                            <span class="s7-plus me-1"></span> Create New Group
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li id="logoutLink"><a class="dropdown-item" href="{% url 'battycoda_app:logout' %}">
                            <span class="s7-power me-1"></span> Logout
                        </a></li>
                    </ul>
                </li>
                {% else %}
                <li class="nav-item">
                    <a id="loginBtn" href="{% url 'battycoda_app:login' %}" class="nav-link">
                        <span class="s7-user me-1"></span> Login
                    </a>
                </li>
                <li class="nav-item">
                    <a id="registerBtn" href="{% url 'battycoda_app:register' %}" class="nav-link">
                        <span class="s7-add-user me-1"></span> Register
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<div id="mainContent" class="container py-3">
    {% block content %}{% endblock %}
</div>


{% block extra_js %}{% endblock %}

<!-- Maisonnette Core JS -->
<script src="{% static 'lib/jquery/jquery.min.js' %}" type="text/javascript"></script>
<script src="{% static 'lib/perfect-scrollbar/js/perfect-scrollbar.min.js' %}" type="text/javascript"></script>
<script src="{% static 'js/app.min.js' %}" type="text/javascript"></script>

<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Custom Scripts -->
<script src="{% static 'js/datetime_formatter.js' %}"></script>
<script src="{% static 'js/theme-switcher.js' %}"></script>

<script type="text/javascript">
    $(document).ready(function(){
        // Initialize Maisonnette
        App.init();
    });
</script>
</body>
</html>