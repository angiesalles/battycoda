<!DOCTYPE html>
{% load static %}
<html>
<head>
    <title>{% block title %}BattyCoda{% endblock %}</title>
    <!-- Favicons -->
    <link rel="shortcut icon" href="{% static 'img/favicon.ico' %}" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon/favicon-16x16.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="48x48" href="{% static 'img/favicon/favicon-48x48.png' %}">
    <link rel="icon" type="image/png" sizes="96x96" href="{% static 'img/favicon/favicon-96x96.png' %}">
    <link rel="icon" type="image/png" sizes="128x128" href="{% static 'img/favicon/favicon-128x128.png' %}">
    <link rel="apple-touch-icon" sizes="57x57" href="{% static 'img/favicon/apple-touch-icon-57x57.png' %}">
    <link rel="apple-touch-icon" sizes="60x60" href="{% static 'img/favicon/apple-touch-icon-60x60.png' %}">
    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'img/favicon/apple-touch-icon-76x76.png' %}">
    <link rel="apple-touch-icon" sizes="120x120" href="{% static 'img/favicon/apple-touch-icon-120x120.png' %}">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static 'css/main.css' %}" rel="stylesheet">
    <link href="{% static 'css/themes.css' %}" rel="stylesheet">
    <style>
        /* Custom styles for Bootstrap */
        .btn-success {
            background-color: #4CAF50;
            border-color: #4CAF50;
        }
        
        .btn-success:hover {
            background-color: #45a049;
            border-color: #45a049;
        }
        
        .task-button {
            padding: 10px 20px;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .task-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        
        /* Fix for browser tab title color */
        title {
            color: black !important;
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body class="theme-{{ user.profile.theme|default:'light' }}">
<nav id="mainNavbar" class="navbar navbar-expand-lg navbar-padding mb-3">
    <div id="navContainer" class="container-fluid px-4 ms-0">
        <!-- Logo and brand name -->
        <a id="navBrand" class="navbar-brand d-flex align-items-center" href="{% url 'battycoda_app:index' %}">
            <img id="navLogo" src="{% static 'img/brandmark-design.png' %}" alt="BattyCoda Logo" class="me-2" style="height: 40px;">
            <div id="navBrandText">
                <h2 id="navTitle" class="mb-0 fs-4">BattyCoda</h2>
                <p id="navSubtitle" class="small text-muted mb-0">Animal Vocalization Analysis Tool</p>
            </div>
        </a>
        
        <!-- Hamburger menu for mobile -->
        <button id="navToggler" class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" 
                aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        
        <!-- Navigation links and user controls -->
        <div id="navbarContent" class="collapse navbar-collapse">
            <!-- Navigation links (centered using flex-grow) -->
            <ul id="navLinks" class="navbar-nav flex-grow-1 justify-content-center mb-2 mb-lg-0">
                {% if user.is_authenticated %}
                <li class="nav-item">
                    <a id="navHome" class="nav-link px-3" href="{% url 'battycoda_app:index' %}">Home</a>
                </li>
                <li class="nav-item">
                    <a id="navRecordings" class="nav-link px-3" href="{% url 'battycoda_app:recording_list' %}">Recordings</a>
                </li>
                <li class="nav-item">
                    <a id="navSegmentation" class="nav-link px-3" href="{% url 'battycoda_app:batch_segmentation' %}">Segmentation</a>
                </li>
                <li class="nav-item">
                    <a id="navClassification" class="nav-link px-3" href="{% url 'battycoda_app:automation_home' %}">Classification</a>
                </li>
                <li class="nav-item">
                    <a id="navTaskBatches" class="nav-link px-3" href="{% url 'battycoda_app:task_batch_list' %}">Task Batches</a>
                </li>
                <li class="nav-item">
                    <a id="navProjects" class="nav-link px-3" href="{% url 'battycoda_app:project_list' %}">Projects</a>
                </li>
                <li class="nav-item">
                    <a id="navSpecies" class="nav-link px-3" href="{% url 'battycoda_app:species_list' %}">Species</a>
                </li>
                {% if user.profile.is_admin and user.profile.group %}
                <li class="nav-item">
                    <a id="navUsers" class="nav-link px-3" href="{% url 'battycoda_app:group_users' %}">Users</a>
                </li>
                {% endif %}
                {% if user.is_staff %}
                <li class="nav-item">
                    <a id="navAdmin" class="nav-link px-3" href="{% url 'admin:index' %}">Admin</a>
                </li>
                {% endif %}
                {% endif %}
            </ul>
            
            <!-- User controls -->
            <div id="userControls" class="d-flex align-items-center">
                {% if user.is_authenticated %}
                <a id="getTaskBtn" href="{% url 'battycoda_app:get_next_task' %}" class="btn btn-success btn-sm me-3">
                    <i class="fas fa-tasks me-1"></i> Get Task
                </a>
                <a id="profileButton" href="{% url 'battycoda_app:edit_profile' %}" class="btn btn-outline-light btn-sm me-3">
                    <i class="fas fa-user me-1"></i> {{ user.username }}
                </a>
                
                <!-- Group Dropdown -->
                <div id="groupDropdownContainer" class="dropdown">
                    <button id="groupDropdown" class="btn btn-outline-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        {% if user.profile.group %}{{ user.profile.group.name }}{% else %}No Group{% endif %}
                    </button>
                    <ul id="groupDropdownMenu" class="dropdown-menu dropdown-menu-end" aria-labelledby="groupDropdown">
                        <li><h6 id="groupDropdownHeader" class="dropdown-header">Your Groups</h6></li>
                        {% for membership in user.group_memberships.all %}
                        <li id="group-{{ membership.group.id }}">
                            <a class="dropdown-item {% if user.profile.group == membership.group %}active{% endif %}" 
                               href="{% url 'battycoda_app:switch_group' group_id=membership.group.id %}">
                                {{ membership.group.name }}
                                {% if membership.is_admin %}<i class="fas fa-user-shield ms-1" title="Admin"></i>{% endif %}
                                {% if user.profile.group == membership.group %}<i class="fas fa-check ms-2"></i>{% endif %}
                            </a>
                        </li>
                        {% empty %}
                        <li id="noGroupsMessage"><span class="dropdown-item">No groups available</span></li>
                        {% endfor %}
                        <li><hr class="dropdown-divider"></li>
                        <li id="createGroupLink"><a class="dropdown-item" href="{% url 'battycoda_app:create_group' %}">
                            <i class="fas fa-plus-circle me-1"></i> Create New Group
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li id="logoutLink"><a class="dropdown-item" href="{% url 'battycoda_app:logout' %}">
                            <i class="fas fa-sign-out-alt me-1"></i> Logout
                        </a></li>
                    </ul>
                </div>
                {% else %}
                <a id="loginBtn" href="{% url 'battycoda_app:login' %}" class="btn btn-outline-light btn-sm me-2">
                    <i class="fas fa-sign-in-alt me-1"></i> Login
                </a>
                <a id="registerBtn" href="{% url 'battycoda_app:register' %}" class="btn btn-light btn-sm">
                    <i class="fas fa-user-plus me-1"></i> Register
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</nav>

<div id="mainContent" class="container py-3">
    {% block content %}{% endblock %}
</div>


{% block extra_js %}{% endblock %}

<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Date formatting script -->
<script src="{% static 'js/datetime_formatter.js' %}"></script>
</body>
</html>