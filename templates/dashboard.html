{% extends 'base.html' %}
{% load battycoda_tags %}

{% block title %}BattyCoda - Dashboard{% endblock %}

{% block content %}
<div class="main-content container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="page-title-box">
                <h4 class="page-title">Dashboard</h4>
            </div>
        </div>
    </div>

    <!-- Stats overview section -->
    <div class="row">
        <div class="col-lg-7 mb-4">
            <div class="widget-indicators">
                <div class="indicator-item">
                    <div class="indicator-item-icon">
                        <div class="icon"><span class="s7-micro"></span></div>
                    </div>
                    <div class="indicator-item-value">
                        <span class="indicator-value-counter">{{ total_recordings }}</span>
                        <div class="indicator-value-title">Recordings</div>
                    </div>
                    <div class="indicator-link text-right">
                        <a href="{% url 'battycoda_app:recording_list' %}">View <span class="s7-angle-right"></span></a>
                    </div>
                </div>
                <div class="indicator-item">
                    <div class="indicator-item-icon">
                        <div class="icon"><span class="s7-box1"></span></div>
                    </div>
                    <div class="indicator-item-value">
                        <span class="indicator-value-counter">{{ total_batches }}</span>
                        <div class="indicator-value-title">Task Batches</div>
                    </div>
                    <div class="indicator-link text-right">
                        <a href="{% url 'battycoda_app:task_batch_list' %}">View <span class="s7-angle-right"></span></a>
                    </div>
                </div>
                <div class="indicator-item">
                    <div class="indicator-item-icon">
                        <div class="icon"><span class="s7-leaf"></span></div>
                    </div>
                    <div class="indicator-item-value">
                        <span class="indicator-value-counter">{{ total_species }}</span>
                        <div class="indicator-value-title">Species</div>
                    </div>
                    <div class="indicator-link text-right">
                        <a href="{% url 'battycoda_app:species_list' %}">View <span class="s7-angle-right"></span></a>
                    </div>
                </div>
                <div class="indicator-item">
                    <div class="indicator-item-icon">
                        <div class="icon"><span class="s7-portfolio"></span></div>
                    </div>
                    <div class="indicator-item-value">
                        <span class="indicator-value-counter">{{ total_projects }}</span>
                        <div class="indicator-value-title">Projects</div>
                    </div>
                    <div class="indicator-link text-right">
                        <a href="{% url 'battycoda_app:project_list' %}">View <span class="s7-angle-right"></span></a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="col-lg-5 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title"><span class="s7-rocket mr-2"></span>Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'battycoda_app:recording_list' %}" class="btn btn-primary btn-block mb-3">
                                <span class="s7-micro mr-2"></span>Manage Recordings
                            </a>
                            <a href="{% url 'battycoda_app:batch_segmentation' %}" class="btn btn-secondary btn-block">
                                <span class="s7-scissors mr-2"></span>Segmentation
                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'battycoda_app:automation_home' %}" class="btn btn-info btn-block mb-3">
                                <span class="s7-display1 mr-2"></span>Run Classification
                            </a>
                            <a href="{% url 'battycoda_app:get_next_task' %}" class="btn btn-success btn-block">
                                <span class="s7-next mr-2"></span>Get Next Task
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Active Jobs -->
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title"><span class="s7-display mr-2"></span>Active Jobs</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="widget-indicator">
                                <div class="indicator-item">
                                    <div class="indicator-item-icon">
                                        <div class="icon"><span class="s7-scissors"></span></div>
                                    </div>
                                    <div class="indicator-item-value">
                                        <span class="indicator-value-counter">{{ active_segmentations }}</span>
                                        <span class="indicator-value-title">Segmentations</span>
                                    </div>
                                </div>
                                {% if active_segmentations > 0 %}
                                <div class="indicator-link text-right">
                                    <a href="{% url 'battycoda_app:batch_segmentation' %}">View <span class="s7-angle-right"></span></a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="widget-indicator">
                                <div class="indicator-item">
                                    <div class="indicator-item-icon">
                                        <div class="icon"><span class="s7-display1"></span></div>
                                    </div>
                                    <div class="indicator-item-value">
                                        <span class="indicator-value-counter">{{ active_classifications }}</span>
                                        <span class="indicator-value-title">Classifications</span>
                                    </div>
                                </div>
                                {% if active_classifications > 0 %}
                                <div class="indicator-link text-right">
                                    <a href="{% url 'battycoda_app:automation_home' %}">View <span class="s7-angle-right"></span></a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Items -->
    <div class="row">
        <!-- Recent Recordings -->
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title"><span class="s7-micro mr-2"></span>Recent Recordings</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover table-dark-header">
                            <thead>
                                <tr>
                                    <th>Recording</th>
                                    <th>Species</th>
                                    <th>Segments</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for recording in recent_recordings %}
                                <tr>
                                    <td><a href="{% url 'battycoda_app:recording_detail' recording.id %}">{{ recording.name }}</a></td>
                                    <td>{{ recording.species.name }}</td>
                                    <td>{{ recording.segments.count }}</td>
                                    <td>{{ recording.created_at|date:"M d, Y" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center">No recordings yet</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer text-right">
                    <a href="{% url 'battycoda_app:recording_list' %}" class="btn btn-sm btn-primary">View All <span class="s7-angle-right"></span></a>
                </div>
            </div>
        </div>
        
        <!-- Recent Task Batches -->
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title"><span class="s7-box1 mr-2"></span>Recent Task Batches</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover table-dark-header">
                            <thead>
                                <tr>
                                    <th>Batch</th>
                                    <th>Species</th>
                                    <th>Tasks</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for batch in recent_batches %}
                                <tr>
                                    <td><a href="{% url 'battycoda_app:task_batch_detail' batch.id %}">{{ batch.name }}</a></td>
                                    <td>{{ batch.species.name }}</td>
                                    <td>{{ batch.tasks.count }}</td>
                                    <td>{{ batch.created_at|date:"M d, Y" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center">No task batches yet</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer text-right">
                    <a href="{% url 'battycoda_app:task_batch_list' %}" class="btn btn-sm btn-success">View All <span class="s7-angle-right"></span></a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Recent Classifications -->
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title"><span class="s7-display1 mr-2"></span>Recent Classifications</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover table-dark-header">
                            <thead>
                                <tr>
                                    <th>Run</th>
                                    <th>Classifier</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for run in recent_runs %}
                                <tr>
                                    <td><a href="{% url 'battycoda_app:detection_run_detail' run.id %}">{{ run.name }}</a></td>
                                    <td>{{ run.classifier.name }}</td>
                                    <td>
                                        <span class="badge {% if run.status == 'completed' %}badge-success{% elif run.status == 'failed' %}badge-danger{% else %}badge-warning{% endif %}">
                                            {{ run.status|title }}
                                        </span>
                                    </td>
                                    <td>{{ run.created_at|date:"M d, Y" }}</td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="4" class="text-center">No classification runs yet</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer text-right">
                    <a href="{% url 'battycoda_app:automation_home' %}" class="btn btn-sm btn-info">View All <span class="s7-angle-right"></span></a>
                </div>
            </div>
        </div>
        
        <!-- Recent Species & Projects -->
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="species-tab" data-toggle="tab" href="#species-tab-content" role="tab" aria-controls="species-tab-content" aria-selected="true">
                                <span class="s7-leaf mr-2"></span>Species
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="projects-tab" data-toggle="tab" href="#projects-tab-content" role="tab" aria-controls="projects-tab-content" aria-selected="false">
                                <span class="s7-portfolio mr-2"></span>Projects
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="card-body p-0">
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="species-tab-content" role="tabpanel" aria-labelledby="species-tab">
                            <div class="table-responsive">
                                <table class="table table-hover table-dark-header">
                                    <thead>
                                        <tr>
                                            <th>Species</th>
                                            <th>Call Types</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for species in recent_species %}
                                        <tr>
                                            <td><a href="{% url 'battycoda_app:species_detail' species.id %}">{{ species.name }}</a></td>
                                            <td>{{ species.calls.count }}</td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="2" class="text-center">No species yet</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            <div class="card-footer text-right">
                                <a href="{% url 'battycoda_app:species_list' %}" class="btn btn-sm btn-warning">View All <span class="s7-angle-right"></span></a>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="projects-tab-content" role="tabpanel" aria-labelledby="projects-tab">
                            <div class="table-responsive">
                                <table class="table table-hover table-dark-header">
                                    <thead>
                                        <tr>
                                            <th>Project</th>
                                            <th>Recordings</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for project in recent_projects %}
                                        <tr>
                                            <td><a href="{% url 'battycoda_app:project_detail' project.id %}">{{ project.name }}</a></td>
                                            <td>{{ project.recordings.count }}</td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="2" class="text-center">No projects yet</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            <div class="card-footer text-right">
                                <a href="{% url 'battycoda_app:project_list' %}" class="btn btn-sm btn-danger">View All <span class="s7-angle-right"></span></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}