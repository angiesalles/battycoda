{% extends 'base.html' %}
{% load battycoda_tags %}
{% load static %}

{% block title %}BattyCoda - Task Annotation - {{ task.id }}{% endblock %}

{% block content %}
<div class="container-fluid py-3">
    <div class="task-info-bar mb-4 p-3 rounded shadow-sm" style="background-color: #262626;">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="mb-0">Task #{{ task.id }}</h2>
                <small class="text-light">{{ species }} - {{ wav_path }} ({{ task.onset|floatformat:2 }}s - {{ task.offset|floatformat:2 }}s)</small>
            </div>
            <div>
                <a href="{% url 'battycoda_app:task_list' %}" class="btn btn-outline-secondary me-2">Back to Tasks</a>
                <a href="{% url 'battycoda_app:get_last_task' %}" class="btn btn-outline-info me-2">Last Task</a>
                <a href="{% url 'battycoda_app:get_next_task' %}" class="btn btn-outline-primary">Skip to Next Task</a>
            </div>
        </div>
    </div>

    <div class="grid-container">
        <!-- Small spectrogram section -->
        <div class="spectrogram-small">
            <h3>Spectrogram</h3>
            <div id="spectrogram-container" class="mb-3">
                <div class="d-flex justify-content-center align-items-center spectrogram-container">
                    <div class="loading-spinner" id="spectrogram-loader">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <div class="mt-2">Loading spectrogram...</div>
                    </div>
                    <img id="spectrogram" alt="Spectrogram" style="display: none;">
                </div>
            </div>
        </div>
        
        <!-- Controls section -->
        <div class="controls">
            <div class="mb-2">
                <label for="contrast">Contrast:</label>
                <input type="text" id="contrast" name="contrast" class="form-control" value="4.0">
            </div>
            <div class="mb-2">
                <label for="loudness">Loudness:</label>
                <input type="text" id="loudness" name="loudness" class="form-control" value="1.0">
            </div>
            <div class="mb-2">
                <label for="channel-selector">Main channel:</label>
                <select class="form-select" id="channel-selector">
                    <option value="0">Channel 1</option>
                    <option value="1">Channel 2</option>
                </select>
            </div>
            
            <div class="button-group mt-3">
                <button class="btn btn-secondary" id="update-btn">Update View</button>
            </div>
            
            <div class="mt-3">
                <div class="btn-group" role="group">
                    <button class="btn btn-outline-secondary" id="overview-btn">Overview</button>
                    <button class="btn btn-outline-secondary active" id="detail-btn">Detail</button>
                </div>
            </div>
        </div>
        
        <!-- Call type section with form -->
        <div class="call-type">
            <form method="post" id="task-form">
                {% csrf_token %}
                <h3>Task Classification</h3>
                
                <div class="mb-3">
                    <p><strong>Task ID:</strong> #{{ task.id }}</p>
                    <p><strong>Species:</strong> {{ species }}</p>
                    <p><strong>Project:</strong> {{ task.project }}</p>
                    <p><strong>Segment:</strong> {{ task.onset|floatformat:2 }}s - {{ task.offset|floatformat:2 }}s</p>
                </div>
                
                <h4 class="mt-4">Select Label</h4>
                
                <!-- Dynamic call types from the species text file -->
                {% if call_types %}
                    {% for call_type in call_types %}
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" id="{{ call_type|slugify }}" name="type_call" value="{{ call_type }}">
                        <label class="form-check-label" for="{{ call_type|slugify }}" 
                               title="{{ call_descriptions|get_item:call_type }}">
                            {{ call_type }}
                        </label>
                    </div>
                    {% endfor %}
                {% else %}
                    <!-- Default options if no call types found -->
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" id="correct" name="type_call" value="correct">
                        <label class="form-check-label" for="correct">Correctly classified</label>
                    </div>
                    
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" id="Unsure" name="type_call" value="Unsure">
                        <label class="form-check-label" for="Unsure">Unsure</label>
                    </div>
                {% endif %}
                
                <!-- Unknown option before Other -->
                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" id="Unknown" name="type_call" value="Unknown" checked>
                    <label class="form-check-label" for="Unknown">Unknown</label>
                </div>
                
                <!-- Always include Other option -->
                <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" id="Other" name="type_call" value="">
                    <label class="form-check-label" for="Other">Other:</label>
                    <input type="text" class="form-control mt-1" id="other-input" name="other_call">
                </div>
                
                <div class="mt-4">
                    <button type="submit" name="mark_done" class="btn btn-success btn-lg w-100">
                        Mark as Done with Selected Label
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Large spectrogram section -->
        <div class="spectrogram-large">
            <h3>Detailed View</h3>
            <div id="spectrogram-large-container" class="mb-3">
                <div class="d-flex justify-content-center align-items-center spectrogram-container">
                    <div class="loading-spinner" id="spectrogram-large-loader">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <div class="mt-2">Loading detailed view...</div>
                    </div>
                    <img id="spectrogram-large" alt="Detailed Spectrogram" style="display: none;">
                </div>
            </div>
        </div>
        
        <!-- Species template section -->
        <div class="confidence">
            <h3>Species Template</h3>
            <div class="mt-3">
                <div id="species-template-container">
                    <div class="loading-spinner" id="species-image-loader">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <div class="mt-2">Loading template...</div>
                    </div>
                    {% if species_obj and species_obj.image %}
                        <img id="species-template" class="img-fluid" alt="Species Template" 
                             src="{{ species_obj.image.url }}" 
                             style="display: none;"
                             onload="document.getElementById('species-image-loader').style.display = 'none'; this.style.display = 'block';"
                             onerror="document.getElementById('species-image-loader').style.display = 'none'; this.style.display = 'block'; this.src='{% static 'broken_image.png' %}';">
                    {% else %}
                        <img id="species-template" class="img-fluid" alt="Species Template" 
                             src="{% static 'broken_image.png' %}" 
                             style="display: none;"
                             onload="document.getElementById('species-image-loader').style.display = 'none'; this.style.display = 'block';">
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Audio section -->
        <div class="audio-section">
            <h3>Audio Playback</h3>
            <div class="mt-2">
                <p>Short clip:</p>
                <audio controls id="audio-player" preload="none" class="w-100">
                    Your browser does not support the audio element.
                </audio>
            </div>
            
            <div class="mt-3">
                <p>Long clip:</p>
                <audio controls id="audio-player-long" preload="none" class="w-100">
                    Your browser does not support the audio element.
                </audio>
            </div>
        </div>
        
        <!-- Other channels section -->
        <div class="others">
            <h3>Other Channels</h3>
            <div class="other-channels-content" id="other-channels-container">
                <!-- Will be filled dynamically -->
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // File information
        const wavPath = "{{ full_path }}";
        const fileHash = "{{ file_hash }}";
        
        // For compatibility with the original code, we'll use a fixed call index 
        // to represent the task's segment
        const currentCall = 0;
        const totalCalls = 1;  // Each task represents one segment to classify
        
        console.log("Loading WAV file:", wavPath);
        console.log("File hash:", fileHash);
        
        // Current state
        let currentChannel = 0;
        let contrastValue = 4.0;
        let loudnessValue = 1.0;
        let overviewMode = false;
        
        // UI elements
        const spectrogramImg = document.getElementById('spectrogram');
        const spectrogramLargeImg = document.getElementById('spectrogram-large');
        const channelSelector = document.getElementById('channel-selector');
        const contrastInput = document.getElementById('contrast');
        const loudnessInput = document.getElementById('loudness');
        const overviewBtn = document.getElementById('overview-btn');
        const detailBtn = document.getElementById('detail-btn');
        const updateBtn = document.getElementById('update-btn');
        const audioPlayer = document.getElementById('audio-player');
        const audioPlayerLong = document.getElementById('audio-player-long');
        const otherChannelsContainer = document.getElementById('other-channels-container');
        
        // Helper function to load images with proper async handling
        function loadImageAsync(url, imgElement, loaderId, containerSelector, description) {
            // Show loader
            const loader = document.getElementById(loaderId);
            if (loader) {
                loader.style.display = 'block';
            }
            if (imgElement) {
                imgElement.style.display = 'none';
            }
            
            console.log(`Loading ${description} from:`, url);
            
            // Add async=true to URL if not already there
            let asyncUrl = url;
            if (!asyncUrl.includes('async=')) {
                asyncUrl += (asyncUrl.includes('?') ? '&' : '?') + 'async=true';
            }
            
            // Make the fetch request
            return fetch(asyncUrl)
                .then(response => {
                    // Check if response is JSON (async task) or image (direct result)
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        // This is an async task response
                        return response.json().then(data => {
                            if (data.status === 'queued' && data.task_id) {
                                // Start polling for task completion
                                console.log(`${description} generation queued. Task ID:`, data.task_id);
                                pollTaskStatus(data.poll_url, imgElement, loaderId, containerSelector, description);
                                return null; // No immediate image
                            } else {
                                throw new Error('Unexpected async response: ' + JSON.stringify(data));
                            }
                        });
                    } else if (contentType && contentType.includes('image/')) {
                        // Direct image response
                        return response.blob().then(blob => {
                            return URL.createObjectURL(blob);
                        });
                    } else {
                        throw new Error('Unexpected content type: ' + contentType);
                    }
                })
                .then(imageUrl => {
                    if (imageUrl) {
                        // We have a direct image URL
                        console.log(`${description} loaded successfully`);
                        if (imgElement) {
                            imgElement.src = imageUrl;
                            imgElement.style.display = 'block';
                        }
                        if (loader) {
                            loader.style.display = 'none';
                        }
                    }
                    // If null, we're polling for task completion
                    return imageUrl;
                })
                .catch(error => {
                    console.error(`Failed to load ${description}:`, error);
                    // Show error message
                    if (containerSelector) {
                        const container = document.querySelector(containerSelector);
                        if (container) {
                            const errorDiv = document.createElement('div');
                            errorDiv.className = 'alert alert-danger';
                            errorDiv.textContent = `Failed to load ${description}: ${error.message}`;
                            container.appendChild(errorDiv);
                        }
                    }
                    if (loader) {
                        loader.style.display = 'none';
                    }
                    return null;
                });
        }
        
        // Simplified polling function that works with our reusable pattern
        function pollTaskStatus(pollUrl, imgElement, loaderId, containerSelector, description) {
            console.log(`Polling task status for ${description}:`, pollUrl);
            
            const pollInterval = setInterval(() => {
                fetch(pollUrl)
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            // Task completed successfully
                            clearInterval(pollInterval);
                            
                            if (data.file_path) {
                                console.log(`${description} task completed with file:`, data.file_path);
                                if (imgElement) {
                                    const img = new Image();
                                    img.onload = function() {
                                        imgElement.src = this.src;
                                        imgElement.style.display = 'block';
                                        if (loaderId) {
                                            const loader = document.getElementById(loaderId);
                                            if (loader) loader.style.display = 'none';
                                        }
                                    };
                                    img.onerror = function(e) {
                                        console.error(`Failed to load completed ${description}:`, e);
                                        if (loaderId) {
                                            const loader = document.getElementById(loaderId);
                                            if (loader) loader.style.display = 'none';
                                        }
                                    };
                                    img.src = data.file_path;
                                }
                            } else {
                                console.error(`Task completed but no file path provided for ${description}`);
                            }
                        } else if (data.status === 'error') {
                            // Task failed
                            clearInterval(pollInterval);
                            console.error(`Task failed for ${description}:`, data.message);
                            
                            // Show error message
                            if (containerSelector) {
                                const container = document.querySelector(containerSelector);
                                if (container) {
                                    const errorDiv = document.createElement('div');
                                    errorDiv.className = 'alert alert-danger';
                                    errorDiv.textContent = `Error generating ${description}: ${data.message}`;
                                    container.appendChild(errorDiv);
                                }
                            }
                            
                            // Hide loader
                            if (loaderId) {
                                const loader = document.getElementById(loaderId);
                                if (loader) loader.style.display = 'none';
                            }
                        }
                        // For pending or processing states, just continue polling
                    })
                    .catch(error => {
                        console.error(`Error polling task status for ${description}:`, error);
                        // Don't clear the interval, keep trying
                    });
            }, 1000); // Poll every second
            
            // Return the interval ID for potential cleanup
            return pollInterval;
        }
        
        // Load spectrogram
        function loadSpectrogram() {
            // Build URLs for spectrograms
            const spectrogramUrl = `{% url 'battycoda_app:spectrogram' %}?wav_path=${encodeURIComponent(wavPath)}&call=${currentCall}&channel=${currentChannel}&numcalls=${totalCalls}&hash=${fileHash}&overview=${overviewMode ? '1' : '0'}&contrast=${contrastValue}&onset={{ task.onset }}&offset={{ task.offset }}`;
            
            const spectrogramLargeUrl = `{% url 'battycoda_app:spectrogram' %}?wav_path=${encodeURIComponent(wavPath)}&call=${currentCall}&channel=${currentChannel}&numcalls=${totalCalls}&hash=${fileHash}&overview=0&contrast=${contrastValue}&detail=1&onset={{ task.onset }}&offset={{ task.offset }}`;
            
            // Load main spectrogram with our reusable function
            loadImageAsync(
                spectrogramUrl,
                spectrogramImg,
                'spectrogram-loader',
                '.spectrogram-small',
                'main spectrogram'
            );
            
            // Load detailed spectrogram with our reusable function
            loadImageAsync(
                spectrogramLargeUrl,
                spectrogramLargeImg,
                'spectrogram-large-loader',
                '.spectrogram-large',
                'detailed spectrogram'
            );
            
            // Load other channels
            loadOtherChannels();
        }
        
        // No need for the old pollTaskStatus function as it's been replaced by the new one above
        
        // Load audio
        function loadAudio() {
            // Clear any previous errors
            const errorContainers = document.querySelectorAll('.audio-error');
            errorContainers.forEach(container => container.remove());
            
            // Build URL for short audio snippet
            const audioUrl = `{% url 'battycoda_app:audio_snippet' %}?wav_path=${encodeURIComponent(wavPath)}&call=${currentCall}&channel=${currentChannel}&hash=${fileHash}&overview=False&loudness=${loudnessValue}&onset={{ task.onset }}&offset={{ task.offset }}`;
            
            // Build URL for long audio snippet
            const audioLongUrl = `{% url 'battycoda_app:audio_snippet' %}?wav_path=${encodeURIComponent(wavPath)}&call=${currentCall}&channel=${currentChannel}&hash=${fileHash}&overview=True&loudness=${loudnessValue}&onset={{ task.onset }}&offset={{ task.offset }}`;
            
            console.log("Loading short audio from:", audioUrl);
            console.log("Loading long audio from:", audioLongUrl);
            
            // Fetch short audio with proper error handling
            fetch(audioUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Server returned ${response.status}: ${response.statusText}`);
                    }
                    return response.blob();
                })
                .then(blob => {
                    const audioObjectURL = URL.createObjectURL(blob);
                    audioPlayer.src = audioObjectURL;
                    audioPlayer.load();
                    console.log("Short audio loaded successfully");
                })
                .catch(error => {
                    console.error("Error loading short audio:", error);
                    const container = document.querySelector('.audio-section');
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'alert alert-danger mt-2 audio-error';
                    errorDiv.textContent = 'Failed to load audio snippet: ' + error.message;
                    container.appendChild(errorDiv);
                });
            
            // Fetch long audio with proper error handling
            fetch(audioLongUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Server returned ${response.status}: ${response.statusText}`);
                    }
                    return response.blob();
                })
                .then(blob => {
                    const audioObjectURL = URL.createObjectURL(blob);
                    audioPlayerLong.src = audioObjectURL;
                    audioPlayerLong.load();
                    console.log("Long audio loaded successfully");
                })
                .catch(error => {
                    console.error("Error loading long audio:", error);
                    // We don't show this error in the UI as it's less important
                });
        }
        
        // Load other channels
        function loadOtherChannels() {
            otherChannelsContainer.innerHTML = '';
            
            // Get all channels except the main one
            const maxChannels = 2; // This should be determined from the WAV file
            for (let i = 0; i < maxChannels; i++) {
                if (i != currentChannel) {
                    const channelUrl = `{% url 'battycoda_app:spectrogram' %}?wav_path=${encodeURIComponent(wavPath)}&call=${currentCall}&channel=${i}&numcalls=${totalCalls}&hash=${fileHash}&overview=0&contrast=${contrastValue}&onset={{ task.onset }}&offset={{ task.offset }}`;
                    
                    const container = document.createElement('div');
                    container.className = 'mb-3';
                    
                    const title = document.createElement('p');
                    title.textContent = `Channel ${i+1}:`;
                    container.appendChild(title);
                    
                    const imgContainer = document.createElement('div');
                    imgContainer.className = 'spectrogram-container';
                    container.appendChild(imgContainer);
                    
                    // Add loading spinner
                    const loadingSpinner = document.createElement('div');
                    loadingSpinner.className = 'loading-spinner';
                    loadingSpinner.innerHTML = `
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <div class="mt-2">Loading channel ${i+1}...</div>
                    `;
                    loadingSpinner.id = `channel-${i}-loader`;
                    imgContainer.appendChild(loadingSpinner);
                    
                    // Create image but don't set src yet
                    const img = document.createElement('img');
                    img.alt = `Channel ${i+1} Spectrogram`;
                    img.style.display = 'none';
                    img.id = `channel-${i}-img`;
                    imgContainer.appendChild(img);
                    
                    otherChannelsContainer.appendChild(container);
                    
                    // Use our reusable function to load the image
                    loadImageAsync(
                        channelUrl,
                        img,
                        `channel-${i}-loader`,
                        null,  // No container for error messages, they will show in the loader
                        `channel ${i+1} spectrogram`
                    );
                }
            }
        }
        
        // Event handlers
        channelSelector.addEventListener('change', function() {
            currentChannel = parseInt(this.value);
            loadSpectrogram();
            loadAudio();
        });
        
        updateBtn.addEventListener('click', function(e) {
            e.preventDefault();
            contrastValue = parseFloat(contrastInput.value);
            loudnessValue = parseFloat(loudnessInput.value);
            loadSpectrogram();
            loadAudio();
        });
        
        overviewBtn.addEventListener('click', function() {
            overviewMode = true;
            overviewBtn.classList.add('active');
            detailBtn.classList.remove('active');
            loadSpectrogram();
            loadAudio();
        });
        
        detailBtn.addEventListener('click', function() {
            overviewMode = false;
            detailBtn.classList.add('active');
            overviewBtn.classList.remove('active');
            loadSpectrogram();
            loadAudio();
        });
        
        // Radio button for "Other" option
        const otherRadio = document.getElementById('Other');
        const otherInput = document.getElementById('other-input');
        
        // When the "Other" input receives focus, also select the "Other" radio button
        otherInput.addEventListener('focus', function() {
            otherRadio.checked = true;
        });
        
        // Initialize the page
        loadSpectrogram();
        loadAudio();
    });
</script>

<style>
    /* Apply dark theme */
    body {
        background-color: #121212;
        color: #e0e0e0;
    }
    
    /* Improved grid layout for better spacing */
    .grid-container {
        display: grid;
        grid-template-columns: minmax(0, 2fr) minmax(0, 1fr) minmax(0, 1fr);
        grid-template-rows: auto auto auto auto;
        gap: 20px;
        margin-bottom: 20px;
        width: 100%;
    }
    
    /* Main sections */
    .spectrogram-small {
        grid-column: 1;
        grid-row: 1;
        width: 100%;
    }
    
    .controls {
        grid-column: 2;
        grid-row: 1;
        width: 100%;
    }
    
    .call-type {
        grid-column: 3;
        grid-row: 1 / span 2; /* Make it span both rows to have enough height */
        width: 100%;
        overflow-y: visible;
    }
    
    .spectrogram-large {
        grid-column: 1;
        grid-row: 2;
        width: 100%;
    }
    
    .confidence {
        grid-column: 1;
        grid-row: 3;
        width: 100%;
    }
    
    .audio-section {
        grid-column: 2;
        grid-row: 3;
        width: 100%;
    }
    
    .others {
        grid-column: 1 / span 3;
        grid-row: 4;
        width: 100%;
    }
    
    /* Ensure images and containers are sized properly */
    img {
        max-width: 100%;
        height: auto;
        border-radius: 4px;
        object-fit: contain;
    }
    
    .spectrogram-container {
        min-height: 300px;
        width: 100%;
        overflow: visible;
    }
    
    .form-check {
        margin-bottom: 0.5rem;
    }
    
    /* Make headers consistent */
    h3 {
        font-size: 1.25rem;
        margin-bottom: 0.75rem;
        color: #fff;
    }
    
    /* Other styling */
    .button-group button {
        margin-right: 5px;
        margin-bottom: 5px;
    }
    
    .other-channels-content {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .other-channels-content > div {
        flex: 1 1 300px;
        max-width: 350px;
    }
    
    /* Dark card-like appearance for sections */
    .spectrogram-small, .controls, .call-type, 
    .spectrogram-large, .confidence, .audio-section, .others {
        background-color: #1e1e1e;
        border-radius: 4px;
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }
    
    /* Override Bootstrap form control styles for dark theme */
    .form-control, .form-select {
        background-color: #2d2d2d;
        border: 1px solid #444;
        color: #e0e0e0;
    }
    
    .form-control:focus, .form-select:focus {
        background-color: #333;
        color: #fff;
        border-color: #007bff;
    }
    
    /* Override Bootstrap button styles */
    .btn-outline-secondary {
        color: #adb5bd;
        border-color: #495057;
    }
    
    .btn-outline-secondary:hover,
    .btn-outline-secondary.active {
        color: #fff;
        background-color: #495057;
        border-color: #6c757d;
    }
    
    .btn-outline-info {
        color: #0dcaf0;
        border-color: #0dcaf0;
    }
    
    .btn-outline-info:hover,
    .btn-outline-info.active {
        color: #000;
        background-color: #0dcaf0;
        border-color: #0dcaf0;
    }
    
    /* Loading spinner styling */
    .loading-spinner {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 200px;
        width: 100%;
    }
    
    /* Mobile responsiveness */
    @media (max-width: 992px) {
        .grid-container {
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto auto auto;
        }
        
        .spectrogram-small {
            grid-column: 1 / span 2;
            grid-row: 1;
        }
        
        .controls {
            grid-column: 1;
            grid-row: 2;
        }
        
        .spectrogram-large {
            grid-column: 1 / span 2;
            grid-row: 3;
        }
        
        .call-type {
            grid-column: 2;
            grid-row: 2;
        }
        
        .confidence {
            grid-column: 1;
            grid-row: 4;
        }
        
        .audio-section {
            grid-column: 2;
            grid-row: 4;
        }
        
        .others {
            grid-column: 1 / span 2;
            grid-row: 5;
        }
    }
    
    @media (max-width: 576px) {
        .grid-container {
            grid-template-columns: 1fr;
            grid-template-rows: auto auto auto auto auto auto;
        }
        
        .spectrogram-small {
            grid-column: 1;
            grid-row: 1;
        }
        
        .controls {
            grid-column: 1;
            grid-row: 2;
        }
        
        .call-type {
            grid-column: 1;
            grid-row: 3;
        }
        
        .spectrogram-large {
            grid-column: 1;
            grid-row: 4;
        }
        
        .confidence {
            grid-column: 1;
            grid-row: 5;
        }
        
        .audio-section {
            grid-column: 1;
            grid-row: 6;
        }
        
        .others {
            grid-column: 1;
            grid-row: 7;
        }
    }
</style>
{% endblock %}