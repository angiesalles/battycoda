{% extends 'list_view_base.html' %}
{% load static %}

{% block page_title %}Tasks{% endblock %}
{% block list_title %}Tasks{% endblock %}
{% block card_title %}All Tasks{% endblock %}
{% block item_count %}{{ tasks.count }}{% endblock %}

{% block action_buttons %}
<a href="{% url 'battycoda_app:task_batch_list' %}" class="btn btn-primary">
    <i class="fas fa-layer-group"></i> View Task Batches
</a>
{% endblock %}

{% block data_table %}
{% if tasks %}
<div class="table-responsive">
    <table class="table table-hover mb-0">
        <thead>
            <tr>
                <th>File</th>
                <th>Onset/Offset</th>
                <th>Species</th>
                <th>Project</th>
                <th>Status</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>
                    <a href="{% url 'battycoda_app:task_detail' task.id %}" class="text-decoration-none fw-bold">
                        {{ task.wav_file_name }}
                    </a>
                </td>
                <td>{{ task.onset|floatformat:2 }}s - {{ task.offset|floatformat:2 }}s</td>
                <td>{{ task.species.name }}</td>
                <td>{{ task.project.name }}</td>
                <td>
                    {% if task.is_done %}
                        <span class="badge bg-success">Completed</span>
                    {% elif task.status == 'in_progress' %}
                        <span class="badge bg-warning">In Progress</span>
                    {% else %}
                        <span class="badge bg-secondary">Pending</span>
                    {% endif %}
                </td>
                <td data-utc-date="{{ task.created_at|date:'c' }}" data-date-format="date">
                    {{ task.created_at|date:"M d, Y" }}
                </td>
                <td>
                    <div class="btn-group">
                        <a href="{% url 'battycoda_app:task_detail' task.id %}"
                           class="btn btn-sm btn-outline-info"
                           data-bs-toggle="tooltip" data-bs-placement="top"
                           title="View task details">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="{% url 'battycoda_app:annotate_task' task.id %}"
                           class="btn btn-sm btn-primary ms-1"
                           data-bs-toggle="tooltip" data-bs-placement="top"
                           title="Annotate this task">
                            <i class="fas fa-edit"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
{% block empty_state %}
<div class="text-center p-5">
    <i class="fas fa-tasks fa-4x mb-3 text-muted"></i>
    <h4>No Tasks Found</h4>
    <p class="text-muted">Tasks are created through task batches from classification results.</p>
    <a href="{% url 'battycoda_app:task_batch_list' %}" class="btn btn-primary mt-2">
        <i class="fas fa-layer-group me-1"></i> View Task Batches
    </a>
</div>
{% endblock %}
{% endif %}
{% endblock %}

{% block card_footer %}
{% endblock %}
