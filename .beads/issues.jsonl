{"id":"battycoda-013","title":"Phase 3: Quality Improvements","description":"## Scope\nCode quality improvements for clustering visualization.\n\n## Tasks (from CLUSTERING_VISUALIZATION_OVERHAUL.md)\n\n### 1. Remove console.log statements (~30+)\nLocations: drag_drop.js, mapping_interface.js, create_run.html\nOption: Remove all or use DEBUG flag pattern\n\n### 2. Add debouncing\n- Cluster search: cluster_mapping.js:26\n- Confidence slider: initialization.js:74\nPattern: debounce(fn, 300)\n\n### 3. Use Django json_script for data serialization\nCurrent (fragile):\n```javascript\n{% for cluster in clusters %}\nclusters.push({...});\n{% endfor %}\n```\nBetter:\n```html\n{{ clusters_data|json_script:\"clusters-data\" }}\n```\n\n### 4. Standardize API response format\nCurrent mix:\n- {'status': 'success', 'data': ...}\n- {'error': 'message'}\n- {'status': 'error', 'message': '...'}\n\n### 5. Extract inline JS to external files\n- create_run.html: 130+ lines\n- dashboard.html: 30+ lines  \n- cluster_explorer.html: 20+ lines\n\n### 6. Hardcoded URLs → Django url tag\nPass URLs from template to JS\n\n## Estimated Effort\n16-24 hours","status":"open","priority":2,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T22:19:48.547351295Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:19:48.547351295Z"}
{"id":"battycoda-0i5","title":"Evaluate TypeScript for new JavaScript code","description":"## Context\nVite supports TypeScript out of the box. Should we use TypeScript for new code?\n\n## Trade-offs\n\n### Pros\n- Type safety catches bugs at compile time\n- Better IDE autocomplete and refactoring\n- Self-documenting code\n- Easier onboarding for new developers\n- Vite handles compilation transparently\n\n### Cons\n- Learning curve if unfamiliar\n- Migration effort for existing code\n- Extra compilation step (though Vite handles this)\n- Stricter than necessary for small codebase?\n\n## Recommendation\n**Gradual adoption**: Use TypeScript for new files, don't migrate existing code.\n\n### Strategy\n\n#### Phase 1: Enable TypeScript (no migration)\n```bash\nnpm install --save-dev typescript\n```\n\n```json\n// tsconfig.json\n{\n  \"compilerOptions\": {\n    \"target\": \"ES2022\",\n    \"module\": \"ESNext\",\n    \"moduleResolution\": \"bundler\",\n    \"strict\": false,         // Start permissive\n    \"allowJs\": true,         // Allow mixing JS and TS\n    \"checkJs\": false,        // Don't check JS files\n    \"noEmit\": true,          // Vite handles compilation\n    \"esModuleInterop\": true,\n    \"skipLibCheck\": true,\n    \"types\": [\"vite/client\"]\n  },\n  \"include\": [\n    \"static/js/**/*.ts\",\n    \"static/js/**/*.js\"\n  ],\n  \"exclude\": [\n    \"node_modules\",\n    \"static/dist\"\n  ]\n}\n```\n\n#### Phase 2: Write new code in TypeScript\nNew files use `.ts` extension:\n```typescript\n// static/js/utils/api.ts\ninterface Recording {\n  id: number;\n  name: string;\n  duration: number;\n  project: Project;\n}\n\ninterface Project {\n  id: number;\n  name: string;\n}\n\nexport async function fetchRecording(id: number): Promise\u003cRecording\u003e {\n  const response = await fetch(`/api/recordings/${id}/`);\n  return response.json();\n}\n```\n\n#### Phase 3: Add types for existing modules (optional)\nCreate `.d.ts` declaration files:\n```typescript\n// static/js/types/global.d.ts\ndeclare global {\n  interface Window {\n    players: Record\u003cstring, PlayerInstance\u003e;\n  }\n  \n  const $: JQueryStatic;\n  const jQuery: JQueryStatic;\n}\n\n// static/js/cluster_explorer/types.d.ts\nexport interface Cluster {\n  id: number;\n  label: string;\n  size: number;\n  vis_x: number;\n  vis_y: number;\n  color?: string;\n}\n```\n\n#### Phase 4: Gradual strictness increase\nAs team comfort grows, enable stricter checks:\n```json\n{\n  \"compilerOptions\": {\n    \"strict\": true,\n    \"noImplicitAny\": true,\n    \"strictNullChecks\": true\n  }\n}\n```\n\n## When to Use TypeScript\n- **New utility modules** (api.ts, types.ts)\n- **Complex data transformations**\n- **Shared interfaces/types**\n- **New features with complex state**\n\n## When to Keep JavaScript\n- **Simple scripts** (small one-off files)\n- **Heavily DOM-dependent code** (less benefit)\n- **Existing code** (unless refactoring anyway)\n\n## Implementation Steps\n\n### 1. Install TypeScript\n```bash\nnpm install --save-dev typescript @types/jquery @types/d3\n```\n\n### 2. Create tsconfig.json\nSee configuration above.\n\n### 3. Update Vite config (minimal changes)\nVite handles .ts files automatically. Just ensure:\n```javascript\n// vite.config.js\nexport default defineConfig({\n  // TypeScript works out of the box\n});\n```\n\n### 4. Create types directory\n```\nstatic/js/\n├── types/\n│   ├── global.d.ts    # Global type declarations\n│   ├── api.d.ts       # API response types\n│   └── models.d.ts    # Domain model types\n```\n\n### 5. Write first TypeScript file\nStart with a new utility:\n```typescript\n// static/js/utils/api.ts\n```\n\n### 6. Document TypeScript usage\nAdd to CLAUDE.md:\n- When to use TS vs JS\n- How to run type checking\n- Where to put types\n\n## Files Created\n- tsconfig.json\n- static/js/types/global.d.ts\n- static/js/types/api.d.ts\n- CLAUDE.md updates\n\n## Verification\n- `npx tsc --noEmit` passes\n- Vite builds .ts files\n- IDE shows type errors\n- Existing JS still works","status":"open","priority":3,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:33:03.233211221Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:33:03.233211221Z","dependencies":[{"issue_id":"battycoda-0i5","depends_on_id":"battycoda-10n","type":"blocks","created_at":"2026-01-13T23:33:39.245282915Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-0r0","title":"Configure test database isolation for E2E tests","description":"## Problem\nE2E tests modify the database. Risks:\n1. Tests running in parallel could conflict\n2. Failed tests might not clean up\n3. Test data could leak into production-like environment\n4. Tests are not repeatable if DB state is unpredictable\n\n## Solution: Separate Test Database\n\n### 1. Create test database configuration\n```python\n# config/settings.py\n\n# Test database (used when running tests)\nif 'test' in sys.argv or os.environ.get('DJANGO_TEST_MODE'):\n    DATABASES = {\n        'default': {\n            'ENGINE': 'django.db.backends.postgresql',\n            'NAME': 'battycoda_test',\n            'USER': os.environ.get('DB_USER', 'battycoda'),\n            'PASSWORD': os.environ.get('DB_PASSWORD', 'battycoda'),\n            'HOST': os.environ.get('DB_HOST', 'localhost'),\n            'PORT': os.environ.get('DB_PORT', '5432'),\n        }\n    }\n```\n\n### 2. Create test database\n```bash\n# Create test database\nsudo -u postgres createdb battycoda_test -O battycoda\n\n# Or via psql\nsudo -u postgres psql -c \"CREATE DATABASE battycoda_test OWNER battycoda;\"\n```\n\n### 3. Update Playwright config for test database\n```javascript\n// tests/e2e/playwright.config.js\nexport default defineConfig({\n  webServer: {\n    command: 'DJANGO_TEST_MODE=1 python manage.py runserver 8000',\n    url: 'http://localhost:8000',\n    reuseExistingServer: !process.env.CI,\n  },\n});\n```\n\n### 4. Create test database setup in global-setup.js\n```javascript\n// tests/e2e/global-setup.js\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\n\nconst execAsync = promisify(exec);\n\nexport default async function globalSetup() {\n  console.log('Setting up test database...');\n  \n  // Set environment for test mode\n  process.env.DJANGO_TEST_MODE = '1';\n  \n  // Run migrations on test database\n  await execAsync('DJANGO_TEST_MODE=1 python manage.py migrate --run-syncdb');\n  \n  // Create test fixtures\n  await execAsync('DJANGO_TEST_MODE=1 python manage.py setup_e2e_tests');\n  \n  console.log('Test database ready');\n}\n```\n\n### 5. Reset database between test runs (optional)\nFor completely isolated runs:\n```javascript\n// tests/e2e/global-setup.js\nexport default async function globalSetup() {\n  // Flush and recreate\n  await execAsync('DJANGO_TEST_MODE=1 python manage.py flush --no-input');\n  await execAsync('DJANGO_TEST_MODE=1 python manage.py setup_e2e_tests');\n}\n```\n\n### 6. Transaction-based isolation (advanced)\nFor parallel test isolation, wrap each test in a transaction:\n\n```python\n# battycoda_app/management/commands/start_test_transaction.py\n# Creates a savepoint that can be rolled back\n\n# This is complex - consider using pytest-django's transactional fixtures instead\n```\n\n### 7. Add npm scripts\n```json\n{\n  \"scripts\": {\n    \"e2e\": \"DJANGO_TEST_MODE=1 playwright test\",\n    \"e2e:setup-db\": \"DJANGO_TEST_MODE=1 python manage.py migrate \u0026\u0026 DJANGO_TEST_MODE=1 python manage.py setup_e2e_tests\",\n    \"e2e:reset-db\": \"DJANGO_TEST_MODE=1 python manage.py flush --no-input \u0026\u0026 npm run e2e:setup-db\"\n  }\n}\n```\n\n## Test Data Isolation Strategy\n\n| Scope | Strategy |\n|-------|----------|\n| Between test runs | Flush and recreate (clean slate) |\n| Between test files | Use unique identifiers in test data |\n| Between parallel tests | Avoid for now (run sequentially) |\n\n## Verification Checklist\n- [ ] Test DB is separate from dev/prod DB\n- [ ] `npm run e2e` uses test database\n- [ ] Test data doesn't appear in production\n- [ ] Failed tests don't leave orphan data\n- [ ] Tests are repeatable\n\n## Files Created/Modified\n- config/settings.py (test database config)\n- tests/e2e/playwright.config.js (env vars)\n- tests/e2e/global-setup.js (DB setup)\n- package.json (npm scripts)\n- Database: battycoda_test created\n\n## Verification\n- Run E2E tests multiple times - same results\n- Check production DB - no test data\n- Parallel test runs don't conflict (if enabled)","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:31:40.61878091Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:31:40.61878091Z","dependencies":[{"issue_id":"battycoda-0r0","depends_on_id":"battycoda-hxh","type":"blocks","created_at":"2026-01-13T23:33:39.062683454Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-10n","title":"Update deployment and CI for Vite build","description":"## Task\nUpdate deployment scripts and CI to include Vite build step.\n\n## Steps\n\n### 1. Update systemd service files\nAdd npm build before collectstatic in deployment:\n\nUpdate `systemd/battycoda.service` ExecStartPre or create deploy script:\n```bash\n# Pre-start commands\nExecStartPre=/usr/bin/npm --prefix /home/ubuntu/battycoda run build\nExecStartPre=/home/ubuntu/battycoda/venv/bin/python manage.py collectstatic --noinput\n```\n\nOr better, create a deploy script:\n```bash\n#!/bin/bash\n# scripts/deploy.sh\nset -e\ncd /home/ubuntu/battycoda\nsource venv/bin/activate\nnpm ci\nnpm run build\npython manage.py collectstatic --noinput\npython manage.py migrate\n```\n\n### 2. Install Node.js on server\nEnsure Node.js is installed:\n```bash\n# Using nvm or system package\ncurl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -\nsudo apt-get install -y nodejs\n```\n\nDocument Node.js version requirement in README.\n\n### 3. Update .gitignore\n```\n# Node\nnode_modules/\n\n# Vite build output\nstatic/dist/\n\n# But keep source maps for debugging if needed\n!static/dist/*.map\n```\n\n### 4. Create development setup script\n```bash\n#!/bin/bash\n# scripts/dev_setup.sh\nnpm install\nnpm run dev \u0026\nVITE_PID=$!\npython manage.py runserver\nkill $VITE_PID\n```\n\n### 5. Update CLAUDE.md\nAdd section on JavaScript development:\n- How to run dev server\n- How to add new JS modules\n- Build process documentation\n\n### 6. Optional: GitHub Actions CI\nIf using CI, add:\n```yaml\n- name: Setup Node.js\n  uses: actions/setup-node@v4\n  with:\n    node-version: '20'\n    cache: 'npm'\n    \n- name: Install and build JS\n  run: |\n    npm ci\n    npm run build\n```\n\n## Files Created/Modified\n- scripts/deploy.sh (new)\n- scripts/dev_setup.sh (new)\n- systemd/battycoda.service (updated)\n- .gitignore (updated)\n- CLAUDE.md (updated)\n- README.md (updated if exists)\n\n## Verification\n- Fresh clone + npm install + npm run build works\n- Deployment script runs successfully\n- collectstatic includes built JS bundles","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:06:26.689523358Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:06:26.689523358Z","dependencies":[{"issue_id":"battycoda-10n","depends_on_id":"battycoda-c7o","type":"blocks","created_at":"2026-01-13T23:20:13.543454554Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-1hd","title":"Remove DEBUG print statements from production code","description":"## Problem\nMultiple files contain DEBUG print statements that clutter logs and leak implementation details.\n\n## Files with DEBUG prints\n\n### battycoda_app/simple_api/recording_upload.py\n- Lines 37-46: Prints POST data and FILES data\n- Lines 121, 127, 198, 202, 205, 207, 218, 236, 247, 254\n\n### battycoda_app/views_classification/run_creation.py\n- Lines 100, 102, 104, 120, 122\n\n## Fix Approach\n\n### Option 1: Remove entirely\n```python\n# Delete these lines\nprint(f\"DEBUG: POST data: {dict(request.POST)}\")\n```\n\n### Option 2: Convert to logging (if info is useful)\n```python\nimport logging\nlogger = logging.getLogger(__name__)\n\n# Replace print with debug log\nlogger.debug(f\"POST data: {dict(request.POST)}\")\n```\n\nNote: DEBUG logs only appear when DEBUG=True in settings.\n\n## Commands to Find All\n```bash\ngrep -rn \"print.*DEBUG\" battycoda_app/\ngrep -rn \"print(f\\\"DEBUG\" battycoda_app/\n```\n\n## Verification\n- grep -rn \"DEBUG:\" battycoda_app/ returns 0 results\n- No print() statements remain in view code\n- App still functions correctly","status":"closed","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T00:03:03.802285374Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:23:54.731131025Z","closed_at":"2026-01-13T18:17:14.732666-06:00"}
{"id":"battycoda-2h0","title":"Write E2E tests for clustering workflow","description":"## Task\nWrite Playwright E2E tests for the clustering workflow.\n\n## Test Cases\n\n### tests/e2e/specs/clustering.spec.js\n```javascript\nimport { test, expect } from '@playwright/test';\nimport { login } from '../helpers/auth.js';\nimport users from '../fixtures/users.json';\n\ntest.describe('Clustering', () =\u003e {\n  test.beforeEach(async ({ page }) =\u003e {\n    await login(page, users.testUser.email, users.testUser.password);\n  });\n  \n  test.describe('Dashboard', () =\u003e {\n    test('displays clustering runs', async ({ page }) =\u003e {\n      await page.goto('/clustering/');\n      \n      await expect(page.locator('h1, h2')).toContainText('Clustering');\n      await expect(page.locator('table, .clustering-list')).toBeVisible();\n    });\n    \n    test('create new clustering run link', async ({ page }) =\u003e {\n      await page.goto('/clustering/');\n      \n      await page.click('text=New Clustering Run');\n      \n      await expect(page).toHaveURL(/create/);\n    });\n  });\n  \n  test.describe('Create Clustering Run', () =\u003e {\n    test('form displays all required fields', async ({ page }) =\u003e {\n      await page.goto('/clustering/create/');\n      \n      await expect(page.locator('select[name=\"algorithm\"]')).toBeVisible();\n      await expect(page.locator('select[name=\"segmentation\"], select[name=\"scope\"]')).toBeVisible();\n    });\n    \n    test('create single-segmentation run', async ({ page }) =\u003e {\n      await page.goto('/clustering/create/');\n      \n      // Select algorithm\n      await page.selectOption('select[name=\"algorithm\"]', { label: 'K-Means' });\n      \n      // Set parameters\n      await page.fill('input[name=\"num_clusters\"]', '5');\n      \n      // Select segmentation\n      await page.selectOption('select[name=\"segmentation\"]', { index: 1 });\n      \n      // Submit\n      await page.click('button[type=\"submit\"]');\n      \n      // Should redirect to run detail or show success\n      await expect(page).toHaveURL(/clustering\\/\\d+|clustering\\//);\n    });\n    \n    test('create project-level run', async ({ page }) =\u003e {\n      await page.goto('/clustering/create/');\n      \n      // Select project scope\n      await page.click('input[value=\"project\"], label:has-text(\"Project\")');\n      \n      // Select project\n      await page.selectOption('select[name=\"project\"]', { label: 'E2E Test Project' });\n      \n      // Select species\n      await page.selectOption('select[name=\"species\"]', { label: 'Test Species' });\n      \n      // Submit\n      await page.click('button[type=\"submit\"]');\n      \n      await expect(page.locator('.alert-success, .toast')).toBeVisible();\n    });\n  });\n  \n  test.describe('Cluster Explorer', () =\u003e {\n    test('visualization renders', async ({ page }) =\u003e {\n      // Navigate to an existing clustering run\n      await page.goto('/clustering/');\n      await page.click('a:has-text(\"View\")');\n      \n      // Wait for visualization\n      await expect(page.locator('#cluster-visualization, .cluster-viz')).toBeVisible();\n      await expect(page.locator('svg')).toBeVisible();\n    });\n    \n    test('cluster selection updates sidebar', async ({ page }) =\u003e {\n      await page.goto('/clustering/1/explorer/');  // Assuming run ID 1\n      \n      // Click on a cluster point\n      await page.click('circle.cluster-point:first-child');\n      \n      // Sidebar should update\n      await expect(page.locator('.cluster-details, #cluster-sidebar')).toContainText('Cluster');\n    });\n    \n    test('controls affect visualization', async ({ page }) =\u003e {\n      await page.goto('/clustering/1/explorer/');\n      \n      // Adjust point size slider\n      await page.fill('input[name=\"point-size\"]', '10');\n      \n      // Points should resize (hard to verify visually, but check no errors)\n      await expect(page.locator('circle')).toBeVisible();\n    });\n  });\n  \n  test.describe('Cluster Mapping', () =\u003e {\n    test('mapping interface loads', async ({ page }) =\u003e {\n      await page.goto('/clustering/1/mapping/');\n      \n      await expect(page.locator('.call-types, .cluster-list')).toBeVisible();\n    });\n    \n    test('drag cluster to call type', async ({ page }) =\u003e {\n      await page.goto('/clustering/1/mapping/');\n      \n      // Drag and drop\n      const cluster = page.locator('.cluster-item:first-child');\n      const callType = page.locator('.call-type-drop:first-child');\n      \n      await cluster.dragTo(callType);\n      \n      // Mapping should be created\n      await expect(page.locator('.mapping-item, .alert-success')).toBeVisible();\n    });\n  });\n});\n```\n\n## Files Created\n- tests/e2e/specs/clustering.spec.js\n\n## Prerequisites\n- Test data includes at least one segmented recording\n- Test data includes at least one completed clustering run\n\n## Verification\n- All clustering tests pass\n- Visualization renders in all browsers\n- Drag-drop works correctly","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:11:03.255912476Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:11:03.255912476Z","dependencies":[{"issue_id":"battycoda-2h0","depends_on_id":"battycoda-hxh","type":"blocks","created_at":"2026-01-13T23:20:18.216994315Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-2jm","title":"Phase 1: Vite Build System Setup","description":"## Overview\nSet up Vite as the build tool for BattyCoda's JavaScript, integrating with Django's static file system.\n\n## Goals\n- Modern ES6 module support with proper bundling\n- Hot module reload in development\n- Optimized production builds\n- Seamless Django integration\n\n## Key Decisions Made\n- Build tool: Vite (faster than Webpack, better DX)\n- Testing: Vitest (unit) + Playwright (E2E)\n- Bootstrap: Stay on 4.x for now (separate decision)\n\n## Success Criteria\n- `npm run dev` starts Vite dev server with HMR\n- `npm run build` produces optimized bundles in static/dist/\n- Django templates load bundles correctly in both dev and prod\n- Existing functionality unchanged","status":"open","priority":1,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T23:02:54.724737603Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:02:54.724737603Z"}
{"id":"battycoda-2k8","title":"Simplify verbose code patterns (ternaries, redundant checks)","description":"## Problem\nOverly verbose code patterns that could be simplified.\n\n## Verbose Ternaries (use 'or' instead)\n\n### battycoda_app/models/user/profile.py (Line 84)\n# Current:\ntarget_group = group if group else self.group\n# Should be:\ntarget_group = group or self.group\n\n### battycoda_app/views_segmentation/segmentation_execution.py (Lines 262-264)\nRepetitive default checks that could use getattr with default.\n\n## Redundant Existence Checks\n\n### battycoda_app/simple_api/data_views.py (Lines 68-75)\nChecks species_counts, then checks primary_species multiple times.\n\n### battycoda_app/views_auth/ajax.py (Lines 51-60)\nStores .exists() result then checks it - could inline.\n\n### battycoda_app/management/commands/import_species.py (Lines 35-37)\nCould use .first() pattern instead of .exists() + .filter().\n\n## Redundant 'or empty string' Fallbacks\nFiles with unnecessary 'or \"\"' patterns:\n- simple_api/data_views.py (lines 37, 73, 119)\n- simple_api/classification_views.py (line 36)\n- simple_api/segmentation_views.py (line 40)\n- simple_api/task_views.py (line 191)\n- views_clustering/mappings.py (lines 55, 58, 87)\n- views_clustering/runs.py (line 265)\n- models/segmentation.py (line 180)\n\n## Fix Pattern\n# Instead of:\nx = value if value else default\n# Use:\nx = value or default","status":"open","priority":3,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T01:23:51.189824797Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T01:23:51.189824797Z"}
{"id":"battycoda-2pf","title":"Write unit tests for player module","description":"## Task\nWrite comprehensive unit tests for the waveform player module.\n\n## Files to Test\n- static/js/player/player.js\n- static/js/player/data_manager.js\n- static/js/player/view_manager.js\n- static/js/player/renderer.js\n- static/js/player/seek_handler.js\n- static/js/player/play_region.js\n- static/js/player/timeline.js\n\n## Test Cases\n\n### data_manager.test.js\n```javascript\nimport { describe, it, expect, vi } from 'vitest';\nimport { DataManager } from './data_manager.js';\n\ndescribe('DataManager', () =\u003e {\n  describe('loadRecording', () =\u003e {\n    it('fetches recording metadata', async () =\u003e {\n      const manager = new DataManager();\n      fetch.mockResolvedValueOnce({\n        ok: true,\n        json: () =\u003e Promise.resolve({\n          duration: 120.5,\n          sample_rate: 44100,\n          channels: 1\n        })\n      });\n      \n      const result = await manager.loadRecording(123);\n      \n      expect(result.duration).toBe(120.5);\n      expect(result.sample_rate).toBe(44100);\n    });\n  });\n  \n  describe('getSegmentAtTime', () =\u003e {\n    it('returns segment containing timestamp', () =\u003e {\n      const manager = new DataManager();\n      manager.segments = [\n        { start: 0, end: 1.5 },\n        { start: 2.0, end: 3.5 },\n        { start: 4.0, end: 5.0 }\n      ];\n      \n      const segment = manager.getSegmentAtTime(2.5);\n      \n      expect(segment).toEqual({ start: 2.0, end: 3.5 });\n    });\n    \n    it('returns null for timestamp outside segments', () =\u003e {\n      const manager = new DataManager();\n      manager.segments = [{ start: 0, end: 1.0 }];\n      \n      expect(manager.getSegmentAtTime(1.5)).toBeNull();\n    });\n  });\n});\n```\n\n### view_manager.test.js\n```javascript\ndescribe('ViewManager', () =\u003e {\n  describe('setViewMode', () =\u003e {\n    it('switches between waveform and spectrogram', () =\u003e {\n      const vm = new ViewManager();\n      \n      vm.setViewMode('spectrogram');\n      expect(vm.getViewMode()).toBe('spectrogram');\n      \n      vm.setViewMode('waveform');\n      expect(vm.getViewMode()).toBe('waveform');\n    });\n  });\n  \n  describe('calculateVisibleRange', () =\u003e {\n    it('calculates pixel-to-time mapping', () =\u003e {\n      const vm = new ViewManager();\n      vm.duration = 60;\n      vm.width = 600;\n      \n      const range = vm.calculateVisibleRange(100, 200);\n      \n      expect(range.start).toBeCloseTo(10);\n      expect(range.end).toBeCloseTo(20);\n    });\n  });\n});\n```\n\n### seek_handler.test.js\nTest seek position calculations\n\n### play_region.test.js\nTest region selection logic\n\n### timeline.test.js\nTest time marker calculations\n\n## Test Approach\n1. Mock Audio API (HTMLAudioElement)\n2. Mock Canvas API where needed\n3. Test state management logic\n4. Test calculations (time \u003c-\u003e pixel conversions)\n5. Use dependency injection for testability\n\n## Coverage Target\n- data_manager.js: 90%+\n- view_manager.js: 85%+\n- seek_handler.js: 80%+\n- play_region.js: 80%+\n- timeline.js: 75%+\n- renderer.js: 50%+ (canvas-heavy)\n\n## Files Created\n- static/js/player/data_manager.test.js\n- static/js/player/view_manager.test.js\n- static/js/player/seek_handler.test.js\n- static/js/player/play_region.test.js\n- static/js/player/timeline.test.js\n- static/js/test/mocks/audio.js\n- static/js/test/mocks/canvas.js\n- static/js/test/fixtures/recording.json\n\n## Verification\n- All tests pass\n- Coverage meets targets\n- Player still works in browser","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:08:36.23786855Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:08:36.23786855Z","dependencies":[{"issue_id":"battycoda-2pf","depends_on_id":"battycoda-gr3","type":"blocks","created_at":"2026-01-13T23:20:15.708367416Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-3rp","title":"Fix bare except clauses and improve error handling","description":"## Problem\n15+ locations use bare `except:` or `except Exception:` that silently swallow errors, making debugging extremely difficult.\n\n## Locations to Fix\n\n### HIGH PRIORITY (silent failures)\n\n**1. battycoda_app/audio/task_modules/classification/run_classification.py**\n- Line 50-51: `except: pass` - should catch specific exceptions\n- Line 120: Uses print() instead of logging\n- Line 192: `except Exception: pass`\n\n**2. battycoda_app/audio/task_modules/training_tasks.py**\n- Lines 139, 153, 208, 233, 291, 305, 316, 324, 537\n- Multiple bare except blocks during cleanup\n- Critical exceptions not properly logged\n\n**3. battycoda_app/audio/batch_utils.py**\n- Line 176-178: `except Exception: error_count += 1` - no logging\n\n**4. battycoda_app/simple_api/recording_upload.py**\n- Lines 160-161, 280-281: `except: pass` during file cleanup\n\n**5. battycoda_app/models/user/profile.py**\n- Lines 178-180, 199-204, 225: Silent failures in storage calculation\n\n### Fix Pattern\n\nReplace:\n```python\ntry:\n    do_something()\nexcept:\n    pass\n```\n\nWith:\n```python\ntry:\n    do_something()\nexcept SpecificException as e:\n    logger.warning(f\"Expected error during X: {e}\")\nexcept Exception as e:\n    logger.exception(f\"Unexpected error during X\")\n    # Re-raise if critical, or handle gracefully\n```\n\n### Create Helper Function\n```python\n# battycoda_app/utils/cleanup.py\nimport logging\nimport shutil\n\nlogger = logging.getLogger(__name__)\n\ndef safe_cleanup_dir(path: str, description: str = \"temporary directory\") -\u003e bool:\n    \"\"\"Safely remove a directory, logging any errors.\"\"\"\n    try:\n        if os.path.exists(path):\n            shutil.rmtree(path)\n            return True\n    except PermissionError:\n        logger.warning(f\"Permission denied cleaning up {description}: {path}\")\n    except OSError as e:\n        logger.warning(f\"OS error cleaning up {description} {path}: {e}\")\n    except Exception as e:\n        logger.exception(f\"Unexpected error cleaning up {description}: {path}\")\n    return False\n```\n\n### Files to Modify\n1. battycoda_app/audio/task_modules/classification/run_classification.py\n2. battycoda_app/audio/task_modules/training_tasks.py\n3. battycoda_app/audio/batch_utils.py\n4. battycoda_app/simple_api/recording_upload.py\n5. battycoda_app/models/user/profile.py\n6. battycoda_app/utils_modules/species_utils.py\n7. battycoda_app/utils_modules/recording_utils.py\n\n### Verification\n- grep -r \"except:\" battycoda_app/ should return 0 results\n- grep -r \"except Exception:\" should only show logged exceptions\n- Run tests to ensure nothing breaks","status":"closed","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T00:02:56.102374757Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:59:19.045103519Z","closed_at":"2026-01-13T18:33:49.976041-06:00","comments":[{"id":1,"issue_id":"battycoda-3rp","author":"kevin","text":"## Work Completed (Local Machine - needs server deployment)\n\n### Files Successfully Modified:\n1. **battycoda_app/utils_modules/cleanup.py** - CREATED with safe_remove_file() and safe_cleanup_dir() helpers\n2. **battycoda_app/audio/task_modules/classification/run_classification.py** - Fixed bare excepts, replaced print() with logger\n3. **battycoda_app/audio/task_modules/training_tasks.py** - Fixed all bare excepts, replaced print() with logger\n4. **battycoda_app/audio/batch_utils.py** - Fixed bare except, added logging\n5. **battycoda_app/simple_api/recording_upload.py** - Fixed bare excepts, using safe cleanup helpers\n6. **battycoda_app/models/user/profile.py** - Changed except Exception to except OSError with logging\n7. **battycoda_app/utils_modules/species_utils.py** - Fixed ImportError and IOError/OSError exceptions\n8. **battycoda_app/utils_modules/recording_utils.py** - Fixed bare except with proper exceptions\n9. **battycoda_app/views_jobs/ajax.py** - Removed unnecessary try/except around ClusteringRun queries\n10. **battycoda_app/views_jobs/dashboard.py** - Removed unnecessary try/except around ClusteringRun queries\n11. **battycoda_app/middleware/authentication_middleware.py** - Changed except to except NoReverseMatch\n12. **battycoda_app/audio/task_modules/spectrogram/hdf5_generation.py** - Changed except to except DatabaseError\n13. **battycoda_app/views_batch_upload.py** - Using safe_remove_file for cleanup\n14. **battycoda_app/views_recording_core.py** - Using safe_remove_file for cleanup\n\n### Note on Linter Issue:\nLocal machine doesn't have Docker, so the linter kept reverting changes. On the server, run:\n- ./format.sh to fix import order\n- ./lint.sh to verify\n\n### Remaining Work on Server:\n1. Re-verify with grep: grep -r 'except:$' battycoda_app/ (should only show .old file)\n2. Run tests: python manage.py test\n3. Restart services if tests pass","created_at":"2026-01-14T00:31:44Z"}]}
{"id":"battycoda-3vv","title":"Configure Vite for Django integration","description":"## Task\nConfigure Vite to work seamlessly with Django's static file system.\n\n## Steps\n\n### 1. Create vite.config.js with Django-aware settings\n```javascript\nimport { defineConfig } from 'vite';\nimport { resolve } from 'path';\n\nexport default defineConfig({\n  // Use static/ as the root for source files\n  root: 'static',\n  \n  build: {\n    // Output to static/dist/ for Django to collect\n    outDir: 'dist',\n    emptyOutDir: true,\n    \n    // Generate manifest for Django to read\n    manifest: true,\n    \n    // Configure rollup\n    rollupOptions: {\n      input: {\n        // Entry points will be added here\n        main: resolve(__dirname, 'static/js/main.js'),\n      },\n      output: {\n        // Predictable filenames for Django\n        entryFileNames: 'js/[name]-[hash].js',\n        chunkFileNames: 'js/[name]-[hash].js',\n        assetFileNames: 'assets/[name]-[hash][extname]',\n      }\n    }\n  },\n  \n  // Dev server settings\n  server: {\n    port: 5173,\n    strictPort: true,\n    // Allow Django to proxy to Vite\n    origin: 'http://localhost:5173',\n  }\n});\n```\n\n### 2. Create Django template tag for Vite assets\nCreate `battycoda_app/templatetags/vite.py`:\n```python\nfrom django import template\nfrom django.conf import settings\nfrom django.templatetags.static import static\nimport json\nfrom pathlib import Path\n\nregister = template.Library()\n\n@register.simple_tag\ndef vite_asset(entry_name):\n    \"\"\"Load a Vite asset, handling dev vs prod.\"\"\"\n    if settings.DEBUG:\n        # In dev, load from Vite dev server\n        return f'http://localhost:5173/js/{entry_name}'\n    else:\n        # In prod, read from manifest\n        manifest_path = Path(settings.STATIC_ROOT) / 'dist' / '.vite' / 'manifest.json'\n        if manifest_path.exists():\n            manifest = json.loads(manifest_path.read_text())\n            if entry_name in manifest:\n                return static(f'dist/{manifest[entry_name][\"file\"]}')\n    return static(f'dist/js/{entry_name}')\n```\n\n### 3. Create __init__.py for templatetags\nEnsure `battycoda_app/templatetags/__init__.py` exists.\n\n### 4. Test dev server integration\n- Vite dev server runs on port 5173\n- Django can reference Vite assets\n- HMR works for CSS and JS changes\n\n## Files Created/Modified\n- vite.config.js (updated)\n- battycoda_app/templatetags/vite.py\n- battycoda_app/templatetags/__init__.py\n\n## Verification\n- `npm run dev` starts and serves assets\n- Django templates can load from Vite dev server\n- `npm run build` generates manifest.json","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:04:33.459031456Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:04:33.459031456Z","dependencies":[{"issue_id":"battycoda-3vv","depends_on_id":"battycoda-ehr","type":"blocks","created_at":"2026-01-13T23:20:12.667092407Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-5ko","title":"Phase 3: Playwright E2E Testing Setup","description":"## Overview\nSet up Playwright for end-to-end testing of BattyCoda. Playwright tests real user flows in a real browser against the running Django application.\n\n## Goals\n- E2E coverage for critical user journeys\n- Cross-browser testing (Chromium, Firefox, WebKit)\n- Visual regression detection\n- CI integration with test reports\n\n## What to Test with Playwright\n- User authentication flows\n- Recording upload and playback\n- Segmentation workflow\n- Classification workflow\n- Clustering workflow\n- Task annotation interface\n- Full CRUD operations\n\n## Architecture\n```\ntests/\n├── e2e/\n│   ├── playwright.config.js\n│   ├── fixtures/\n│   │   ├── test-audio.wav\n│   │   └── users.json\n│   ├── helpers/\n│   │   ├── auth.js\n│   │   └── api.js\n│   └── specs/\n│       ├── auth.spec.js\n│       ├── recordings.spec.js\n│       ├── clustering.spec.js\n│       └── tasks.spec.js\n```\n\n## Success Criteria\n- `npm run e2e` runs all E2E tests\n- Tests pass against local Django server\n- CI runs E2E tests on PR\n- Test failures produce screenshots/videos\n- Critical paths have \u003e90% coverage","status":"open","priority":1,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T23:10:49.845966632Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:10:49.845966632Z"}
{"id":"battycoda-5yu","title":"Simplify development workflow (Vite + Django + Celery)","description":"## Problem\nDevelopers now need to run multiple processes:\n1. Django dev server (port 8000)\n2. Vite dev server (port 5173)\n3. Celery worker\n4. Celery beat\n5. R server (for classification)\n\nThis is complex and error-prone.\n\n## Solution Options\n\n### Option A: Procfile with Honcho (Recommended)\nUse Honcho/Foreman to manage all processes.\n\n```bash\n# Install\npip install honcho\n```\n\n```\n# Procfile.dev\ndjango: python manage.py runserver 0.0.0.0:8000\nvite: npm run dev\ncelery: celery -A config worker -l info\nbeat: celery -A config beat -l info\n```\n\n```bash\n# Run everything\nhoncho start -f Procfile.dev\n\n# Run specific processes\nhoncho start django vite\n```\n\n### Option B: Docker Compose (Alternative)\n```yaml\n# docker-compose.dev.yml\nversion: '3.8'\nservices:\n  django:\n    build: .\n    command: python manage.py runserver 0.0.0.0:8000\n    volumes:\n      - .:/app\n    ports:\n      - \"8000:8000\"\n    \n  vite:\n    image: node:20\n    working_dir: /app\n    command: npm run dev\n    volumes:\n      - .:/app\n    ports:\n      - \"5173:5173\"\n    \n  # ... celery, redis, etc.\n```\n\n### Option C: Make targets\n```makefile\n# Makefile\n.PHONY: dev dev-full\n\ndev:\n\t@echo \"Starting Django + Vite...\"\n\t@trap 'kill 0' EXIT; \\\n\tnpm run dev \u0026 \\\n\tpython manage.py runserver\n\ndev-full:\n\t@echo \"Starting all services...\"\n\t@trap 'kill 0' EXIT; \\\n\tnpm run dev \u0026 \\\n\tcelery -A config worker -l info \u0026 \\\n\tcelery -A config beat -l info \u0026 \\\n\tpython manage.py runserver\n```\n\n## Recommended Implementation\n\n### 1. Install Honcho\n```bash\npip install honcho\n# Add to requirements.txt (dev dependencies)\necho \"honcho\" \u003e\u003e requirements-dev.txt\n```\n\n### 2. Create Procfile.dev\n```\n# Procfile.dev - Development processes\ndjango: source venv/bin/activate \u0026\u0026 python manage.py runserver 0.0.0.0:8000\nvite: npm run dev\ncelery: source venv/bin/activate \u0026\u0026 celery -A config worker -l info -c 2\nbeat: source venv/bin/activate \u0026\u0026 celery -A config beat -l info\n```\n\n### 3. Create convenience scripts\n```bash\n#!/bin/bash\n# scripts/dev.sh - Start development environment\n\nset -e\n\n# Check prerequisites\ncommand -v node \u003e/dev/null || { echo \"Node.js required\"; exit 1; }\ncommand -v honcho \u003e/dev/null || { echo \"Run: pip install honcho\"; exit 1; }\n\n# Install JS dependencies if needed\n[ -d node_modules ] || npm install\n\n# Start services\necho \"Starting development servers...\"\necho \"  Django:  http://localhost:8000\"\necho \"  Vite:    http://localhost:5173\"\necho \"\"\necho \"Press Ctrl+C to stop all services\"\necho \"\"\n\nhoncho start -f Procfile.dev\n```\n\n```bash\n#!/bin/bash\n# scripts/dev-minimal.sh - Just Django + Vite (no Celery)\n\ntrap 'kill 0' EXIT\nnpm run dev \u0026\nsource venv/bin/activate \u0026\u0026 python manage.py runserver\n```\n\n### 4. Update CLAUDE.md\n```markdown\n## Development\n\n### Quick Start\n\\`\\`\\`bash\n./scripts/dev.sh\n\\`\\`\\`\n\n### Minimal (no Celery)\n\\`\\`\\`bash\n./scripts/dev-minimal.sh\n\\`\\`\\`\n\n### Individual Services\n\\`\\`\\`bash\n# Terminal 1: Django\nsource venv/bin/activate \u0026\u0026 python manage.py runserver\n\n# Terminal 2: Vite\nnpm run dev\n\n# Terminal 3: Celery (optional)\nsource venv/bin/activate \u0026\u0026 celery -A config worker -l info\n\\`\\`\\`\n```\n\n### 5. VS Code launch configuration (optional)\n```json\n// .vscode/launch.json\n{\n  \"version\": \"0.2.0\",\n  \"compounds\": [\n    {\n      \"name\": \"Full Dev\",\n      \"configurations\": [\"Django\", \"Vite\"]\n    }\n  ],\n  \"configurations\": [\n    {\n      \"name\": \"Django\",\n      \"type\": \"python\",\n      \"request\": \"launch\",\n      \"program\": \"${workspaceFolder}/manage.py\",\n      \"args\": [\"runserver\"]\n    }\n  ]\n}\n```\n\n## Files Created\n- Procfile.dev\n- scripts/dev.sh\n- scripts/dev-minimal.sh\n- requirements-dev.txt (or update requirements.txt)\n- .vscode/launch.json (optional)\n- CLAUDE.md (updated)\n\n## Verification\n- `./scripts/dev.sh` starts all services\n- Ctrl+C cleanly stops all processes\n- Vite HMR works while Django serves pages\n- New developers can get started easily","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:29:26.430878889Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:29:26.430878889Z","dependencies":[{"issue_id":"battycoda-5yu","depends_on_id":"battycoda-ehr","type":"blocks","created_at":"2026-01-13T23:33:31.141088624Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-6ls","title":"Add CSS bundling and processing to Vite","description":"## Problem\nThe Vite plan focused on JS but ignored CSS. Current CSS structure:\n- static/css/app.css - Main app styles\n- static/css/themes.css - Theme variables\n- static/css/themes/*.css - Individual theme files\n- static/css/font-fix.css - Font overrides\n- static/lib/stroke-7/style.css - Icon font\n\n## Goals\n- Bundle CSS with Vite\n- Enable CSS imports in JS modules\n- Add PostCSS for autoprefixer\n- Maintain theme switching functionality\n\n## Implementation Steps\n\n### 1. Install CSS tooling\n```bash\nnpm install --save-dev postcss autoprefixer cssnano\n```\n\n### 2. Create postcss.config.js\n```javascript\nexport default {\n  plugins: {\n    autoprefixer: {},\n    cssnano: process.env.NODE_ENV === 'production' ? {} : false\n  }\n};\n```\n\n### 3. Update vite.config.js for CSS\n```javascript\nexport default defineConfig({\n  css: {\n    postcss: './postcss.config.js',\n    devSourcemap: true,\n  },\n  build: {\n    cssCodeSplit: true,  // Separate CSS per entry point\n    rollupOptions: {\n      input: {\n        main: resolve(__dirname, 'static/js/main.js'),\n        // CSS entry points\n        styles: resolve(__dirname, 'static/css/main.css'),\n      }\n    }\n  }\n});\n```\n\n### 4. Create main CSS entry point\n```css\n/* static/css/main.css */\n@import './app.css';\n@import './themes.css';\n@import './font-fix.css';\n@import '../lib/stroke-7/style.css';\n```\n\n### 5. Handle theme CSS files\nTheme files need to stay separate for dynamic loading. Options:\n\n**Option A: Keep themes as separate files (Recommended)**\n```javascript\n// vite.config.js\nimport { glob } from 'glob';\n\nconst themeFiles = glob.sync('static/css/themes/*.css');\nconst themeInputs = {};\nthemeFiles.forEach(file =\u003e {\n  const name = path.basename(file, '.css');\n  themeInputs[`theme-${name}`] = resolve(__dirname, file);\n});\n\nexport default defineConfig({\n  build: {\n    rollupOptions: {\n      input: {\n        main: '...',\n        ...themeInputs\n      }\n    }\n  }\n});\n```\n\n**Option B: CSS custom properties (future enhancement)**\nUse CSS variables for theming instead of separate files.\n\n### 6. Import CSS in JS modules (optional)\n```javascript\n// In main.js\nimport '../css/main.css';\n\n// Component-specific CSS\n// In cluster_explorer/index.js\nimport './cluster-explorer.css';\n```\n\n### 7. Update Django templates\n```html\n{% load vite %}\n\u003clink rel=\"stylesheet\" href=\"{% vite_asset 'styles.css' %}\"\u003e\n```\n\n### 8. Update theme switcher for Vite builds\nThe theme switcher loads CSS dynamically. Update to use Vite manifest:\n```javascript\nfunction loadTheme(themeName) {\n  const link = document.getElementById('theme-css');\n  // In dev: /static/css/themes/${themeName}.css\n  // In prod: /static/dist/theme-${themeName}-[hash].css\n  link.href = getThemeUrl(themeName);\n}\n```\n\n## Files Created/Modified\n- postcss.config.js (new)\n- static/css/main.css (new entry point)\n- vite.config.js (updated)\n- static/js/theme-switcher.js (updated)\n- battycoda_app/templatetags/vite.py (add CSS support)\n\n## Verification\n- All styles render correctly\n- Theme switching still works\n- CSS is minified in production\n- Autoprefixer adds vendor prefixes\n- No FOUC (flash of unstyled content)","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:28:24.963071298Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:28:24.963071298Z","dependencies":[{"issue_id":"battycoda-6ls","depends_on_id":"battycoda-3vv","type":"blocks","created_at":"2026-01-13T23:33:30.783111571Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-6nn","title":"Bootstrap 5 Migration","description":"Migrate from Bootstrap 4.3.1 + Maisonnette theme to Bootstrap 5.3. Maisonnette is EOL (Bootstrap Themes shutting down). Migration is manageable - only 1 file uses mai-* classes, 21 files use s7-* icons.","status":"open","priority":1,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T23:32:54.701522266Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:41:26.383102668Z"}
{"id":"battycoda-6nn.1","title":"Swap Bootstrap CDN to 5.3","description":"Update base.html to load Bootstrap 5.3 CSS and JS from CDN instead of 4.3.1. Remove jQuery dependency (BS5 doesn't need it). Update data attributes from data-toggle to data-bs-toggle, data-dismiss to data-bs-dismiss, etc.","status":"closed","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:33:35.568289178Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:59:02.731244665Z","closed_at":"2026-01-13T23:59:02.731244665Z","close_reason":"Swapped Bootstrap CDN from 4.3.1 to 5.3.3. Updated data attributes (data-toggle→data-bs-toggle, data-dismiss→data-bs-dismiss) and dropdown-menu-right→dropdown-menu-end across all templates. jQuery kept for Select2/Toastr compatibility.","dependencies":[{"issue_id":"battycoda-6nn.1","depends_on_id":"battycoda-6nn","type":"parent-child","created_at":"2026-01-13T23:33:35.571548231Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-6nn.2","title":"Update utility classes for BS5","description":"Convert remaining BS4 utility classes to BS5 equivalents across all templates. Already fixed: me/ms/pe/ps, float-end/start, text-end/start, visually-hidden. May need to check: form classes, grid classes, other utilities.","status":"closed","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:33:43.74039099Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:05:24.037317515Z","closed_at":"2026-01-14T00:05:24.037317515Z","close_reason":"Updated all BS4 utility classes to BS5: margin (ml/mr→ms/me), float (float-right→float-end), text (text-right→text-end, text-md-right→text-md-end), and screen reader (sr-only→visually-hidden).","dependencies":[{"issue_id":"battycoda-6nn.2","depends_on_id":"battycoda-6nn","type":"parent-child","created_at":"2026-01-13T23:33:43.74245242Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-6nn.3","title":"Replace Stroke-7 icons with Font Awesome","description":"Replace s7-* icon classes with Font Awesome equivalents in 21 template files. We already use Font Awesome, so this removes a dependency. Create mapping of s7-* to fa-* icons.","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:33:47.653025706Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:41:26.66598955Z","dependencies":[{"issue_id":"battycoda-6nn.3","depends_on_id":"battycoda-6nn","type":"parent-child","created_at":"2026-01-13T23:33:47.654853067Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-6nn.4","title":"Rewrite navbar for BS5","description":"Update base.html navbar from Maisonnette mai-* classes to standard BS5 navbar classes. Only 1 file affected. May need to adjust dropdown and collapse behavior for BS5.","status":"closed","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:33:55.818126613Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:06:36.142755457Z","closed_at":"2026-01-14T00:06:36.142755457Z","close_reason":"Removed all mai-* (Maisonnette) classes from navbar in base.html. Replaced mai-top-header with bg-dark, removed mai-top-nav/mai-icons-nav/mai-notifications/mai-settings/mai-user-nav, updated float-lg-right to ms-auto for proper BS5 alignment.","dependencies":[{"issue_id":"battycoda-6nn.4","depends_on_id":"battycoda-6nn","type":"parent-child","created_at":"2026-01-13T23:33:55.821209069Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-6nn.5","title":"Update JavaScript for BS5 API","description":"Update JS code for BS5 API changes. Key changes: no jQuery required, Bootstrap object access changes (bootstrap.Modal vs $.fn.modal), data attributes change (data-bs-*). Check static/js/ files.","status":"closed","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:33:57.298209896Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:10:43.10870925Z","closed_at":"2026-01-14T00:10:43.10870925Z","close_reason":"Updated JavaScript to use Bootstrap 5 API: app.js now uses bootstrap.Tooltip/Popover() with data-bs-toggle selectors, cluster_mapping modal handlers use bootstrap.Modal API instead of jQuery .modal()","dependencies":[{"issue_id":"battycoda-6nn.5","depends_on_id":"battycoda-6nn","type":"parent-child","created_at":"2026-01-13T23:33:57.30111023Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-6nn.6","title":"Audit and slim down theme CSS","description":"Review static/css/app.css (461KB) and theme files. Remove Maisonnette-specific styles no longer needed. Keep color schemes and useful customizations. Consider extracting only what we need.","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:33:59.402531456Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:41:26.974809174Z","dependencies":[{"issue_id":"battycoda-6nn.6","depends_on_id":"battycoda-6nn","type":"parent-child","created_at":"2026-01-13T23:33:59.405209149Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-6nn.7","title":"Test all UI components after migration","description":"Comprehensive testing after BS5 migration: modals, dropdowns, tooltips, popovers, collapse, tabs, forms, alerts, progress bars. Test on major pages: recordings, tasks, classification, clustering.","status":"closed","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:34:00.867485872Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:11:28.737539869Z","closed_at":"2026-01-14T00:11:28.737539869Z","close_reason":"Verified pages load with BS5: login/register return 200, BS5.3.3 CDN loaded, data-bs-toggle attributes present, no data-toggle or mai-* remnants found. Recommend manual browser testing for full verification.","dependencies":[{"issue_id":"battycoda-6nn.7","depends_on_id":"battycoda-6nn","type":"parent-child","created_at":"2026-01-13T23:34:00.869716072Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-6nn.8","title":"Update pre-commit hook for BS5","description":"Flip the pre-commit hook to check for BS4 classes instead of BS5. After migration, we want to prevent BS4 classes from creeping in.","status":"closed","priority":3,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:34:02.585662567Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:36:51.601719009Z","closed_at":"2026-01-13T23:36:51.601719009Z","close_reason":"Decided not to add pre-commit hook for Bootstrap class validation","dependencies":[{"issue_id":"battycoda-6nn.8","depends_on_id":"battycoda-6nn","type":"parent-child","created_at":"2026-01-13T23:34:02.588005682Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-6nn.9","title":"Update CLAUDE.md with Bootstrap 5 migration docs","description":"Update CLAUDE.md to document the Bootstrap 5 migration decision and new frontend standards.\n\n## Background\n\nOn 2026-01-13, we discovered the codebase had mixed Bootstrap 4 and 5 classes:\n- base.html loads Bootstrap 4.3.1 (required by Maisonnette theme)\n- Many templates accidentally used BS5 class names (me-*, ms-*, text-end, etc.)\n- These BS5 classes were doing nothing since BS4 was loaded\n\nWe initially fixed all BS5→BS4 classes, but then discovered:\n1. Maisonnette theme is EOL (Bootstrap Themes marketplace is shutting down)\n2. Our actual Maisonnette dependency is very shallow:\n   - Only 7 unique mai-* classes, all in base.html navbar\n   - ~15 Stroke-7 icons (s7-*) across 21 files\n   - We already use Font Awesome everywhere else\n3. Migration to BS5 is manageable (1-2 days effort)\n\nDecision: Migrate to Bootstrap 5.3 instead of staying on BS4.\n\n## What to add to CLAUDE.md\n\nAdd a new section \"## Frontend / Bootstrap\" with:\n\n### Current State (after migration)\n- Bootstrap version: 5.3.x (migrated from 4.3.1 in Jan 2026)\n- Theme: Custom styling based on former Maisonnette theme (discontinued)\n- Icons: Font Awesome 6.x (removed Stroke-7 icons)\n- No jQuery dependency (BS5 is vanilla JS)\n\n### Bootstrap 5 Class Reference\nCommon utility classes (BS5 naming):\n- Spacing: me-*, ms-*, pe-*, ps-* (margin/padding end/start)\n- Floats: float-end, float-start\n- Text: text-end, text-start  \n- Borders: border-end, border-start\n- Screen readers: visually-hidden\n- Flex gaps: gap-*, row-gap-*, column-gap-*\n\n### Data Attributes\nBS5 uses data-bs-* prefix:\n- data-bs-toggle (not data-toggle)\n- data-bs-dismiss (not data-dismiss)\n- data-bs-target (not data-target)\n\n### JavaScript API\nBS5 doesn't require jQuery. Bootstrap components accessed via:\n```javascript\n// Modal example\nconst modal = new bootstrap.Modal(document.getElementById('myModal'));\nmodal.show();\n\n// Tooltip example  \nconst tooltipList = [...document.querySelectorAll('[data-bs-toggle=\"tooltip\"]')]\n  .map(el =\u003e new bootstrap.Tooltip(el));\n```\n\n### Theme Files\n- static/css/app.css - Main theme CSS (slimmed down from Maisonnette)\n- static/css/themes/*.css - Color theme variants\n- static/css/themes.css - Theme switching support\n\n### Migration History\n- Pre-2026: Bootstrap 4.3.1 + Maisonnette admin theme v1.3.2\n- Jan 2026: Migrated to Bootstrap 5.3, removed Maisonnette dependency\n- Maisonnette was discontinued (Bootstrap Themes marketplace shutdown)","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:40:50.763261124Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:40:50.763261124Z","dependencies":[{"issue_id":"battycoda-6nn.9","depends_on_id":"battycoda-6nn","type":"parent-child","created_at":"2026-01-13T23:40:50.766403665Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-881","title":"Write unit tests for utility modules","description":"## Task\nWrite unit tests for standalone utility modules.\n\n## Files to Test\n- static/js/datetime_formatter.js\n- static/js/theme-switcher.js\n- static/js/notifications.js\n- static/js/upload_progress.js\n- static/js/taskbatch/name_validator.js\n\n## Test Cases\n\n### datetime_formatter.test.js\n```javascript\nimport { describe, it, expect } from 'vitest';\nimport { formatDuration, formatTimestamp, formatRelativeTime } from './datetime_formatter.js';\n\ndescribe('formatDuration', () =\u003e {\n  it('formats seconds to mm:ss', () =\u003e {\n    expect(formatDuration(65)).toBe('1:05');\n    expect(formatDuration(3661)).toBe('1:01:01');\n  });\n  \n  it('handles zero', () =\u003e {\n    expect(formatDuration(0)).toBe('0:00');\n  });\n  \n  it('handles fractional seconds', () =\u003e {\n    expect(formatDuration(65.7)).toBe('1:05');\n  });\n});\n\ndescribe('formatRelativeTime', () =\u003e {\n  it('formats recent timestamps as \"just now\"', () =\u003e {\n    const now = new Date();\n    expect(formatRelativeTime(now)).toBe('just now');\n  });\n  \n  it('formats minutes ago', () =\u003e {\n    const fiveMinAgo = new Date(Date.now() - 5 * 60 * 1000);\n    expect(formatRelativeTime(fiveMinAgo)).toBe('5 minutes ago');\n  });\n});\n```\n\n### theme-switcher.test.js\n```javascript\ndescribe('ThemeSwitcher', () =\u003e {\n  describe('setTheme', () =\u003e {\n    it('updates body class', () =\u003e {\n      document.body.className = 'theme-default';\n      \n      setTheme('dark');\n      \n      expect(document.body.classList.contains('theme-dark')).toBe(true);\n      expect(document.body.classList.contains('theme-default')).toBe(false);\n    });\n    \n    it('persists theme to localStorage', () =\u003e {\n      setTheme('dark');\n      expect(localStorage.getItem('theme')).toBe('dark');\n    });\n  });\n  \n  describe('getTheme', () =\u003e {\n    it('returns current theme from body class', () =\u003e {\n      document.body.className = 'theme-ocean';\n      expect(getTheme()).toBe('ocean');\n    });\n  });\n});\n```\n\n### name_validator.test.js\n```javascript\ndescribe('TaskBatchNameValidator', () =\u003e {\n  describe('validateName', () =\u003e {\n    it('rejects empty names', () =\u003e {\n      expect(validateName('')).toEqual({\n        valid: false,\n        error: 'Name is required'\n      });\n    });\n    \n    it('rejects names over 255 chars', () =\u003e {\n      const longName = 'a'.repeat(256);\n      expect(validateName(longName).valid).toBe(false);\n    });\n    \n    it('accepts valid names', () =\u003e {\n      expect(validateName('My Batch 2024')).toEqual({\n        valid: true,\n        error: null\n      });\n    });\n  });\n});\n```\n\n## Test Approach\n- These are mostly pure functions, easy to test\n- Mock localStorage for theme tests\n- Mock DOM for some formatters\n\n## Coverage Target\n- datetime_formatter.js: 95%+\n- theme-switcher.js: 90%+\n- name_validator.js: 95%+\n- notifications.js: 70%+ (more async)\n- upload_progress.js: 75%+\n\n## Files Created\n- static/js/datetime_formatter.test.js\n- static/js/theme-switcher.test.js\n- static/js/notifications.test.js\n- static/js/upload_progress.test.js\n- static/js/taskbatch/name_validator.test.js\n\n## Verification\n- All tests pass\n- High coverage on utility functions\n- Tests document expected behavior","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:08:40.267855119Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:08:40.267855119Z","dependencies":[{"issue_id":"battycoda-881","depends_on_id":"battycoda-gr3","type":"blocks","created_at":"2026-01-13T23:20:15.818712211Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-8ra","title":"Write E2E tests for task annotation","description":"## Task\nWrite Playwright E2E tests for the task annotation workflow.\n\n## Test Cases\n\n### tests/e2e/specs/tasks.spec.js\n```javascript\nimport { test, expect } from '@playwright/test';\nimport { login } from '../helpers/auth.js';\nimport users from '../fixtures/users.json';\n\ntest.describe('Task Annotation', () =\u003e {\n  test.beforeEach(async ({ page }) =\u003e {\n    await login(page, users.testUser.email, users.testUser.password);\n  });\n  \n  test.describe('Task Batches', () =\u003e {\n    test('list task batches', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/');\n      \n      await expect(page.locator('table, .batch-list')).toBeVisible();\n    });\n    \n    test('create new task batch', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/create/');\n      \n      await page.fill('input[name=\"name\"]', 'E2E Test Batch');\n      await page.selectOption('select[name=\"segmentation\"]', { index: 1 });\n      await page.click('button[type=\"submit\"]');\n      \n      await expect(page.locator('.alert-success')).toBeVisible();\n    });\n  });\n  \n  test.describe('Task Annotation Interface', () =\u003e {\n    test('annotation page loads', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/annotate/');\n      \n      // Check main components present\n      await expect(page.locator('.waveform-player, #waveform')).toBeVisible();\n      await expect(page.locator('.call-buttons, .call-type-select')).toBeVisible();\n    });\n    \n    test('select call type for segment', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/annotate/');\n      \n      // Click a call type button\n      await page.click('.call-btn:first-child, button[data-call-type]');\n      \n      // Should show selected state\n      await expect(page.locator('.selected, .active')).toBeVisible();\n    });\n    \n    test('save annotation and advance', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/annotate/');\n      \n      // Select a call type\n      await page.click('.call-btn:first-child');\n      \n      // Save\n      await page.click('button:has-text(\"Save\"), #save-btn');\n      \n      // Should advance to next task or show completion\n      await expect(page.locator('.alert-success, .next-task')).toBeVisible();\n    });\n    \n    test('skip task', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/annotate/');\n      \n      await page.click('button:has-text(\"Skip\"), #skip-btn');\n      \n      // Should advance\n    });\n    \n    test('play audio segment', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/annotate/');\n      \n      await page.click('#play-btn, .play-button');\n      \n      // Audio should play (hard to verify, check no errors)\n    });\n    \n    test('keyboard shortcuts work', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/annotate/');\n      \n      // Press spacebar to play\n      await page.keyboard.press('Space');\n      \n      // Press number key for call type\n      await page.keyboard.press('1');\n      \n      // Press Enter to save\n      await page.keyboard.press('Enter');\n    });\n  });\n  \n  test.describe('Task Review', () =\u003e {\n    test('batch review page loads', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/review/');\n      \n      await expect(page.locator('table, .task-list')).toBeVisible();\n    });\n    \n    test('filter by status', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/review/');\n      \n      await page.selectOption('select[name=\"status\"]', 'completed');\n      await page.click('button:has-text(\"Filter\")');\n      \n      // Results should filter\n    });\n  });\n});\n```\n\n## Files Created\n- tests/e2e/specs/tasks.spec.js\n\n## Prerequisites\n- Test data includes at least one task batch with tasks\n\n## Verification\n- All task tests pass\n- Annotation workflow works end-to-end\n- Keyboard shortcuts function correctly","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:11:06.16396858Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:11:06.16396858Z","dependencies":[{"issue_id":"battycoda-8ra","depends_on_id":"battycoda-hxh","type":"blocks","created_at":"2026-01-13T23:20:18.334217826Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-965","title":"Install and configure Playwright","description":"## Task\nInstall Playwright and configure for testing BattyCoda.\n\n## Steps\n\n### 1. Install Playwright\n```bash\nnpm install --save-dev @playwright/test\nnpx playwright install  # Downloads browser binaries\n```\n\n### 2. Create playwright.config.js\n```javascript\n// tests/e2e/playwright.config.js\nimport { defineConfig, devices } from '@playwright/test';\n\nexport default defineConfig({\n  testDir: './tests/e2e/specs',\n  \n  // Run tests in parallel\n  fullyParallel: true,\n  \n  // Fail fast on CI\n  forbidOnly: !!process.env.CI,\n  \n  // Retry failed tests\n  retries: process.env.CI ? 2 : 0,\n  \n  // Reporter\n  reporter: [\n    ['html', { outputFolder: 'playwright-report' }],\n    ['list'],\n  ],\n  \n  // Shared settings for all projects\n  use: {\n    // Base URL for Django\n    baseURL: process.env.BASE_URL || 'http://localhost:8000',\n    \n    // Collect trace on failure\n    trace: 'on-first-retry',\n    \n    // Screenshot on failure\n    screenshot: 'only-on-failure',\n    \n    // Video on failure\n    video: 'on-first-retry',\n  },\n  \n  // Configure projects for cross-browser testing\n  projects: [\n    {\n      name: 'chromium',\n      use: { ...devices['Desktop Chrome'] },\n    },\n    {\n      name: 'firefox',\n      use: { ...devices['Desktop Firefox'] },\n    },\n    {\n      name: 'webkit',\n      use: { ...devices['Desktop Safari'] },\n    },\n  ],\n  \n  // Start Django dev server before tests\n  webServer: {\n    command: 'python manage.py runserver 8000',\n    url: 'http://localhost:8000',\n    reuseExistingServer: !process.env.CI,\n    timeout: 120000,\n  },\n});\n```\n\n### 3. Add npm scripts\n```json\n{\n  \"scripts\": {\n    \"e2e\": \"playwright test\",\n    \"e2e:headed\": \"playwright test --headed\",\n    \"e2e:ui\": \"playwright test --ui\",\n    \"e2e:report\": \"playwright show-report\"\n  }\n}\n```\n\n### 4. Create test fixtures directory\n```bash\nmkdir -p tests/e2e/specs tests/e2e/fixtures tests/e2e/helpers\n```\n\n### 5. Create test helper for authentication\n```javascript\n// tests/e2e/helpers/auth.js\nexport async function login(page, email, password) {\n  await page.goto('/accounts/login/');\n  await page.fill('input[name=\"email\"]', email);\n  await page.fill('input[name=\"password\"]', password);\n  await page.click('button[type=\"submit\"]');\n  await page.waitForURL('/');\n}\n\nexport async function createTestUser(page, userData) {\n  // Uses Django management command or API\n}\n```\n\n### 6. Create test data fixture\n```javascript\n// tests/e2e/fixtures/users.json\n{\n  \"testUser\": {\n    \"email\": \"test@example.com\",\n    \"password\": \"testpass123\",\n    \"username\": \"testuser\"\n  },\n  \"adminUser\": {\n    \"email\": \"admin@example.com\",\n    \"password\": \"adminpass123\",\n    \"username\": \"admin\"\n  }\n}\n```\n\n### 7. Add to .gitignore\n```\nplaywright-report/\ntest-results/\n```\n\n## Files Created\n- tests/e2e/playwright.config.js\n- tests/e2e/helpers/auth.js\n- tests/e2e/fixtures/users.json\n- package.json (updated scripts)\n- .gitignore (updated)\n\n## Verification\n- `npm run e2e` runs (even with no tests yet)\n- `npm run e2e:ui` opens Playwright UI\n- Browser binaries are installed","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:10:53.615891983Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:10:53.615891983Z","dependencies":[{"issue_id":"battycoda-965","depends_on_id":"battycoda-10n","type":"blocks","created_at":"2026-01-13T23:20:17.727861903Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-9pz","title":"Remove debug print statements from production code","description":"## Problem\nDebug print() statements left in production code. Should be removed or converted to proper logging.\n\n## Files to Clean\n\n### battycoda_app/views_group.py\n- Lines 27-29: Debug prints in group_list_view()\n- Lines 47-54: Debug prints in group_detail_view()\n- Lines 100, 104: Debug prints in group creation\n\n### battycoda_app/audio/task_modules/training_tasks.py\n- Lines 104, 113, 121, 125: Training job status prints\n- Lines 190-191, 214: Model training debug output\n- Lines 431-433, 476-480, 483, 498, 501: Additional training debug prints\n\n### battycoda_app/audio/task_modules/queue_processor.py\n- Lines 45, 68, 72: Queue processing debug\n- Lines 94, 103, 107: Classification run debug\n\n### battycoda_app/audio/task_modules/classification/run_classification.py\n- Lines 75, 121, 142: Classification setup debug\n- Lines 187, 198, 283, 337: Classification processing debug\n\n### battycoda_app/views_classification/runs_details.py\n- Line 181: Debug print in runs details\n\n### battycoda_app/views_classification/task_creation/batch_creation.py\n- Lines 80-81: Batch creation debug prints\n\n## Fix\nRemove print() calls or replace with proper logging:\nimport logging\nlogger = logging.getLogger(__name__)\nlogger.debug(f'Processing {item}')\n\n## Verification\ngrep -rn 'print(' battycoda_app/ | grep -v test | grep -v '.pyc'","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T01:20:45.634741641Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T01:20:45.634741641Z"}
{"id":"battycoda-a16","title":"Add custom 404 and 500 error pages","description":"## Problem\nUsing Django default error pages which are unprofessional and don't match the app's styling.\n\n## Solution\n\n### 1. Create 404.html\n```html\n\u003c!-- templates/404.html --\u003e\n{% extends \"base.html\" %}\n\n{% block title %}Page Not Found - BattyCoda{% endblock %}\n\n{% block content %}\n\u003cdiv class=\"container text-center py-5\"\u003e\n    \u003ch1 class=\"display-1\"\u003e404\u003c/h1\u003e\n    \u003ch2\u003ePage Not Found\u003c/h2\u003e\n    \u003cp class=\"lead\"\u003eThe page you're looking for doesn't exist or has been moved.\u003c/p\u003e\n    \u003ca href=\"{% url 'battycoda_app:index' %}\" class=\"btn btn-primary mt-3\"\u003e\n        \u003cspan class=\"s7-home mr-1\"\u003e\u003c/span\u003e Return Home\n    \u003c/a\u003e\n\u003c/div\u003e\n{% endblock %}\n```\n\n### 2. Create 500.html\n```html\n\u003c!-- templates/500.html --\u003e\n{% extends \"base_minimal.html\" %}  {# Use minimal base in case error is in base.html #}\n\n{% block title %}Server Error - BattyCoda{% endblock %}\n\n{% block content %}\n\u003cdiv class=\"container text-center py-5\"\u003e\n    \u003ch1 class=\"display-1\"\u003e500\u003c/h1\u003e\n    \u003ch2\u003eSomething Went Wrong\u003c/h2\u003e\n    \u003cp class=\"lead\"\u003eWe've been notified and are working to fix it.\u003c/p\u003e\n    \u003cp\u003eIf the problem persists, please contact support.\u003c/p\u003e\n    \u003ca href=\"/\" class=\"btn btn-primary mt-3\"\u003eReturn Home\u003c/a\u003e\n\u003c/div\u003e\n{% endblock %}\n```\n\n### 3. Create minimal base template for 500 errors\n```html\n\u003c!-- templates/base_minimal.html --\u003e\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n\u003chead\u003e\n    \u003ctitle\u003e{% block title %}BattyCoda{% endblock %}\u003c/title\u003e\n    \u003clink rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css\"\u003e\n    \u003cstyle\u003e\n        body { padding-top: 50px; }\n        .display-1 { font-size: 6rem; color: #dc3545; }\n    \u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n    {% block content %}{% endblock %}\n\u003c/body\u003e\n\u003c/html\u003e\n```\n\n### 4. Create 403.html (optional)\n```html\n\u003c!-- templates/403.html --\u003e\n{% extends \"base.html\" %}\n\n{% block content %}\n\u003cdiv class=\"container text-center py-5\"\u003e\n    \u003ch1 class=\"display-1\"\u003e403\u003c/h1\u003e\n    \u003ch2\u003eAccess Denied\u003c/h2\u003e\n    \u003cp class=\"lead\"\u003eYou don't have permission to access this page.\u003c/p\u003e\n\u003c/div\u003e\n{% endblock %}\n```\n\n## Verification\n- Set DEBUG=False\n- Visit /nonexistent-page/ - should show styled 404\n- Trigger a 500 error - should show styled 500\n- Pages load even if database is down (500 page)","status":"closed","priority":3,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T00:06:12.018869159Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:59:19.054141372Z","closed_at":"2026-01-13T18:55:36.734885-06:00"}
{"id":"battycoda-bj9","title":"Extract hardcoded /app paths to settings","description":"## Problem\nMultiple files have hardcoded `/app` paths for Docker/R server communication. This breaks when directory structure changes.\n\n## Locations\n\n### battycoda_app/utils_modules/species_utils.py\n- Line 122: `image_path = f\"/app/data/species_images/{image_filename}\"`\n- Line 146: `folder_path.replace(str(settings.BASE_DIR), '/app')`\n- Line 177: Same pattern\n\n### battycoda_app/audio/task_modules/classification/run_classification.py\n- Line 63: `r_server_path = os.path.join('/app', 'tmp', batch_dir_name)`\n- Line 67: Similar\n\n### battycoda_app/audio/task_modules/training_tasks.py\n- Line 69: `temp_dir = os.path.join(\"/app/tmp\", f\"training_{model_hash}\")`\n- Lines 396-397: Path replacement\n\n### battycoda_app/models/user/profile.py\n- Lines 169, 190, 214: Hardcoded `/home/ubuntu/battycoda/media` default\n\n## Solution\n\n### 1. Add settings\n```python\n# config/settings.py\n\n# R Server path mapping (for Docker or local)\nR_SERVER_BASE_PATH = os.environ.get('R_SERVER_BASE_PATH', str(BASE_DIR))\nR_SERVER_TMP_DIR = os.environ.get('R_SERVER_TMP_DIR', '/tmp')\n```\n\n### 2. Create path utility\n```python\n# battycoda_app/utils/paths.py\n\nfrom django.conf import settings\n\ndef get_r_server_path(local_path: str) -\u003e str:\n    \"\"\"Convert local path to R server path.\"\"\"\n    base = str(settings.BASE_DIR)\n    r_base = getattr(settings, 'R_SERVER_BASE_PATH', base)\n    return local_path.replace(base, r_base)\n\ndef get_r_server_tmp() -\u003e str:\n    \"\"\"Get R server temp directory.\"\"\"\n    return getattr(settings, 'R_SERVER_TMP_DIR', '/tmp')\n```\n\n### 3. Update files to use utility\n```python\n# Before\nr_server_path = os.path.join('/app', 'tmp', batch_dir_name)\n\n# After\nfrom battycoda_app.utils.paths import get_r_server_tmp\nr_server_path = os.path.join(get_r_server_tmp(), batch_dir_name)\n```\n\n## Verification\n- grep -r '\"/app' battycoda_app/ returns 0 results\n- R server integration still works\n- Local development still works","status":"closed","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T00:04:48.254815413Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:59:19.05901855Z","closed_at":"2026-01-13T18:50:32.89727-06:00"}
{"id":"battycoda-c7o","title":"Update Django templates to use Vite bundles","description":"## Task\nUpdate all Django templates to load JavaScript from Vite bundles instead of individual script tags.\n\n## Steps\n\n### 1. Update base.html\nReplace individual script includes with Vite bundle:\n\nBefore:\n```html\n\u003cscript src=\"{% static 'js/datetime_formatter.js' %}\"\u003e\u003c/script\u003e\n\u003cscript src=\"{% static 'js/theme-switcher.js' %}\"\u003e\u003c/script\u003e\n```\n\nAfter:\n```html\n{% load vite %}\n{% vite_asset 'main.js' %}\n```\n\n### 2. Fix extra_js block ordering (resolves yf0.1)\nMove extra_js block AFTER jQuery and other dependencies:\n\n```html\n\u003c!-- CDN scripts (jQuery, Bootstrap, etc.) --\u003e\n\u003cscript src=\"https://code.jquery.com/jquery-3.3.1.min.js\"\u003e\u003c/script\u003e\n...\n\n\u003c!-- Then extra_js block --\u003e\n{% block extra_js %}{% endblock %}\n```\n\n### 3. Update page-specific templates\nTemplates that need updates:\n\n| Template | Current Scripts | New Entry Point |\n|----------|-----------------|-----------------|\n| recording_detail.html | player/*.js | player.js |\n| cluster_explorer.html | cluster_explorer/*.js | clusterExplorer.js |\n| cluster_mapping.html | cluster_mapping/*.js | clusterMapping.js |\n| recording_upload.html | file_upload/*.js | fileUpload.js |\n| segmentation_detail.html | segmentation/*.js | segmentation.js |\n| task_*.html | task_annotation.js | taskAnnotation.js |\n\n### 4. Handle inline scripts\nMany templates have inline \u003cscript\u003e blocks. Options:\na) Keep as inline (simplest)\nb) Move to separate modules (cleaner)\nc) Use data attributes to pass Django context to JS\n\nRecommended: Use data attributes pattern:\n```html\n\u003cdiv id=\"app\" \n     data-recording-id=\"{{ recording.id }}\"\n     data-api-url=\"{% url 'api:endpoint' %}\"\u003e\n\u003c/div\u003e\n```\n\n### 5. Test each page\n- Verify all JS functionality works\n- Check browser console for errors\n- Test both dev mode (Vite server) and prod mode (built bundles)\n\n## Templates to Update (comprehensive list)\n- templates/base.html\n- templates/recordings/recording_detail.html\n- templates/recordings/recording_upload.html\n- templates/clustering/cluster_explorer.html\n- templates/clustering/cluster_mapping.html\n- templates/clustering/create_run.html\n- templates/segmentation/segmentation_detail.html\n- templates/tasks/task_detail.html\n- templates/tasks/task_annotation.html\n- templates/auth/register.html\n\n## Verification\n- All pages load without JS errors\n- All interactive features work\n- Dev server HMR works for CSS/JS changes\n- Production build works with collectstatic","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:05:15.724666217Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:05:15.724666217Z","dependencies":[{"issue_id":"battycoda-c7o","depends_on_id":"battycoda-zj8","type":"blocks","created_at":"2026-01-13T23:20:13.34700761Z","created_by":"Kevin Boergens"},{"issue_id":"battycoda-c7o","depends_on_id":"battycoda-czw","type":"blocks","created_at":"2026-01-13T23:33:38.973236188Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-czw","title":"Create incremental migration path with rollback plan","description":"## Problem\nBig-bang migration is risky. Need:\n1. Incremental migration (page by page)\n2. Ability to run old and new JS simultaneously\n3. Clear rollback procedure\n\n## Incremental Migration Strategy\n\n### Phase 1: Parallel Loading (Week 1)\nRun Vite alongside existing scripts without breaking anything.\n\n```html\n\u003c!-- base.html --\u003e\n\u003c!-- Keep all existing script tags --\u003e\n\u003cscript src=\"{% static 'js/app.js' %}\"\u003e\u003c/script\u003e\n\u003c!-- ... --\u003e\n\n\u003c!-- Add Vite bundle at the end (does nothing yet) --\u003e\n{% if VITE_ENABLED %}\n  {% vite_asset 'main.js' %}\n{% endif %}\n```\n\n### Phase 2: Feature Flags (Week 2)\nMigrate one feature at a time with flags.\n\n```python\n# settings.py\nVITE_FEATURES = {\n  'cluster_explorer': True,   # Migrated\n  'player': False,            # Not yet\n  'task_annotation': False,   # Not yet\n}\n```\n\n```html\n\u003c!-- cluster_explorer.html --\u003e\n{% if VITE_FEATURES.cluster_explorer %}\n  {% vite_asset 'clusterExplorer.js' %}\n{% else %}\n  \u003cscript src=\"{% static 'js/cluster_explorer/visualization.js' %}\"\u003e\u003c/script\u003e\n  \u003c!-- old scripts --\u003e\n{% endif %}\n```\n\n### Phase 3: Progressive Rollout (Weeks 3-4)\nEnable features one by one, test in production.\n\n### Phase 4: Cleanup (Week 5)\nRemove old script tags and feature flags once all migrated.\n\n## Rollback Procedures\n\n### Level 1: Disable Single Feature\n```python\n# settings.py\nVITE_FEATURES = {\n  'cluster_explorer': False,  # Rollback this feature\n}\n```\n\n### Level 2: Disable All Vite\n```python\n# settings.py\nVITE_ENABLED = False\n```\n\n### Level 3: Full Revert\n```bash\n# Revert to pre-Vite commit\ngit revert HEAD~n..HEAD  # Or specific commits\nsudo systemctl restart battycoda\n```\n\n## Testing Checklist Per Feature\n\nBefore enabling a feature in production:\n- [ ] Unit tests pass\n- [ ] E2E tests pass for this feature\n- [ ] Manual testing on staging\n- [ ] Performance comparison (bundle size, load time)\n- [ ] No console errors\n- [ ] All browsers tested\n\n## Migration Order (Suggested)\n\n| Order | Feature | Risk | Complexity |\n|-------|---------|------|------------|\n| 1 | theme-switcher | Low | Low |\n| 2 | notifications | Low | Low |\n| 3 | datetime_formatter | Low | Low |\n| 4 | file_upload | Medium | Medium |\n| 5 | cluster_explorer | Medium | High |\n| 6 | cluster_mapping | Medium | High |\n| 7 | player | High | High |\n| 8 | task_annotation | High | High |\n| 9 | segmentation | Medium | Medium |\n\nStart with low-risk, low-complexity features to build confidence.\n\n## Implementation Steps\n\n### 1. Add feature flag infrastructure\n```python\n# battycoda_app/context_processors.py\ndef vite_features(request):\n    from django.conf import settings\n    return {\n        'VITE_ENABLED': getattr(settings, 'VITE_ENABLED', False),\n        'VITE_FEATURES': getattr(settings, 'VITE_FEATURES', {}),\n    }\n```\n\n### 2. Update settings.py\n```python\nVITE_ENABLED = os.environ.get('VITE_ENABLED', 'false').lower() == 'true'\nVITE_FEATURES = {\n    'theme_switcher': VITE_ENABLED,\n    'notifications': VITE_ENABLED,\n    # ... etc\n}\n```\n\n### 3. Create rollback documentation\nDocument exact steps to rollback in CLAUDE.md and runbook.\n\n## Files Created/Modified\n- battycoda_app/context_processors.py (add vite_features)\n- config/settings.py (add VITE_ENABLED, VITE_FEATURES)\n- templates/base.html (conditional loading)\n- CLAUDE.md (rollback documentation)\n\n## Verification\n- Can enable/disable individual features\n- Rollback procedure tested\n- No regressions when features disabled","status":"closed","priority":0,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:29:23.401843894Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T01:30:25.458359036Z","closed_at":"2026-01-14T01:30:25.458359036Z","close_reason":"Implemented incremental Vite migration infrastructure: added vite_features context processor, VITE_ENABLED/VITE_FEATURES settings with environment variable support, conditional script loading in base.html, and documented rollback procedures in CLAUDE.md"}
{"id":"battycoda-d0e","title":"Handle CDN dependencies (jQuery, D3, Bootstrap JS)","description":"## Problem\nCurrently loading several libraries via CDN:\n- jQuery 3.3.1\n- Bootstrap 4.3.1 JS\n- Popper.js\n- Toastr\n- Select2\n- D3.js (in cluster visualization)\n- Perfect Scrollbar\n\nNeed to decide: bundle with Vite or keep as CDN externals?\n\n## Options Analysis\n\n### Option A: Keep as CDN Externals (Recommended for most)\n```javascript\n// vite.config.js\nexport default defineConfig({\n  build: {\n    rollupOptions: {\n      external: ['jquery', 'd3'],\n      output: {\n        globals: {\n          jquery: 'jQuery',\n          d3: 'd3'\n        }\n      }\n    }\n  }\n});\n```\n\n**Pros:**\n- Leverage browser caching across sites\n- Faster initial setup\n- No bundle size increase\n- CDN edge servers = fast delivery\n\n**Cons:**\n- External dependency on CDN availability\n- Version mismatch risks\n- Can't tree-shake unused code\n\n### Option B: Bundle Everything\n```bash\nnpm install jquery d3 bootstrap@4 toastr select2\n```\n\n**Pros:**\n- Single source of truth\n- Tree shaking removes unused code\n- Works offline\n- Version locked in package.json\n\n**Cons:**\n- Larger bundle size\n- More migration work\n- Potential jQuery plugin compatibility issues\n\n## Recommendation\n**Hybrid approach:**\n\n| Library | Decision | Reason |\n|---------|----------|--------|\n| jQuery | CDN External | Deep integration, plugin ecosystem |\n| Bootstrap JS | CDN External | Tied to jQuery, small usage |\n| Popper.js | CDN External | Bootstrap dependency |\n| D3.js | **Bundle** | Heavy usage, tree-shake benefits |\n| Toastr | CDN External | Small, simple usage |\n| Select2 | CDN External | jQuery plugin |\n| Perfect Scrollbar | CDN External | Minimal usage |\n\n## Implementation Steps\n\n### 1. Configure Vite externals\n```javascript\n// vite.config.js\nexport default defineConfig({\n  build: {\n    rollupOptions: {\n      external: ['jquery'],\n      output: {\n        globals: {\n          jquery: '$',\n          jQuery: '$'\n        }\n      }\n    }\n  },\n  resolve: {\n    alias: {\n      // Allow importing jQuery in modules (uses global)\n      'jquery': 'jquery/dist/jquery.slim.min.js'\n    }\n  }\n});\n```\n\n### 2. Install D3 as npm dependency\n```bash\nnpm install d3\n```\n\n### 3. Update cluster_explorer to import D3\n```javascript\n// Before (global)\nconst colorScale = d3.scaleOrdinal(d3.schemeCategory10);\n\n// After (module)\nimport * as d3 from 'd3';\n// Or tree-shake:\nimport { scaleOrdinal, schemeCategory10 } from 'd3';\n```\n\n### 4. Ensure global jQuery available for legacy code\n```javascript\n// In main.js or setup\nimport jQuery from 'jquery';\nwindow.$ = window.jQuery = jQuery;\n```\n\n### 5. Document CDN dependencies\nAdd to CLAUDE.md and README which libraries are CDN vs bundled.\n\n## Files Modified\n- vite.config.js\n- package.json\n- static/js/cluster_explorer/visualization.js\n- CLAUDE.md\n\n## Verification\n- D3 visualizations still work\n- jQuery plugins (Select2, Toastr) still work\n- No duplicate library loading\n- Bundle size reasonable","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:28:16.538238934Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:28:16.538238934Z","dependencies":[{"issue_id":"battycoda-d0e","depends_on_id":"battycoda-3vv","type":"blocks","created_at":"2026-01-13T23:33:30.690023565Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-dkw","title":"Write unit tests for cluster_explorer module","description":"## Task\nWrite comprehensive unit tests for the cluster_explorer module.\n\n## Files to Test\n- static/js/cluster_explorer/data_loader.js\n- static/js/cluster_explorer/controls.js\n- static/js/cluster_explorer/interactions.js\n- static/js/cluster_explorer/visualization.js\n\n## Test Cases\n\n### data_loader.test.js\n```javascript\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { loadClusterData, parseClusterResponse } from './data_loader.js';\n\ndescribe('loadClusterData', () =\u003e {\n  beforeEach(() =\u003e {\n    fetch.mockClear();\n  });\n\n  it('fetches cluster data from correct URL', async () =\u003e {\n    fetch.mockResolvedValueOnce({\n      ok: true,\n      json: () =\u003e Promise.resolve({ clusters: [] })\n    });\n    \n    await loadClusterData(123);\n    \n    expect(fetch).toHaveBeenCalledWith(\n      expect.stringContaining('/clustering/get-cluster-data/')\n    );\n  });\n\n  it('handles API errors gracefully', async () =\u003e {\n    fetch.mockRejectedValueOnce(new Error('Network error'));\n    \n    await expect(loadClusterData(123)).rejects.toThrow('Network error');\n  });\n});\n\ndescribe('parseClusterResponse', () =\u003e {\n  it('transforms API response to internal format', () =\u003e {\n    const apiResponse = {\n      clusters: [\n        { id: 1, label: 'Call A', size: 10 }\n      ]\n    };\n    \n    const result = parseClusterResponse(apiResponse);\n    \n    expect(result).toHaveLength(1);\n    expect(result[0]).toMatchObject({\n      id: 1,\n      label: 'Call A',\n      size: 10\n    });\n  });\n\n  it('handles empty cluster list', () =\u003e {\n    const result = parseClusterResponse({ clusters: [] });\n    expect(result).toEqual([]);\n  });\n});\n```\n\n### controls.test.js\nTest slider controls, filter logic, etc.\n\n### visualization.test.js\nTest data transformations (not D3 rendering):\n- Scale calculations\n- Color assignments\n- Coordinate transformations\n\n## Test Approach\n1. Mock D3 and DOM dependencies\n2. Test data transformation logic\n3. Test event handler callbacks (not DOM events)\n4. Use fixtures for consistent test data\n\n## Coverage Target\n- data_loader.js: 90%+\n- controls.js: 80%+\n- interactions.js: 70%+ (more DOM-dependent)\n- visualization.js: 60%+ (heavy D3 usage)\n\n## Files Created\n- static/js/cluster_explorer/data_loader.test.js\n- static/js/cluster_explorer/controls.test.js\n- static/js/cluster_explorer/interactions.test.js\n- static/js/cluster_explorer/visualization.test.js\n- static/js/test/fixtures/clusters.json\n\n## Verification\n- All tests pass\n- Coverage meets targets\n- Tests are meaningful (not just for coverage)","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:08:33.527534502Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:08:33.527534502Z","dependencies":[{"issue_id":"battycoda-dkw","depends_on_id":"battycoda-gr3","type":"blocks","created_at":"2026-01-13T23:20:15.606362262Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-dl6","title":"Remove dead code: unused functions and commented-out blocks","description":"## Problem\nDead code cluttering the codebase - unused functions and commented-out code blocks.\n\n## Commented-Out Code to Delete\n\n### battycoda_app/signals.py (Lines 12-19)\nCommented signal handlers that duplicate functionality in models/user/utils.py:\n# @receiver(post_save, sender=User)\n# def create_profile(...) / save_profile(...)\n\n### battycoda_app/views_common.py (Lines 6-7, 30-31)\nCommented-out logging imports that were never cleaned up.\n\n### battycoda_app/tests/test_settings.py (Lines 7-8, 50)\nReferences to generate_spectrograms method that no longer exists.\n\n## Unused Functions to Delete\n\n### battycoda_app/tasks.py (Lines 8-17)\nprocess_audio_file() - placeholder Celery task never called anywhere.\n\n### battycoda_app/audio/task_modules/base.py (Lines 13-18)\nlog_performance() - calculates elapsed time but never actually logs anything.\n\n## Verification\n- grep for function names to confirm no usages\n- Run tests after deletion","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T01:21:05.543638056Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T01:21:05.543638056Z"}
{"id":"battycoda-dlu","title":"Add tests for Simple API endpoints","description":"## Problem\nZero test coverage for the Simple API layer (9 files, ~700+ lines).\n\n## Files Needing Tests\n- simple_api/auth.py - API authentication\n- simple_api/classification_views.py - Classification endpoints\n- simple_api/segmentation_views.py - Segmentation endpoints  \n- simple_api/data_views.py - Data export\n- simple_api/recording_upload.py - Recording upload (supports auto-split)\n- simple_api/task_views.py - Task management\n- simple_api/user_views.py - User management\n- simple_api/pickle_upload.py - Batch pickle upload\n\n## Test File to Create\n```python\n# battycoda_app/tests/test_simple_api.py\n\nfrom django.test import TestCase, Client\nfrom django.urls import reverse\nfrom django.contrib.auth.models import User\nfrom battycoda_app.models import Group, Project, Species, Recording\n\nclass SimpleAPITestCase(TestCase):\n    def setUp(self):\n        self.client = Client()\n        self.user = User.objects.create_user('testuser', 'test@test.com', 'password')\n        self.group = Group.objects.create(name='Test Group', created_by=self.user)\n        # ... setup species, project, etc.\n\nclass RecordingUploadAPITests(SimpleAPITestCase):\n    def test_upload_requires_auth(self):\n        response = self.client.post('/api/recordings/upload/')\n        self.assertEqual(response.status_code, 401)\n    \n    def test_upload_valid_wav(self):\n        self.client.login(username='testuser', password='password')\n        with open('test_fixtures/short.wav', 'rb') as f:\n            response = self.client.post('/api/recordings/upload/', {\n                'file': f,\n                'project_id': self.project.id,\n            })\n        self.assertEqual(response.status_code, 200)\n        self.assertTrue(response.json()['success'])\n    \n    def test_upload_auto_split_long_file(self):\n        # Test 60+ second file gets split\n        pass\n    \n    def test_upload_invalid_file_type(self):\n        # Test non-audio file rejected\n        pass\n\nclass ClassificationAPITests(SimpleAPITestCase):\n    def test_create_classification_run(self):\n        pass\n    \n    def test_get_classification_results(self):\n        pass\n\nclass TaskAPITests(SimpleAPITestCase):\n    def test_get_tasks_pagination(self):\n        # Test limit/offset parameters\n        pass\n    \n    def test_invalid_limit_parameter(self):\n        # Should handle ?limit=abc gracefully\n        pass\n```\n\n## Key Test Cases\n\n### Authentication\n- Unauthenticated requests return 401\n- Wrong credentials return 401\n- Valid token/session allows access\n\n### Recording Upload\n- Valid WAV upload succeeds\n- Invalid file type rejected\n- Auto-split triggers for 60+ second files\n- Permission denied for wrong group\n\n### Classification\n- Can create classification run\n- Can get results for completed run\n- Queue processing works\n\n### Error Handling\n- Invalid parameters return 400\n- Missing required fields return 400\n- Non-existent resources return 404\n\n## Verification\n- python manage.py test battycoda_app.tests.test_simple_api\n- All endpoints have at least basic coverage","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T00:04:53.306896313Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:04:53.306896313Z"}
{"id":"battycoda-e3z","title":"Add tests for Recording, Segmentation, Classification models","description":"## Problem\n12 core models have no tests, including the most critical ones:\n- Recording (84 lines, dual managers)\n- Segment, Segmentation, SegmentationAlgorithm\n- Classifier, ClassificationRun, ClassificationResult, CallProbability\n- UserNotification (164 lines)\n\n## Test File to Create\n```python\n# battycoda_app/tests/test_models_core.py\n\nfrom django.test import TestCase\nfrom battycoda_app.models import (\n    Recording, Segment, Segmentation, SegmentationAlgorithm,\n    Classifier, ClassificationRun, ClassificationResult,\n    UserNotification\n)\n\nclass RecordingModelTests(TestCase):\n    def test_default_manager_excludes_hidden(self):\n        r1 = Recording.objects.create(name='visible', is_hidden=False, ...)\n        r2 = Recording.objects.create(name='hidden', is_hidden=True, ...)\n        self.assertIn(r1, Recording.objects.all())\n        self.assertNotIn(r2, Recording.objects.all())\n    \n    def test_all_objects_manager_includes_hidden(self):\n        r = Recording.objects.create(name='hidden', is_hidden=True, ...)\n        self.assertIn(r, Recording.all_objects.all())\n    \n    def test_get_segments_sorted_by_onset(self):\n        recording = Recording.objects.create(...)\n        seg1 = Segment.objects.create(recording=recording, onset=1.0, offset=2.0)\n        seg2 = Segment.objects.create(recording=recording, onset=0.5, offset=1.0)\n        segments = recording.get_segments()\n        self.assertEqual(segments[0], seg2)  # Earlier onset first\n    \n    def test_str_representation(self):\n        r = Recording.objects.create(name='Test Recording', ...)\n        self.assertIn('Test Recording', str(r))\n\nclass SegmentModelTests(TestCase):\n    def test_onset_before_offset_validation(self):\n        # If model validates this\n        pass\n    \n    def test_segment_duration_property(self):\n        seg = Segment.objects.create(onset=1.0, offset=3.5, ...)\n        self.assertEqual(seg.duration, 2.5)\n\nclass ClassifierModelTests(TestCase):\n    def test_species_immutable_after_training(self):\n        \"\"\"Classifier species should not change after creation.\"\"\"\n        classifier = Classifier.objects.create(species=self.species, ...)\n        classifier.species = another_species\n        # Should this raise? Test expected behavior\n    \n    def test_model_file_path(self):\n        pass\n\nclass ClassificationRunTests(TestCase):\n    def test_status_transitions(self):\n        run = ClassificationRun.objects.create(status='queued', ...)\n        run.status = 'in_progress'\n        run.save()\n        run.status = 'completed'\n        run.save()\n        # Verify status history if tracked\n\nclass UserNotificationTests(TestCase):\n    def test_mark_as_read(self):\n        notif = UserNotification.objects.create(user=self.user, is_read=False, ...)\n        notif.mark_as_read()\n        self.assertTrue(notif.is_read)\n    \n    def test_unread_count(self):\n        UserNotification.objects.create(user=self.user, is_read=False)\n        UserNotification.objects.create(user=self.user, is_read=True)\n        self.assertEqual(UserNotification.objects.filter(user=self.user, is_read=False).count(), 1)\n```\n\n## Key Test Cases\n\n### Recording\n- Default manager excludes hidden\n- all_objects includes hidden  \n- get_segments() sorting\n- Auto-split recording creation\n\n### Segmentation\n- Algorithm choices\n- Status workflow (queued → processing → completed/failed)\n- Segment creation\n\n### Classification\n- Classifier species validation\n- Run status transitions\n- Result storage and retrieval\n- Probability distribution validation\n\n### Notifications\n- Creation\n- Mark as read\n- Bulk operations\n\n## Verification\n- python manage.py test battycoda_app.tests.test_models_core\n- All model methods have coverage\n- Edge cases tested","status":"closed","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T00:06:08.359363949Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T01:16:29.711959796Z","closed_at":"2026-01-14T01:16:29.711959796Z","close_reason":"Added test_models_core.py with 48 comprehensive tests for Recording, Segment, Segmentation, SegmentationAlgorithm, Classifier, ClassificationRun, ClassificationResult, CallProbability, ClassifierTrainingJob, and UserNotification models. Also fixed a pre-existing import bug in demo_utils.py and added missing exports to models/__init__.py."}
{"id":"battycoda-ehr","title":"Initialize npm project and install Vite","description":"## Task\nCreate package.json and install Vite with necessary dependencies.\n\n## Steps\n\n### 1. Initialize npm project\n```bash\nnpm init -y\n```\n\n### 2. Install Vite and plugins\n```bash\nnpm install --save-dev vite\nnpm install --save-dev vite-plugin-static-copy  # For copying assets\n```\n\n### 3. Update package.json scripts\n```json\n{\n  \"scripts\": {\n    \"dev\": \"vite\",\n    \"build\": \"vite build\",\n    \"preview\": \"vite preview\"\n  }\n}\n```\n\n### 4. Add to .gitignore\n```\nnode_modules/\nstatic/dist/\n```\n\n### 5. Create initial vite.config.js\nBasic config file pointing to static/ directory.\n\n## Files Created\n- package.json\n- package-lock.json\n- vite.config.js\n- Updates to .gitignore\n\n## Verification\n- `npm install` completes without errors\n- `npm run build` runs (even if no entry points yet)","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:04:30.352702234Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:04:30.352702234Z"}
{"id":"battycoda-f4l","title":"Fix GitHub Dependabot security vulnerabilities","description":"## Problem\nGitHub Dependabot reports 3 security vulnerabilities on the default branch.\n\n## Vulnerabilities\n\n### 1. black - ReDoS (Medium)\n- **Alert #13**\n- **Package:** black\n- **Current version:** \u003e=23.12.0,\u003c24.0.0\n- **Vulnerable range:** \u003c 24.3.0\n- **Fix:** Upgrade to \u003e= 24.3.0\n- **Summary:** Black vulnerable to Regular Expression Denial of Service (ReDoS)\n\n### 2. cryptography - Vulnerable OpenSSL (Medium)\n- **Alert #11**\n- **Package:** cryptography  \n- **Current version:** \u003e=42.0.0,\u003c43.0.0\n- **Vulnerable range:** \u003e= 37.0.0, \u003c 43.0.1\n- **Fix:** Upgrade to \u003e= 43.0.1\n- **Summary:** pyca/cryptography has a vulnerable OpenSSL included in cryptography wheels\n\n### 3. cryptography - Vulnerable OpenSSL (Low)\n- **Alert #12**\n- **Package:** cryptography\n- **Current version:** \u003e=42.0.0,\u003c43.0.0\n- **Vulnerable range:** \u003e= 42.0.0, \u003c 44.0.1\n- **Fix:** Upgrade to \u003e= 44.0.1\n- **Summary:** Vulnerable OpenSSL included in cryptography wheels\n\n## Fix Steps\n\n### 1. Update requirements.txt\nChange:\n```\nblack\u003e=23.12.0,\u003c24.0.0\ncryptography\u003e=42.0.0,\u003c43.0.0\n```\n\nTo:\n```\nblack\u003e=24.3.0,\u003c25.0.0\ncryptography\u003e=44.0.1,\u003c45.0.0\n```\n\n### 2. Update virtual environment\n```bash\nsource venv/bin/activate\npip install --upgrade black cryptography\npip freeze | grep -E \"^(black|cryptography)\"\n# Verify: black==24.x.x, cryptography==44.x.x\n```\n\n### 3. Test that nothing breaks\n```bash\n# Test black still works\nblack --check battycoda_app/\n\n# Test cryptography still works (used by django-ses, requests, etc.)\npython -c \"from cryptography.fernet import Fernet; print('cryptography OK')\"\n\n# Run Django tests\npython manage.py test\n```\n\n### 4. Verify alerts are resolved\n```bash\ngh api repos/angiesalles/battycoda/dependabot/alerts --jq '.[] | select(.state==\"open\")'\n# Should return empty or no results for black/cryptography\n```\n\n### 5. Commit and push\n```bash\ngit add requirements.txt\ngit commit -m \"fix: upgrade black and cryptography for security vulnerabilities\n\n- black: 23.x → 24.3.0+ (fixes ReDoS, Dependabot #13)\n- cryptography: 42.x → 44.0.1+ (fixes OpenSSL vulns, Dependabot #11, #12)\"\ngit push\n```\n\n## Verification Checklist\n- [ ] requirements.txt updated\n- [ ] pip install successful\n- [ ] black --check passes\n- [ ] Django tests pass\n- [ ] Dependabot alerts closed (may take a few minutes after push)\n\n## Notes\n- black is a dev dependency (code formatter), so upgrade is low risk\n- cryptography is used by django-ses and requests; test email sending after upgrade\n- Both packages have good backwards compatibility","status":"closed","priority":0,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:54:29.818994939Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:13:07.34205432Z","closed_at":"2026-01-14T00:13:07.34205432Z","close_reason":"Updated requirements.txt: black 23.x→25.12.0, cryptography 42.x→46.0.3. Both packages work correctly. Commit 311e45b pushed."}
{"id":"battycoda-gr3","title":"Install and configure Vitest","description":"## Task\nInstall Vitest and configure for the BattyCoda project.\n\n## Steps\n\n### 1. Install Vitest and dependencies\n```bash\nnpm install --save-dev vitest @vitest/coverage-v8 @vitest/ui\nnpm install --save-dev jsdom  # For DOM testing if needed\n```\n\n### 2. Update vite.config.js with test configuration\n```javascript\nimport { defineConfig } from 'vite';\n\nexport default defineConfig({\n  // ... existing config ...\n  \n  test: {\n    // Test configuration\n    globals: true,\n    environment: 'jsdom',  // or 'node' for pure logic tests\n    \n    // Test file patterns\n    include: ['static/js/**/*.test.js', 'static/js/**/*.spec.js'],\n    \n    // Coverage settings\n    coverage: {\n      provider: 'v8',\n      reporter: ['text', 'json', 'html'],\n      reportsDirectory: 'coverage',\n      include: ['static/js/**/*.js'],\n      exclude: [\n        'static/js/**/*.test.js',\n        'static/js/**/*.spec.js',\n        'static/js/app.js',  // Third-party Maisonnette\n        'node_modules/**',\n      ],\n    },\n    \n    // Setup files if needed\n    setupFiles: ['static/js/test/setup.js'],\n  }\n});\n```\n\n### 3. Add npm scripts\n```json\n{\n  \"scripts\": {\n    \"test\": \"vitest\",\n    \"test:run\": \"vitest run\",\n    \"test:coverage\": \"vitest run --coverage\",\n    \"test:ui\": \"vitest --ui\"\n  }\n}\n```\n\n### 4. Create test setup file\nCreate `static/js/test/setup.js`:\n```javascript\n/**\n * Test setup file\n * Runs before all tests\n */\n\n// Mock browser APIs if needed\nimport { vi } from 'vitest';\n\n// Mock fetch for API tests\nglobal.fetch = vi.fn();\n\n// Mock jQuery if needed for legacy code\nglobal.$ = vi.fn(() =\u003e ({\n  on: vi.fn(),\n  off: vi.fn(),\n  ready: vi.fn(cb =\u003e cb()),\n  ajax: vi.fn(),\n}));\nglobal.jQuery = global.$;\n```\n\n### 5. Create test directory structure\n```\nstatic/js/\n├── test/\n│   ├── setup.js        # Global test setup\n│   ├── mocks/          # Shared mocks\n│   │   ├── api.js\n│   │   └── audio.js\n│   └── fixtures/       # Test data\n│       ├── clusters.json\n│       └── segments.json\n```\n\n## Verification\n- `npm test` runs without errors\n- `npm run test:coverage` generates report\n- `npm run test:ui` opens Vitest UI","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:08:30.096389961Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:08:30.096389961Z","dependencies":[{"issue_id":"battycoda-gr3","depends_on_id":"battycoda-10n","type":"blocks","created_at":"2026-01-13T23:20:15.504737497Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-hb5","title":"Decide: Build tool (Vite/Webpack) vs vanilla JS","description":"## Decision Needed\nBefore Phase 2 architecture refactor, need to decide JavaScript bundling strategy.\n\n## Options\n\n### Option A: Vanilla JS (IIFE pattern)\nPros:\n- No build step needed\n- Simpler deployment\n- No new dependencies\n- Works with current Django static files\n\nCons:\n- Manual dependency management\n- No tree shaking\n- No ES6 module benefits\n- Harder to add npm packages\n\n### Option B: Build tool (Vite recommended over Webpack)\nPros:\n- Proper ES6 modules\n- Tree shaking / dead code elimination\n- Easy npm package integration\n- Hot module reload in dev\n- Modern tooling\n\nCons:\n- Build step required\n- New tooling to learn/maintain\n- Need to update deployment process\n- Adds complexity\n\n## Recommendation\nFor a Django app of this size, **vanilla JS (Option A)** is likely sufficient. The clustering code isn't complex enough to warrant build tooling overhead.\n\n## Impacts\n- Phase 2 architecture decisions\n- How to fix yf0.3 (ES6 modules)\n- Future JS development patterns","status":"closed","priority":0,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T22:46:37.700681511Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:21:12.443061517Z","closed_at":"2026-01-13T23:21:12.443061517Z","close_reason":"Decision made: Use Vite. Created detailed implementation plan in Phase 1-3 epics."}
{"id":"battycoda-hxh","title":"Create Playwright test database fixtures","description":"## Task\nCreate Django fixtures and helpers for Playwright tests to use consistent test data.\n\n## Steps\n\n### 1. Create Django management command for test data\n```python\n# battycoda_app/management/commands/setup_e2e_tests.py\nfrom django.core.management.base import BaseCommand\nfrom django.contrib.auth.models import User\nfrom battycoda_app.models import Group, Species, Project\n\nclass Command(BaseCommand):\n    help = 'Set up test data for E2E tests'\n    \n    def handle(self, *args, **options):\n        # Create test user\n        user, created = User.objects.get_or_create(\n            username='e2e_testuser',\n            defaults={\n                'email': 'e2e@test.com',\n                'is_active': True\n            }\n        )\n        if created:\n            user.set_password('e2e_testpass')\n            user.save()\n        \n        # Create test group\n        group, _ = Group.objects.get_or_create(\n            name='E2E Test Group',\n            defaults={'created_by': user}\n        )\n        \n        # Create test species\n        species, _ = Species.objects.get_or_create(\n            name='Test Species',\n            group=group,\n            defaults={\n                'description': 'Species for E2E testing'\n            }\n        )\n        \n        # Create test project\n        project, _ = Project.objects.get_or_create(\n            name='E2E Test Project',\n            group=group,\n            defaults={\n                'created_by': user,\n                'species': species\n            }\n        )\n        \n        self.stdout.write(self.style.SUCCESS('E2E test data created'))\n```\n\n### 2. Create management command for cleanup\n```python\n# battycoda_app/management/commands/cleanup_e2e_tests.py\nclass Command(BaseCommand):\n    help = 'Clean up E2E test data'\n    \n    def handle(self, *args, **options):\n        # Delete test data in reverse order\n        User.objects.filter(username='e2e_testuser').delete()\n        Group.objects.filter(name='E2E Test Group').delete()\n        # ... etc\n```\n\n### 3. Create test audio file fixture\n```bash\n# Create a small test WAV file (or copy from existing test files)\n# tests/e2e/fixtures/test-audio.wav - 5 second silence or sine wave\n```\n\n### 4. Create Playwright global setup\n```javascript\n// tests/e2e/global-setup.js\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\n\nconst execAsync = promisify(exec);\n\nexport default async function globalSetup() {\n  console.log('Setting up E2E test data...');\n  await execAsync('python manage.py setup_e2e_tests');\n}\n```\n\n### 5. Create Playwright global teardown\n```javascript\n// tests/e2e/global-teardown.js\nexport default async function globalTeardown() {\n  console.log('Cleaning up E2E test data...');\n  await execAsync('python manage.py cleanup_e2e_tests');\n}\n```\n\n### 6. Update playwright.config.js\n```javascript\nexport default defineConfig({\n  globalSetup: './tests/e2e/global-setup.js',\n  globalTeardown: './tests/e2e/global-teardown.js',\n  // ... rest of config\n});\n```\n\n## Test Data to Create\n| Entity | Name | Purpose |\n|--------|------|---------|\n| User | e2e_testuser | Login tests |\n| User | e2e_adminuser | Admin tests |\n| Group | E2E Test Group | Group context |\n| Species | Test Species | Species selection |\n| Project | E2E Test Project | Project context |\n| Recording | test-recording | Playback tests |\n\n## Files Created\n- battycoda_app/management/commands/setup_e2e_tests.py\n- battycoda_app/management/commands/cleanup_e2e_tests.py\n- tests/e2e/fixtures/test-audio.wav\n- tests/e2e/global-setup.js\n- tests/e2e/global-teardown.js\n\n## Verification\n- `python manage.py setup_e2e_tests` creates data\n- `python manage.py cleanup_e2e_tests` removes data\n- Playwright runs setup before tests","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:10:55.955167615Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:10:55.955167615Z","dependencies":[{"issue_id":"battycoda-hxh","depends_on_id":"battycoda-965","type":"blocks","created_at":"2026-01-13T23:20:17.884281731Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-jid","title":"Pin Node.js version with .nvmrc and engines","description":"## Problem\nNo Node.js version specified. Could cause:\n- \"Works on my machine\" issues\n- CI failures due to version mismatch\n- Incompatible npm packages\n\n## Solution\n\n### 1. Create .nvmrc file\n```bash\n# .nvmrc\n20\n```\n\nThis tells nvm users which version to use:\n```bash\nnvm use  # Automatically uses version from .nvmrc\n```\n\n### 2. Add engines to package.json\n```json\n{\n  \"engines\": {\n    \"node\": \"\u003e=20.0.0\",\n    \"npm\": \"\u003e=10.0.0\"\n  }\n}\n```\n\n### 3. Add .npmrc for strict engine checking\n```\n# .npmrc\nengine-strict=true\n```\n\nThis makes `npm install` fail if Node version doesn't match.\n\n### 4. Document Node.js installation\nAdd to CLAUDE.md and README:\n```markdown\n## Prerequisites\n\n### Node.js\nThis project requires Node.js 20.x or later.\n\n**Using nvm (recommended):**\n\\`\\`\\`bash\n# Install nvm if not already installed\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash\n\n# Install and use correct Node version\nnvm install\nnvm use\n\\`\\`\\`\n\n**Using system package manager:**\n\\`\\`\\`bash\n# Ubuntu/Debian\ncurl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -\nsudo apt-get install -y nodejs\n\\`\\`\\`\n\n**Verify installation:**\n\\`\\`\\`bash\nnode --version  # Should be v20.x.x\nnpm --version   # Should be v10.x.x\n\\`\\`\\`\n```\n\n### 5. Add to CI workflow (if applicable)\n```yaml\n# .github/workflows/test.yml\n- name: Setup Node.js\n  uses: actions/setup-node@v4\n  with:\n    node-version-file: '.nvmrc'\n    cache: 'npm'\n```\n\n### 6. Add check to dev script\n```bash\n#!/bin/bash\n# scripts/dev.sh\n\n# Check Node version\nREQUIRED_NODE_MAJOR=20\nCURRENT_NODE_MAJOR=$(node -v | cut -d'.' -f1 | tr -d 'v')\n\nif [ \"$CURRENT_NODE_MAJOR\" -lt \"$REQUIRED_NODE_MAJOR\" ]; then\n  echo \"Error: Node.js $REQUIRED_NODE_MAJOR.x or later required\"\n  echo \"Current version: $(node -v)\"\n  echo \"\"\n  echo \"Install with: nvm install $REQUIRED_NODE_MAJOR \u0026\u0026 nvm use\"\n  exit 1\nfi\n\n# ... rest of script\n```\n\n## Files Created\n- .nvmrc\n- .npmrc\n\n## Files Modified\n- package.json (add engines)\n- CLAUDE.md (add Node.js docs)\n- scripts/dev.sh (add version check)\n\n## Verification\n- `nvm use` works from project root\n- `npm install` fails with wrong Node version\n- Documentation clearly states requirements","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:31:42.995955717Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:31:42.995955717Z","dependencies":[{"issue_id":"battycoda-jid","depends_on_id":"battycoda-ehr","type":"blocks","created_at":"2026-01-13T23:33:31.277506356Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-jmc","title":"Clean up unused imports and self-assignments in models.py","description":"## Problem\nUnused imports and pointless self-assignments.\n\n## Unused Imports\n\n### battycoda_app/forms.py (Line 4)\nfrom django.db import models  # Never used\n\n### battycoda_app/views_debug.py (Line 2)\nimport os  # Not directly used\n\n## Self-Assignment / Duplicate Exports\n\n### battycoda_app/models.py (Lines 41-42, 45-46)\n# Backwards compatibility aliases\nClassificationRun = ClassificationRun  # Self-assignment, no-op\nClassificationResult = ClassificationResult  # Self-assignment, no-op\n\n__all__ = [\n    ...\n    'ClassificationRun',  # Duplicate in __all__\n    'ClassificationResult',  # Duplicate in __all__\n]\n\n## Fix\n- Remove unused imports\n- Remove self-assignments\n- Remove duplicate entries from __all__\n\n## Verification\nRun linter: ./lint.sh","status":"open","priority":3,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T01:21:16.903940156Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T01:21:16.903940156Z"}
{"id":"battycoda-jwt","title":"Write E2E tests for recording workflows","description":"## Task\nWrite Playwright E2E tests for recording upload, viewing, and playback.\n\n## Test Cases\n\n### tests/e2e/specs/recordings.spec.js\n```javascript\nimport { test, expect } from '@playwright/test';\nimport { login } from '../helpers/auth.js';\nimport users from '../fixtures/users.json';\nimport path from 'path';\n\ntest.describe('Recordings', () =\u003e {\n  test.beforeEach(async ({ page }) =\u003e {\n    await login(page, users.testUser.email, users.testUser.password);\n  });\n  \n  test.describe('Upload', () =\u003e {\n    test('single file upload', async ({ page }) =\u003e {\n      await page.goto('/recordings/upload/');\n      \n      // Select project\n      await page.selectOption('select[name=\"project\"]', { label: 'E2E Test Project' });\n      \n      // Upload file\n      const fileInput = page.locator('input[type=\"file\"]');\n      await fileInput.setInputFiles(path.join(__dirname, '../fixtures/test-audio.wav'));\n      \n      // Submit\n      await page.click('button[type=\"submit\"]');\n      \n      // Wait for upload to complete\n      await expect(page.locator('.alert-success, .toast')).toContainText('uploaded');\n    });\n    \n    test('batch upload multiple files', async ({ page }) =\u003e {\n      await page.goto('/recordings/batch-upload/');\n      \n      // Similar to single upload but with multiple files\n    });\n    \n    test('upload validates file type', async ({ page }) =\u003e {\n      await page.goto('/recordings/upload/');\n      \n      // Try uploading non-audio file\n      const fileInput = page.locator('input[type=\"file\"]');\n      await fileInput.setInputFiles(path.join(__dirname, '../fixtures/users.json'));\n      \n      await expect(page.locator('.error, .invalid-feedback')).toBeVisible();\n    });\n  });\n  \n  test.describe('Recording List', () =\u003e {\n    test('displays recordings in table', async ({ page }) =\u003e {\n      await page.goto('/recordings/');\n      \n      await expect(page.locator('table, .recording-list')).toBeVisible();\n      await expect(page.locator('tr, .recording-item').first()).toBeVisible();\n    });\n    \n    test('filter by project', async ({ page }) =\u003e {\n      await page.goto('/recordings/');\n      \n      await page.selectOption('select[name=\"project\"]', { label: 'E2E Test Project' });\n      await page.click('button:has-text(\"Filter\")');\n      \n      // Verify filtered results\n    });\n    \n    test('search recordings', async ({ page }) =\u003e {\n      await page.goto('/recordings/');\n      \n      await page.fill('input[name=\"search\"]', 'test');\n      await page.click('button:has-text(\"Search\")');\n      \n      // Verify search results\n    });\n  });\n  \n  test.describe('Recording Detail', () =\u003e {\n    test('displays waveform player', async ({ page }) =\u003e {\n      await page.goto('/recordings/');\n      await page.click('.recording-link:first-child, tr:first-child a');\n      \n      // Wait for player to load\n      await expect(page.locator('#waveform-container, .waveform-player')).toBeVisible();\n    });\n    \n    test('play/pause controls work', async ({ page }) =\u003e {\n      await page.goto('/recordings/1/');  // Assuming recording ID 1 exists\n      \n      // Click play\n      await page.click('#play-btn, .play-button');\n      \n      // Verify playing state\n      await expect(page.locator('.playing, [data-playing=\"true\"]')).toBeVisible();\n      \n      // Click pause\n      await page.click('#pause-btn, .pause-button');\n    });\n    \n    test('zoom controls work', async ({ page }) =\u003e {\n      await page.goto('/recordings/1/');\n      \n      // Click zoom in\n      await page.click('#zoom-in, .zoom-in-btn');\n      \n      // Verify zoom changed (check canvas width or similar)\n    });\n  });\n});\n```\n\n## Files Created\n- tests/e2e/specs/recordings.spec.js\n- tests/e2e/fixtures/test-audio.wav (small test WAV file)\n\n## Verification\n- All recording tests pass\n- Upload actually creates recording in DB\n- Player renders correctly","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:11:00.798820757Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:11:00.798820757Z","dependencies":[{"issue_id":"battycoda-jwt","depends_on_id":"battycoda-hxh","type":"blocks","created_at":"2026-01-13T23:20:18.095931983Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-jzq","title":"Ensure CSRF token access in ES6 modules","description":"## Problem\nAJAX requests need CSRF tokens. Currently accessed via:\n1. Cookie (`csrftoken`)\n2. Hidden input (`\u003cinput name=\"csrfmiddlewaretoken\"\u003e`)\n3. Global variable (`{{ csrf_token }}`)\n\nES6 modules need a clean way to access this.\n\n## Solution\n\n### 1. Create CSRF utility module\n```javascript\n// static/js/utils/csrf.js\n\n/**\n * Get CSRF token for AJAX requests\n * Checks multiple sources in order of preference\n */\nexport function getCsrfToken() {\n  // 1. Try data attribute (preferred)\n  const appData = document.getElementById('app-data');\n  if (appData?.dataset.csrfToken) {\n    return appData.dataset.csrfToken;\n  }\n  \n  // 2. Try hidden input\n  const input = document.querySelector('input[name=\"csrfmiddlewaretoken\"]');\n  if (input?.value) {\n    return input.value;\n  }\n  \n  // 3. Try cookie\n  const cookie = document.cookie\n    .split('; ')\n    .find(row =\u003e row.startsWith('csrftoken='));\n  if (cookie) {\n    return cookie.split('=')[1];\n  }\n  \n  console.warn('No CSRF token found');\n  return null;\n}\n\n/**\n * Get headers object for fetch requests\n */\nexport function getCsrfHeaders() {\n  return {\n    'X-CSRFToken': getCsrfToken(),\n    'Content-Type': 'application/json',\n  };\n}\n\n/**\n * Wrapper for fetch with CSRF token\n */\nexport async function fetchWithCsrf(url, options = {}) {\n  const headers = {\n    ...getCsrfHeaders(),\n    ...options.headers,\n  };\n  \n  return fetch(url, {\n    ...options,\n    headers,\n    credentials: 'same-origin',  // Include cookies\n  });\n}\n```\n\n### 2. Update base.html to always include CSRF in app-data\n```html\n\u003c!-- In base.html, add to body --\u003e\n\u003cdiv id=\"app-data\" \n     data-csrf-token=\"{{ csrf_token }}\"\n     style=\"display: none;\"\u003e\n\u003c/div\u003e\n```\n\n### 3. Update modules to use CSRF utility\n```javascript\n// Before\n$.ajax({\n  url: '/api/endpoint/',\n  method: 'POST',\n  headers: {\n    'X-CSRFToken': $('[name=csrfmiddlewaretoken]').val()\n  },\n  data: JSON.stringify(payload)\n});\n\n// After\nimport { fetchWithCsrf } from './utils/csrf.js';\n\nconst response = await fetchWithCsrf('/api/endpoint/', {\n  method: 'POST',\n  body: JSON.stringify(payload)\n});\n```\n\n### 4. For jQuery AJAX (legacy code)\nSet up global AJAX defaults:\n```javascript\n// In main.js or setup\nimport { getCsrfToken } from './utils/csrf.js';\n\n// Configure jQuery AJAX globally\n$.ajaxSetup({\n  beforeSend: function(xhr, settings) {\n    if (!this.crossDomain) {\n      xhr.setRequestHeader('X-CSRFToken', getCsrfToken());\n    }\n  }\n});\n```\n\n## Files Created\n- static/js/utils/csrf.js\n\n## Files Modified\n- templates/base.html (add csrf to app-data)\n- static/js/main.js (jQuery ajaxSetup)\n- All modules making AJAX requests\n\n## Verification\n- POST requests succeed (not 403 Forbidden)\n- Works with fetch() API\n- Works with jQuery $.ajax()\n- Works after page has been open for extended time","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:29:21.666937135Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:29:21.666937135Z","dependencies":[{"issue_id":"battycoda-jzq","depends_on_id":"battycoda-wgn","type":"blocks","created_at":"2026-01-13T23:33:31.042365917Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-kmg","title":"Decide: Standardize on Bootstrap 4 or upgrade to 5","description":"## Decision Needed\nCodebase currently uses Bootstrap 4.3.1 but some templates have Bootstrap 5 classes mixed in.\n\n## Current State\n- base.html loads Bootstrap 4.3.1 CSS and JS\n- Some templates use BS4 classes: float-right, mr-2, ml-2, badge-success\n- Some templates use BS5 classes: float-end, me-2, ms-2 (these don't work\\!)\n\n## Options\n\n### Option A: Stay on Bootstrap 4\nPros:\n- No migration effort\n- Just fix the BS5 classes to BS4 equivalents\n- Maisonnette theme is built for BS4\n\nCons:\n- BS4 is older, fewer updates\n- Missing some BS5 features\n\n### Option B: Upgrade to Bootstrap 5\nPros:\n- Modern, actively maintained\n- Better utilities\n- Dropped jQuery dependency (though we still use jQuery)\n\nCons:\n- Significant migration effort\n- Maisonnette theme may need updates\n- Many class name changes (mr→me, ml→ms, etc.)\n- May break existing styling\n\n## Recommendation\n**Stay on Bootstrap 4 (Option A)** - The migration effort isn't worth it. Just fix the incorrectly used BS5 classes.\n\n## Class Mapping (if staying BS4)\n| Wrong (BS5) | Correct (BS4) |\n|-------------|---------------|\n| float-end | float-right |\n| float-start | float-left |\n| me-2 | mr-2 |\n| ms-2 | ml-2 |\n| mb-0 | mb-0 (same) |\n\n## Impacts\n- All templates with mixed classes\n- Phase 2 CSS consolidation\n- Future UI development","status":"closed","priority":0,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T22:46:52.614246299Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:41:40.487113964Z","closed_at":"2026-01-13T23:41:40.487113964Z","close_reason":"Decision changed: Proceed with Bootstrap 5 migration (see battycoda-6nn epic)"}
{"id":"battycoda-lmk","title":"Write E2E tests for authentication flows","description":"## Task\nWrite Playwright E2E tests for authentication flows.\n\n## Test Cases\n\n### tests/e2e/specs/auth.spec.js\n```javascript\nimport { test, expect } from '@playwright/test';\nimport { login } from '../helpers/auth.js';\nimport users from '../fixtures/users.json';\n\ntest.describe('Authentication', () =\u003e {\n  test.describe('Login', () =\u003e {\n    test('successful login redirects to home', async ({ page }) =\u003e {\n      await page.goto('/accounts/login/');\n      await page.fill('input[name=\"email\"]', users.testUser.email);\n      await page.fill('input[name=\"password\"]', users.testUser.password);\n      await page.click('button[type=\"submit\"]');\n      \n      await expect(page).toHaveURL('/');\n      await expect(page.locator('.navbar')).toContainText(users.testUser.username);\n    });\n    \n    test('invalid credentials shows error', async ({ page }) =\u003e {\n      await page.goto('/accounts/login/');\n      await page.fill('input[name=\"email\"]', 'wrong@email.com');\n      await page.fill('input[name=\"password\"]', 'wrongpassword');\n      await page.click('button[type=\"submit\"]');\n      \n      await expect(page.locator('.alert-danger, .error')).toBeVisible();\n      await expect(page).toHaveURL(/login/);\n    });\n    \n    test('login with email code', async ({ page }) =\u003e {\n      // Test passwordless login flow\n      await page.goto('/accounts/login/');\n      await page.click('text=Login with email');\n      await page.fill('input[name=\"email\"]', users.testUser.email);\n      await page.click('button[type=\"submit\"]');\n      \n      await expect(page.locator('.alert-success, .message')).toContainText('code sent');\n    });\n  });\n  \n  test.describe('Registration', () =\u003e {\n    test('new user registration flow', async ({ page }) =\u003e {\n      const uniqueEmail = `test-${Date.now()}@example.com`;\n      \n      await page.goto('/accounts/register/');\n      await page.fill('input[name=\"username\"]', 'newuser' + Date.now());\n      await page.fill('input[name=\"email\"]', uniqueEmail);\n      await page.fill('input[name=\"password1\"]', 'SecurePass123!');\n      await page.fill('input[name=\"password2\"]', 'SecurePass123!');\n      await page.click('button[type=\"submit\"]');\n      \n      // Should redirect to login or verification page\n      await expect(page).toHaveURL(/login|verify/);\n    });\n    \n    test('registration validates password requirements', async ({ page }) =\u003e {\n      await page.goto('/accounts/register/');\n      await page.fill('input[name=\"password1\"]', '123');  // Too short\n      await page.fill('input[name=\"password2\"]', '123');\n      await page.click('button[type=\"submit\"]');\n      \n      await expect(page.locator('.error, .invalid-feedback')).toBeVisible();\n    });\n  });\n  \n  test.describe('Logout', () =\u003e {\n    test('logout clears session', async ({ page }) =\u003e {\n      await login(page, users.testUser.email, users.testUser.password);\n      \n      await page.click('text=Logout');\n      \n      await expect(page).toHaveURL(/login/);\n      // Verify navbar shows login button, not username\n      await expect(page.locator('text=Login')).toBeVisible();\n    });\n  });\n  \n  test.describe('Protected routes', () =\u003e {\n    test('unauthenticated user redirected to login', async ({ page }) =\u003e {\n      await page.goto('/recordings/');\n      \n      await expect(page).toHaveURL(/login/);\n    });\n  });\n});\n```\n\n## Files Created\n- tests/e2e/specs/auth.spec.js\n- tests/e2e/helpers/auth.js (updated)\n\n## Verification\n- All auth tests pass\n- Tests work in all three browsers\n- Screenshots captured on failure","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:10:58.513208044Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:10:58.513208044Z","dependencies":[{"issue_id":"battycoda-lmk","depends_on_id":"battycoda-hxh","type":"blocks","created_at":"2026-01-13T23:20:17.983965839Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-lpe","title":"Create main.js entry point and module structure","description":"## Task\nCreate the main JavaScript entry point that imports and initializes all modules.\n\n## Steps\n\n### 1. Create static/js/main.js entry point\n```javascript\n/**\n * BattyCoda Main Entry Point\n * \n * This file is the main entry point for Vite bundling.\n * It imports and initializes all JavaScript modules.\n */\n\n// Core utilities\nimport './datetime_formatter.js';\nimport './theme-switcher.js';\n\n// Feature modules (conditionally loaded based on page)\n// These will be dynamically imported where needed\n```\n\n### 2. Create module index files for each feature area\nCreate index.js files that re-export module contents:\n- static/js/player/index.js (already exists, verify)\n- static/js/cluster_explorer/index.js\n- static/js/cluster_mapping/index.js\n- static/js/file_upload/index.js\n- static/js/segmentation/index.js\n\n### 3. Update vite.config.js with all entry points\n```javascript\nrollupOptions: {\n  input: {\n    main: resolve(__dirname, 'static/js/main.js'),\n    player: resolve(__dirname, 'static/js/player/index.js'),\n    clusterExplorer: resolve(__dirname, 'static/js/cluster_explorer/index.js'),\n    clusterMapping: resolve(__dirname, 'static/js/cluster_mapping/index.js'),\n    fileUpload: resolve(__dirname, 'static/js/file_upload/index.js'),\n    segmentation: resolve(__dirname, 'static/js/segmentation/index.js'),\n  }\n}\n```\n\n### 4. Document module structure in code comments\nEach index.js should have a header comment explaining what the module provides.\n\n## Files Created/Modified\n- static/js/main.js (new)\n- static/js/cluster_explorer/index.js (new)\n- static/js/cluster_mapping/index.js (already exists, verify exports)\n- static/js/file_upload/index.js (new)\n- static/js/segmentation/index.js (verify)\n- vite.config.js (updated)\n\n## Verification\n- `npm run build` produces separate chunks for each entry point\n- No duplicate code between chunks (proper code splitting)\n- Build output size is reasonable","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:04:36.694183008Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:04:36.694183008Z","dependencies":[{"issue_id":"battycoda-lpe","depends_on_id":"battycoda-3vv","type":"blocks","created_at":"2026-01-13T23:20:12.873764556Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-mlt","title":"Add tests for Celery async tasks","description":"## Problem\nZero test coverage for Celery tasks (~1,600 lines). These are critical for:\n- Audio duration calculation\n- Classification queue processing\n- Segmentation\n- Classifier training\n- Database backups\n\n## Files Needing Tests\n- battycoda_app/tasks.py - calculate_audio_duration (complex retry logic)\n- battycoda_app/audio/task_modules/training_tasks.py (539 lines)\n- battycoda_app/audio/task_modules/segmentation_tasks.py (142 lines)\n- battycoda_app/audio/task_modules/classification/run_classification.py (366 lines)\n- battycoda_app/audio/task_modules/queue_processor.py (135 lines)\n\n## Test Infrastructure Setup\n\n### 1. Configure Celery for testing\n```python\n# battycoda_app/tests/test_celery_tasks.py\n\nfrom django.test import TestCase, override_settings\nfrom celery import current_app\n\n@override_settings(CELERY_TASK_ALWAYS_EAGER=True, CELERY_TASK_EAGER_PROPAGATES=True)\nclass CeleryTaskTestCase(TestCase):\n    \"\"\"Base class for Celery task tests. Tasks run synchronously.\"\"\"\n    pass\n```\n\n### 2. Test calculate_audio_duration\n```python\nfrom battycoda_app.tasks import calculate_audio_duration\n\nclass AudioDurationTaskTests(CeleryTaskTestCase):\n    def test_calculates_wav_duration(self):\n        recording = Recording.objects.create(...)\n        # Copy test WAV to recording path\n        calculate_audio_duration.delay(recording.id)\n        recording.refresh_from_db()\n        self.assertIsNotNone(recording.duration)\n    \n    def test_retries_on_missing_file(self):\n        recording = Recording.objects.create(...)\n        # Don't create actual file\n        with self.assertRaises(Exception):\n            calculate_audio_duration.delay(recording.id)\n    \n    def test_handles_corrupt_audio(self):\n        pass\n```\n\n### 3. Test classification queue\n```python\nfrom battycoda_app.audio.task_modules.queue_processor import process_classification_queue\n\nclass QueueProcessorTests(CeleryTaskTestCase):\n    def test_processes_pending_runs(self):\n        run = ClassificationRun.objects.create(status='pending', ...)\n        process_classification_queue()\n        run.refresh_from_db()\n        self.assertIn(run.status, ['in_progress', 'completed'])\n    \n    def test_skips_already_processing(self):\n        run = ClassificationRun.objects.create(status='in_progress', ...)\n        # Should not double-process\n        pass\n```\n\n### 4. Test training tasks\n```python\nclass TrainingTaskTests(CeleryTaskTestCase):\n    def test_creates_classifier(self):\n        pass\n    \n    def test_handles_insufficient_data(self):\n        pass\n    \n    def test_cleans_up_temp_files(self):\n        pass\n```\n\n## Mocking External Services\n```python\nfrom unittest.mock import patch, MagicMock\n\nclass ClassificationTaskTests(CeleryTaskTestCase):\n    @patch('battycoda_app.audio.task_modules.classification.run_classification.requests.post')\n    def test_calls_r_server(self, mock_post):\n        mock_post.return_value = MagicMock(\n            status_code=200,\n            json=lambda: {'predictions': [...]}\n        )\n        # Run task\n        # Verify R server called correctly\n```\n\n## Verification\n- python manage.py test battycoda_app.tests.test_celery_tasks\n- All task modules have coverage\n- Retry logic is tested\n- Error conditions are tested","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T00:05:45.448647676Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:05:45.448647676Z"}
{"id":"battycoda-nfp","title":"Phase 4: Performance","description":"## Scope\nPerformance optimizations for clustering system.\n\n## Tasks (from CLUSTERING_VISUALIZATION_OVERHAUL.md)\n\n### 1. Fix N+1 Query in export_clusters\nLocation: mappings.py:46-58\nProblem:\n```python\nfor sc in segment_clusters:\n    segment = sc.segment  # Query\n    recording = segment.segmentation.recording  # Query\n```\nFix: Use select_related properly\n\n### 2. Streaming CSV exports\nLocation: mappings.py:14-62\nProblem: Large exports build entire CSV in memory\nFix: Use StreamingHttpResponse with generator\n\n### 3. Add pagination\nAffected areas:\n- Dashboard (all runs shown)\n- Cluster members list\n- Segment lists\n\n## Estimated Effort\n4-8 hours","status":"open","priority":3,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T22:23:32.098076139Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:23:32.098076139Z"}
{"id":"battycoda-nl9","title":"Add ESLint and Prettier for JavaScript","description":"## Problem\nPython has linting (lint.sh, format.sh) but JavaScript doesn't. Need consistent code style and error checking for JS.\n\n## Solution\n\n### 1. Install ESLint and Prettier\n```bash\nnpm install --save-dev eslint prettier eslint-config-prettier eslint-plugin-prettier\n```\n\n### 2. Create ESLint configuration\n```javascript\n// eslint.config.js (flat config format for ESLint 9+)\nimport js from '@eslint/js';\nimport prettier from 'eslint-config-prettier';\n\nexport default [\n  js.configs.recommended,\n  prettier,\n  {\n    languageOptions: {\n      ecmaVersion: 2022,\n      sourceType: 'module',\n      globals: {\n        // Browser globals\n        window: 'readonly',\n        document: 'readonly',\n        console: 'readonly',\n        fetch: 'readonly',\n        // jQuery (external)\n        $: 'readonly',\n        jQuery: 'readonly',\n        // D3 (if kept as external)\n        d3: 'readonly',\n      }\n    },\n    rules: {\n      'no-unused-vars': ['warn', { argsIgnorePattern: '^_' }],\n      'no-console': 'off',  // Allow console for now\n      'prefer-const': 'warn',\n      'no-var': 'error',\n      'eqeqeq': ['error', 'always'],\n    }\n  },\n  {\n    ignores: [\n      'node_modules/**',\n      'static/dist/**',\n      'static/js/app.js',  // Third-party Maisonnette\n      'static/lib/**',\n      'staticfiles/**',\n      'venv/**',\n    ]\n  }\n];\n```\n\n### 3. Create Prettier configuration\n```json\n// .prettierrc\n{\n  \"semi\": true,\n  \"singleQuote\": true,\n  \"tabWidth\": 2,\n  \"trailingComma\": \"es5\",\n  \"printWidth\": 100,\n  \"bracketSpacing\": true\n}\n```\n\n### 4. Create Prettier ignore file\n```\n# .prettierignore\nnode_modules/\nstatic/dist/\nstatic/js/app.js\nstatic/lib/\nstaticfiles/\nvenv/\n*.min.js\n```\n\n### 5. Add npm scripts\n```json\n{\n  \"scripts\": {\n    \"lint\": \"eslint static/js\",\n    \"lint:fix\": \"eslint static/js --fix\",\n    \"format\": \"prettier --write static/js/**/*.js\",\n    \"format:check\": \"prettier --check static/js/**/*.js\"\n  }\n}\n```\n\n### 6. Create combined lint script\n```bash\n#!/bin/bash\n# lint-all.sh - Lint both Python and JavaScript\n\nset -e\necho \"=== Linting Python ===\"\n./lint.sh\n\necho \"\"\necho \"=== Linting JavaScript ===\"\nnpm run lint\n\necho \"\"\necho \"=== Checking JS formatting ===\"\nnpm run format:check\n\necho \"\"\necho \"✅ All linting passed!\"\n```\n\n### 7. Update format script\n```bash\n#!/bin/bash\n# format-all.sh - Format both Python and JavaScript\n\nset -e\necho \"=== Formatting Python ===\"\n./format.sh\n\necho \"\"\necho \"=== Formatting JavaScript ===\"\nnpm run format\n\necho \"\"\necho \"✅ All formatting complete!\"\n```\n\n### 8. Add pre-commit hook (optional)\n```bash\n# .husky/pre-commit (if using husky)\nnpm run lint\nnpm run format:check\n```\n\nOr using Python pre-commit:\n```yaml\n# .pre-commit-config.yaml\nrepos:\n  - repo: local\n    hooks:\n      - id: eslint\n        name: ESLint\n        entry: npm run lint\n        language: system\n        files: \\.js$\n      - id: prettier\n        name: Prettier\n        entry: npm run format:check\n        language: system\n        files: \\.js$\n```\n\n### 9. VS Code integration (optional)\n```json\n// .vscode/settings.json\n{\n  \"editor.formatOnSave\": true,\n  \"editor.defaultFormatter\": \"esbenp.prettier-vscode\",\n  \"[javascript]\": {\n    \"editor.defaultFormatter\": \"esbenp.prettier-vscode\"\n  },\n  \"eslint.validate\": [\"javascript\"]\n}\n```\n\n## Initial Cleanup\nFirst run will likely find many issues. Plan to:\n1. Run `npm run lint` to see issues\n2. Run `npm run lint:fix` to auto-fix what can be fixed\n3. Run `npm run format` to format all files\n4. Manually fix remaining issues\n5. Commit as \"chore: add ESLint/Prettier and fix linting issues\"\n\n## Files Created\n- eslint.config.js\n- .prettierrc\n- .prettierignore\n- lint-all.sh\n- format-all.sh\n- .vscode/settings.json (optional)\n\n## Files Modified\n- package.json (add scripts)\n- Potentially all JS files (formatting)\n\n## Verification\n- `npm run lint` passes with no errors\n- `npm run format:check` passes\n- VS Code shows lint errors inline\n- CI fails on lint errors (if configured)","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:32:50.508565862Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:32:50.508565862Z","dependencies":[{"issue_id":"battycoda-nl9","depends_on_id":"battycoda-ehr","type":"blocks","created_at":"2026-01-13T23:33:31.374614278Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-ofc","title":"Clean up orphaned root-level utility scripts","description":"## Problem\nRoot-level Python scripts that are not imported anywhere - likely development artifacts.\n\n## Scripts to Review\n\n| File | Description |\n|------|-------------|\n| check_task_segment.py | Debug script for specific task ID |\n| check_css_classes.py | CSS class analyzer |\n| test_hdf5_methods.py | HDF5 testing/benchmarking |\n| generate_favicon.py | Favicon generation utility |\n| format_training_folder.py | Data formatting utility |\n| label_rousettus_training_data.py | Training data labeling |\n\n## Decision Needed\nFor each script, decide:\n1. Delete if no longer needed\n2. Move to scripts/ folder if still useful\n3. Add to .gitignore if development-only\n\n## Note\nbrowser_automation.py was already deleted (contained hardcoded credentials).","status":"open","priority":3,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T01:24:29.969358049Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T01:24:29.969358049Z"}
{"id":"battycoda-oo0","title":"Fix unused exception variables in except blocks","description":"## Problem\nException variables caught but never used. Should either use the variable or remove it.\n\n## Locations\n\n| File | Lines |\n|------|-------|\n| battycoda_app/audio/task_modules/base.py | 98 |\n| battycoda_app/audio/batch_utils.py | 61, 168 |\n| battycoda_app/audio/modules/file_utils.py | 161, 191 |\n| battycoda_app/utils_modules/demo_utils.py | 71, 169, 227, 275, 349 |\n\n## Fix Pattern\n# If exception not used, remove the variable:\n# Instead of:\nexcept Exception as e:\n    pass\n\n# Use:\nexcept Exception:\n    pass\n\n# Or better, log it:\nexcept Exception:\n    logger.exception('Error during X')\n\n## Verification\nRun linter - it should flag unused variables.","status":"open","priority":3,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T01:25:45.227799256Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T01:25:45.227799256Z"}
{"id":"battycoda-pwc","title":"Add frontend error tracking (Sentry or similar)","description":"## Problem\nNo mechanism to alert when users encounter JavaScript errors in the browser. Errors fail silently.\n\n## Current State\n- Toastr shows user-facing messages but doesn't report to server\n- No `window.onerror` handler\n- No `unhandledrejection` handler for Promise errors\n- No error tracking service (Sentry, Rollbar, etc.)\n\n## Solution: Add Sentry\n\n### 1. Install Sentry SDK\n```bash\npip install sentry-sdk[django]\nnpm install @sentry/browser  # For Vite bundle\n```\n\n### 2. Configure Django Sentry (config/settings.py)\n```python\nimport sentry_sdk\nfrom sentry_sdk.integrations.django import DjangoIntegration\nfrom sentry_sdk.integrations.celery import CeleryIntegration\n\nsentry_sdk.init(\n    dsn=os.environ.get(\"SENTRY_DSN\"),\n    integrations=[\n        DjangoIntegration(),\n        CeleryIntegration(),\n    ],\n    traces_sample_rate=0.1,  # 10% of requests\n    send_default_pii=True,\n    environment=os.environ.get(\"SENTRY_ENVIRONMENT\", \"production\"),\n)\n```\n\n### 3. Add Frontend Sentry (static/js/sentry.js)\n```javascript\nimport * as Sentry from '@sentry/browser';\n\nSentry.init({\n  dsn: window.SENTRY_DSN,  // Set from Django template\n  environment: window.SENTRY_ENVIRONMENT,\n  integrations: [\n    Sentry.browserTracingIntegration(),\n  ],\n  tracesSampleRate: 0.1,\n});\n\n// Add user context if logged in\nif (window.USER_ID) {\n  Sentry.setUser({ id: window.USER_ID, email: window.USER_EMAIL });\n}\n```\n\n### 4. Add global error handler (fallback for non-Sentry)\n```javascript\n// static/js/utils/error-handler.js\nwindow.onerror = function(msg, url, lineNo, columnNo, error) {\n  console.error('Global error:', { msg, url, lineNo, columnNo, error });\n  // Sentry captures this automatically if configured\n  return false;\n};\n\nwindow.addEventListener('unhandledrejection', function(event) {\n  console.error('Unhandled promise rejection:', event.reason);\n});\n```\n\n### 5. Update base.html to include Sentry config\n```html\n\u003cscript\u003e\n  window.SENTRY_DSN = \"{{ SENTRY_DSN }}\";\n  window.SENTRY_ENVIRONMENT = \"{{ SENTRY_ENVIRONMENT }}\";\n  {% if user.is_authenticated %}\n  window.USER_ID = \"{{ user.id }}\";\n  window.USER_EMAIL = \"{{ user.email }}\";\n  {% endif %}\n\u003c/script\u003e\n```\n\n## Alternative: Simple Error Logging Endpoint\nIf Sentry is overkill, create a simple endpoint:\n\n```python\n# battycoda_app/views_errors.py\n@csrf_exempt\ndef log_js_error(request):\n    if request.method == 'POST':\n        data = json.loads(request.body)\n        logger.error(f\"JS Error: {data['message']}\", extra={\n            'url': data.get('url'),\n            'line': data.get('line'),\n            'user_id': request.user.id if request.user.is_authenticated else None,\n        })\n        return JsonResponse({'logged': True})\n```\n\n```javascript\nwindow.onerror = function(msg, url, lineNo, columnNo, error) {\n  fetch('/api/log-error/', {\n    method: 'POST',\n    headers: {'Content-Type': 'application/json', 'X-CSRFToken': csrfToken},\n    body: JSON.stringify({message: msg, url: url, line: lineNo, stack: error?.stack})\n  });\n};\n```\n\n## Environment Variables to Add\n```\nSENTRY_DSN=https://xxx@xxx.ingest.sentry.io/xxx\nSENTRY_ENVIRONMENT=production\n```\n\n## Verification\n- Trigger a JS error intentionally\n- Verify it appears in Sentry dashboard (or logs)\n- Verify user context is attached\n- Test in both dev and prod environments","status":"closed","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T00:02:44.945093816Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:59:19.068546011Z","closed_at":"2026-01-13T18:53:27.546174-06:00"}
{"id":"battycoda-pwr","title":"Phase 2: Vitest Unit Testing Setup","description":"## Overview\nSet up Vitest for unit testing JavaScript modules. Vitest integrates natively with Vite and provides fast, modern testing.\n\n## Goals\n- Unit test coverage for core JS logic\n- Fast test execution (watch mode)\n- Coverage reporting\n- CI integration\n\n## What to Test\n- Pure functions (data transformations, calculations)\n- State management logic\n- API response parsing\n- Utility functions\n- Event handlers (in isolation)\n\n## What NOT to Test with Vitest\n- DOM manipulation (use Playwright)\n- Full user flows (use Playwright)\n- Django template integration (use Playwright)\n\n## Success Criteria\n- `npm test` runs all unit tests\n- `npm run test:coverage` generates coverage report\n- Tests run in CI pipeline\n- \u003e80% coverage on utility modules","status":"open","priority":1,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T23:08:25.942118708Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:08:25.942118708Z"}
{"id":"battycoda-q71","title":"Configure source maps for production error tracking","description":"## Problem\nProduction errors in minified JS are unreadable:\n```\nTypeError: Cannot read property 'x' of undefined\n    at e (main-abc123.js:1:23456)\n```\n\nNeed source maps for debugging, but security concerns about exposing them.\n\n## Solution Options\n\n### Option A: Hidden Source Maps (Recommended)\nGenerate source maps but don't serve them publicly. Upload to error tracking service.\n\n```javascript\n// vite.config.js\nexport default defineConfig({\n  build: {\n    sourcemap: 'hidden',  // Generates .map files but doesn't reference them in output\n  }\n});\n```\n\n### Option B: External Source Maps\nServe from separate, protected location.\n\n### Option C: No Source Maps\nNot recommended for production debugging.\n\n## Implementation (Option A: Hidden Source Maps)\n\n### 1. Configure Vite for hidden source maps\n```javascript\n// vite.config.js\nexport default defineConfig({\n  build: {\n    sourcemap: process.env.NODE_ENV === 'production' ? 'hidden' : true,\n    rollupOptions: {\n      output: {\n        // Keep source map filenames predictable\n        sourcemapFileNames: '[name]-[hash].js.map',\n      }\n    }\n  }\n});\n```\n\n### 2. Set up Sentry (or similar) for error tracking\n```bash\nnpm install --save-dev @sentry/vite-plugin\n```\n\n```javascript\n// vite.config.js\nimport { sentryVitePlugin } from '@sentry/vite-plugin';\n\nexport default defineConfig({\n  plugins: [\n    sentryVitePlugin({\n      org: 'your-org',\n      project: 'battycoda',\n      authToken: process.env.SENTRY_AUTH_TOKEN,\n      sourcemaps: {\n        assets: './static/dist/**',\n      },\n    }),\n  ],\n  build: {\n    sourcemap: true,  // Sentry plugin handles hiding\n  }\n});\n```\n\n### 3. Alternative: Manual source map upload\nIf not using Sentry, upload maps manually:\n```bash\n# scripts/upload-sourcemaps.sh\n#!/bin/bash\n# Upload source maps to your error tracking service\n\nMAPS_DIR=\"static/dist\"\nfor map in $MAPS_DIR/*.map; do\n  echo \"Uploading $map...\"\n  # curl to your service\ndone\n\n# Delete source maps from deploy (don't serve them)\nrm -f $MAPS_DIR/*.map\n```\n\n### 4. Add to deployment script\n```bash\n# scripts/deploy.sh\nnpm run build\n\n# Upload source maps to error tracking\n./scripts/upload-sourcemaps.sh\n\n# Collect static (maps already removed)\npython manage.py collectstatic --noinput\n```\n\n### 5. For development: keep source maps enabled\n```javascript\n// vite.config.js\nexport default defineConfig({\n  build: {\n    sourcemap: process.env.NODE_ENV === 'production' \n      ? 'hidden'   // Production: generate but hide\n      : true       // Development: inline\n  }\n});\n```\n\n## Without External Service\nIf not using Sentry/similar, you can still use source maps for debugging:\n\n### Local debugging with production build\n```bash\n# Keep maps locally for debugging\nnpm run build\n# Maps are in static/dist/*.map\n\n# When debugging production issue:\n# 1. Get the minified stack trace\n# 2. Use source-map library to decode:\nnpx source-map resolve static/dist/main-abc123.js.map 1:23456\n```\n\n## Security Considerations\n- Source maps reveal original code structure\n- Don't serve .map files publicly\n- Either upload to error service or delete from deploy\n- Nginx should block .map files just in case:\n```nginx\nlocation ~* \\.map$ {\n  return 404;\n}\n```\n\n## Files Created/Modified\n- vite.config.js (sourcemap config)\n- scripts/upload-sourcemaps.sh (if not using Sentry)\n- scripts/deploy.sh (updated)\n- nginx config (block .map files)\n\n## Verification\n- Production errors show readable stack traces (in Sentry)\n- .map files not accessible via browser\n- Build generates source maps\n- Deployment removes/uploads source maps","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:31:58.320547781Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:31:58.320547781Z","dependencies":[{"issue_id":"battycoda-q71","depends_on_id":"battycoda-10n","type":"blocks","created_at":"2026-01-13T23:33:39.152704618Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-qky","title":"Phase 2: Architecture Refactor","description":"## Scope\nRefactor clustering JS/CSS architecture for maintainability.\n\n## Tasks (from CLUSTERING_VISUALIZATION_OVERHAUL.md)\n1. Consolidate 3 JS loading patterns into single IIFE pattern\n2. Create centralized ClusteringApp state management object\n3. Extract permission checks to decorator/mixin in views_clustering/\n4. Consolidate duplicate CSS (cluster_explorer.css + mapping_interface.css → clustering.css)\n\n## Details\n\n### JS Loading Patterns to Consolidate\n- cluster_explorer.js: Custom dynamic script loader\n- cluster_mapping.js: ES6 imports (broken)\n- mapping_interface.js: setTimeout + script injection\n\n### State Variables to Centralize\n- selectedClusterId (in 3+ files)\n- clusters array\n- clusteringRunId\n\n### Permission Check Pattern (repeated 12+ times)\n```python\nif not request.user.is_staff:\n    if clustering_run.group and clustering_run.group != request.user.profile.group:\n        return JsonResponse({'status': 'error', ...})\n```\n\n## Estimated Effort\n8-16 hours","status":"open","priority":2,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T22:14:59.290027423Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:14:59.290027423Z"}
{"id":"battycoda-tku","title":"Update CLAUDE.md with Vite/Vitest/Playwright architecture documentation","description":"## Task\nAdd comprehensive documentation to CLAUDE.md describing the new JavaScript build and testing architecture.\n\n## Location in CLAUDE.md\nAdd new sections after the \"## Code Style Guidelines\" section.\n\n## Exact Content to Add\n\n### Section 1: JavaScript Build System\n\n```markdown\n## JavaScript Build System (Vite)\n\nBattyCoda uses Vite for JavaScript bundling and development.\n\n### Directory Structure\n```\nstatic/\n├── js/\n│   ├── main.js              # Main entry point\n│   ├── utils/               # Shared utilities\n│   │   ├── csrf.js          # CSRF token handling\n│   │   └── page-data.js     # Django template data access\n│   ├── player/              # Waveform player module\n│   ├── cluster_explorer/    # Clustering visualization\n│   ├── cluster_mapping/     # Cluster-to-call mapping\n│   ├── file_upload/         # File upload handling\n│   └── test/                # Test setup and fixtures\n├── css/\n│   ├── main.css             # CSS entry point\n│   └── themes/              # Theme CSS files\n└── dist/                    # Built output (gitignored)\n```\n\n### Development Commands\n```bash\n# Start Vite dev server (port 5173)\nnpm run dev\n\n# Build for production\nnpm run build\n\n# Preview production build\nnpm run preview\n```\n\n### Development Workflow\n```bash\n# Option 1: Run everything with honcho\n./scripts/dev.sh\n\n# Option 2: Run minimal (Django + Vite only)\n./scripts/dev-minimal.sh\n\n# Option 3: Manual (separate terminals)\nnpm run dev              # Terminal 1: Vite\npython manage.py runserver  # Terminal 2: Django\n```\n\n### Adding New JavaScript Modules\n\n1. Create module in appropriate directory:\n   ```javascript\n   // static/js/feature/mymodule.js\n   export function myFunction() { ... }\n   ```\n\n2. Add entry point if needed in vite.config.js:\n   ```javascript\n   rollupOptions: {\n     input: {\n       myFeature: resolve(__dirname, 'static/js/feature/index.js'),\n     }\n   }\n   ```\n\n3. Load in Django template:\n   ```html\n   {% load vite %}\n   {% vite_asset 'myFeature.js' %}\n   ```\n\n### Accessing Django Data in JavaScript\n\nUse data attributes pattern (not inline scripts):\n\n```html\n\u003c!-- In template --\u003e\n\u003cdiv id=\"app-data\"\n     data-recording-id=\"{{ recording.id }}\"\n     data-api-url=\"{% url 'api:endpoint' %}\"\n     style=\"display: none;\"\u003e\n\u003c/div\u003e\n```\n\n```javascript\n// In JavaScript\nimport { getPageData } from './utils/page-data.js';\nconst { recordingId, apiUrl } = getPageData();\n```\n\n### CSRF Tokens in AJAX Requests\n\n```javascript\nimport { fetchWithCsrf } from './utils/csrf.js';\n\nconst response = await fetchWithCsrf('/api/endpoint/', {\n  method: 'POST',\n  body: JSON.stringify(data)\n});\n```\n\n### External Dependencies (CDN)\nThese libraries are loaded via CDN, not bundled:\n- jQuery 3.3.1\n- Bootstrap 5.3\n- Toastr\n- Select2\n\nD3.js is bundled via npm for tree-shaking benefits.\n```\n\n### Section 2: JavaScript Testing\n\n```markdown\n## JavaScript Testing\n\n### Unit Tests (Vitest)\n\nUnit tests for JavaScript logic using Vitest.\n\n```bash\n# Run tests in watch mode\nnpm test\n\n# Run tests once\nnpm run test:run\n\n# Run with coverage\nnpm run test:coverage\n\n# Open Vitest UI\nnpm run test:ui\n```\n\n**Test file location:** Place `.test.js` files next to the module they test:\n```\nstatic/js/\n├── utils/\n│   ├── csrf.js\n│   └── csrf.test.js    # Tests for csrf.js\n├── player/\n│   ├── data_manager.js\n│   └── data_manager.test.js\n```\n\n**Writing tests:**\n```javascript\nimport { describe, it, expect, vi } from 'vitest';\nimport { myFunction } from './mymodule.js';\n\ndescribe('myFunction', () =\u003e {\n  it('should return expected value', () =\u003e {\n    expect(myFunction(input)).toBe(expected);\n  });\n});\n```\n\n### E2E Tests (Playwright)\n\nEnd-to-end tests for full user workflows.\n\n```bash\n# Run E2E tests\nnpm run e2e\n\n# Run with browser visible\nnpm run e2e:headed\n\n# Open Playwright UI\nnpm run e2e:ui\n\n# View test report\nnpm run e2e:report\n```\n\n**Test file location:** `tests/e2e/specs/`\n```\ntests/e2e/\n├── playwright.config.js\n├── fixtures/           # Test data files\n├── helpers/            # Shared test utilities\n│   ├── auth.js         # Login helpers\n│   └── api.js          # API helpers\n└── specs/              # Test files\n    ├── auth.spec.js\n    ├── recordings.spec.js\n    └── clustering.spec.js\n```\n\n**E2E tests use a separate test database.** Set `DJANGO_TEST_MODE=1` to use it.\n\n**Writing E2E tests:**\n```javascript\nimport { test, expect } from '@playwright/test';\nimport { login } from '../helpers/auth.js';\n\ntest('user can upload recording', async ({ page }) =\u003e {\n  await login(page, 'test@example.com', 'password');\n  await page.goto('/recordings/upload/');\n  // ... test steps\n  await expect(page.locator('.success')).toBeVisible();\n});\n```\n\n### Test Database\n\nE2E tests use a separate PostgreSQL database (`battycoda_test`) to avoid polluting development data.\n\n```bash\n# Set up test database\nnpm run e2e:setup-db\n\n# Reset test database\nnpm run e2e:reset-db\n```\n```\n\n### Section 3: JavaScript Linting\n\n```markdown\n## JavaScript Linting\n\n```bash\n# Lint JavaScript\nnpm run lint\n\n# Auto-fix lint issues\nnpm run lint:fix\n\n# Format with Prettier\nnpm run format\n\n# Check formatting\nnpm run format:check\n\n# Lint everything (Python + JavaScript)\n./lint-all.sh\n\n# Format everything\n./format-all.sh\n```\n```\n\n## Verification Checklist\nAfter adding documentation:\n- [ ] All code blocks have correct syntax highlighting\n- [ ] All file paths are accurate\n- [ ] All npm scripts match package.json\n- [ ] Commands are tested and work\n- [ ] No placeholder text remains\n\n## Dependencies\nThis task should be done AFTER:\n- Vite is set up and working\n- Vitest is configured\n- Playwright is configured\n\nOr can be done as a template BEFORE implementation, then verified after.","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:45:24.654639205Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:45:24.654639205Z","dependencies":[{"issue_id":"battycoda-tku","depends_on_id":"battycoda-10n","type":"blocks","created_at":"2026-01-13T23:45:33.545013056Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-tuv","title":"Add input validation for API query parameters","description":"## Problem\nSeveral API endpoints convert user input directly to int() without try-except, causing crashes on invalid input.\n\n## Vulnerable Locations\n\n### 1. battycoda_app/simple_api/task_views.py (Lines 244-245)\n```python\nlimit = int(request.GET.get('limit', 50))\noffset = int(request.GET.get('offset', 0))\n```\nCrashes with ValueError if user sends `?limit=abc`\n\n### 2. battycoda_app/simple_api/recording_upload.py (Line 54)\n```python\nspecies_id = int(species_id)\n```\nCrashes if species_id is not numeric.\n\n## Fix Pattern\n\n### Create validation helper\n```python\n# battycoda_app/utils/validation.py\n\ndef get_int_param(request, param_name, default=None, min_val=None, max_val=None):\n    \"\"\"Safely get an integer query parameter.\"\"\"\n    value = request.GET.get(param_name)\n    if value is None:\n        return default\n    try:\n        result = int(value)\n        if min_val is not None and result \u003c min_val:\n            result = min_val\n        if max_val is not None and result \u003e max_val:\n            result = max_val\n        return result\n    except (ValueError, TypeError):\n        return default\n```\n\n### Apply fix\n```python\n# Before\nlimit = int(request.GET.get('limit', 50))\n\n# After\nfrom battycoda_app.utils.validation import get_int_param\nlimit = get_int_param(request, 'limit', default=50, min_val=1, max_val=1000)\n```\n\n## Files to Fix\n1. battycoda_app/simple_api/task_views.py\n2. battycoda_app/simple_api/recording_upload.py\n3. Any other files with unguarded int() on request params\n\n## Verification\n- Send `?limit=abc` to API - should return default, not crash\n- Send `?limit=-1` - should be clamped to min\n- Send `?limit=999999` - should be clamped to max\n- Run API tests","status":"closed","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T00:03:44.809974234Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:59:19.07811147Z","closed_at":"2026-01-13T18:38:42.249567-06:00"}
{"id":"battycoda-wgn","title":"Handle inline scripts and Django template variables in JS","description":"## Problem\nMany templates pass data from Django to JS via inline scripts:\n\n```html\n\u003cscript\u003e\nvar recordingId = {{ recording.id }};\nvar segmentationId = {{ segmentation.id }};\nvar apiUrl = \"{% url 'battycoda_app:api_endpoint' %}\";\nvar clusters = {{ clusters_json|safe }};\nvar csrfToken = \"{{ csrf_token }}\";\n\u003c/script\u003e\n```\n\nES6 modules can't access these globals reliably. Need a clean pattern.\n\n## Solution: Data Attributes Pattern\n\n### 1. Define data container in templates\n```html\n\u003c!-- In template --\u003e\n\u003cdiv id=\"app-data\"\n     data-recording-id=\"{{ recording.id }}\"\n     data-segmentation-id=\"{{ segmentation.id }}\"\n     data-api-url=\"{% url 'battycoda_app:api_endpoint' %}\"\n     data-csrf-token=\"{{ csrf_token }}\"\n     style=\"display: none;\"\u003e\n\u003c/div\u003e\n\n\u003c!-- For complex data (JSON) --\u003e\n\u003cscript id=\"clusters-data\" type=\"application/json\"\u003e\n{{ clusters_json|safe }}\n\u003c/script\u003e\n```\n\n### 2. Create JS utility to read data\n```javascript\n// static/js/utils/page-data.js\n\n/**\n * Reads data attributes from the app-data container\n */\nexport function getPageData() {\n  const container = document.getElementById('app-data');\n  if (!container) {\n    console.warn('No app-data container found');\n    return {};\n  }\n  \n  const data = {};\n  for (const attr of container.attributes) {\n    if (attr.name.startsWith('data-')) {\n      // Convert data-recording-id to recordingId\n      const key = attr.name\n        .replace('data-', '')\n        .replace(/-([a-z])/g, (_, c) =\u003e c.toUpperCase());\n      \n      // Try to parse as number/boolean\n      data[key] = parseValue(attr.value);\n    }\n  }\n  return data;\n}\n\n/**\n * Reads JSON data from a script tag\n */\nexport function getJsonData(scriptId) {\n  const script = document.getElementById(scriptId);\n  if (!script) return null;\n  \n  try {\n    return JSON.parse(script.textContent);\n  } catch (e) {\n    console.error(`Failed to parse JSON from #${scriptId}:`, e);\n    return null;\n  }\n}\n\nfunction parseValue(value) {\n  if (value === 'true') return true;\n  if (value === 'false') return false;\n  if (value === 'null') return null;\n  if (/^\\d+$/.test(value)) return parseInt(value, 10);\n  if (/^\\d+\\.\\d+$/.test(value)) return parseFloat(value);\n  return value;\n}\n```\n\n### 3. Update modules to use page data\n```javascript\n// Before\nfunction initializeVisualization() {\n  const id = recordingId;  // Global variable\n  fetch(`/api/recording/${id}/`);\n}\n\n// After\nimport { getPageData } from './utils/page-data.js';\n\nfunction initializeVisualization() {\n  const { recordingId } = getPageData();\n  fetch(`/api/recording/${recordingId}/`);\n}\n```\n\n### 4. Create template snippet for common pattern\n```html\n\u003c!-- templates/includes/app_data.html --\u003e\n\u003cdiv id=\"app-data\"\n     {% for key, value in data_attrs.items %}\n     data-{{ key }}=\"{{ value }}\"\n     {% endfor %}\n     style=\"display: none;\"\u003e\n\u003c/div\u003e\n{% if json_data %}\n{% for name, data in json_data.items %}\n\u003cscript id=\"{{ name }}-data\" type=\"application/json\"\u003e\n{{ data|safe }}\n\u003c/script\u003e\n{% endfor %}\n{% endif %}\n```\n\n### 5. Update views to prepare data\n```python\n# In view\ndef recording_detail(request, pk):\n    recording = get_object_or_404(Recording, pk=pk)\n    \n    context = {\n        'recording': recording,\n        'data_attrs': {\n            'recording-id': recording.id,\n            'api-url': reverse('battycoda_app:recording_api', args=[pk]),\n            'csrf-token': get_token(request),\n        },\n        'json_data': {\n            'segments': json.dumps([s.to_dict() for s in recording.segments]),\n        }\n    }\n    return render(request, 'recording_detail.html', context)\n```\n\n## Templates to Update\nAll templates currently using inline script variables:\n- templates/recordings/recording_detail.html\n- templates/clustering/cluster_explorer.html\n- templates/clustering/create_run.html\n- templates/clustering/cluster_mapping.html\n- templates/tasks/task_annotation.html\n- templates/segmentation/segmentation_detail.html\n\n## Files Created\n- static/js/utils/page-data.js\n- templates/includes/app_data.html\n\n## Files Modified\n- All templates with inline scripts\n- All JS modules reading global variables\n\n## Verification\n- No more global variables for page data\n- All features still work\n- Data accessible in ES6 modules\n- JSON data parses correctly","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:28:26.509662522Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:28:26.509662522Z","dependencies":[{"issue_id":"battycoda-wgn","depends_on_id":"battycoda-lpe","type":"blocks","created_at":"2026-01-13T23:33:30.898226606Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-ybn","title":"Review hardcoded 'Unknown' placeholder in task annotation","description":"## Problem\nHardcoded placeholder value in views_task_annotation.py.\n\n## Location\nbattycoda_app/views_task_annotation.py (Lines 129-131):\n\ncall_types.append('Unknown')\ncall_descriptions['Unknown'] = 'Unspecified call type'\n\n## Question\nIs this intentional UX (providing an 'Unknown' option for annotators) or a lazy fallback?\n\nIf intentional: Document why it exists\nIf not: Remove or make configurable","status":"open","priority":3,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-14T01:26:08.400645535Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T01:26:08.400645535Z"}
{"id":"battycoda-yf0","title":"Clustering Visualization Overhaul","description":"## Overview\nComplete overhaul of the clustering visualization system. The current implementation has multiple critical bugs that prevent basic functionality from working.\n\nSee CLUSTERING_VISUALIZATION_OVERHAUL.md for the full analysis including:\n- Red team review findings\n- Architecture issues  \n- Quality improvements needed\n- Accessibility gaps\n\n## Critical Path (Priority Order)\n1. yf0.1 - Fix base.html extra_js placement (affects ALL clustering pages)\n2. yf0.2 - Fix create_run.html script block (can't create new runs)\n3. yf0.3 - Fix ES6 modules (mapping interface completely broken)\n4. yf0.4 - Fix delete URL mismatch (depends on yf0.3)\n5. yf0.5 - Remove duplicate handlers (causes double API calls)\n\n## Testing Checklist\nAfter all fixes:\n- [ ] /clustering/ dashboard loads, auto-refresh works\n- [ ] /clustering/create/ form is interactive\n- [ ] /clustering/run/\u003cid\u003e/ progress updates\n- [ ] /clustering/explorer/\u003cid\u003e/ visualization renders\n- [ ] /clustering/mapping/\u003cid\u003e/ drag-drop works, delete works\n\n## Future Work (not in this epic)\n- Consolidate JS to single loading pattern\n- Add proper error handling\n- Fix Bootstrap 4/5 class inconsistencies\n- Add keyboard navigation\n- Accessibility improvements","status":"closed","priority":1,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T21:48:05.19951375Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:10:48.911026499Z","closed_at":"2026-01-14T00:10:48.911026499Z","close_reason":"All 6 child tasks completed: JS loading order fixed, ES6 modules converted to IIFE namespace pattern, URL mismatch fixed, duplicate handlers removed"}
{"id":"battycoda-yf0.1","title":"Fix base.html: Move extra_js block after jQuery","description":"## Problem\nIn templates/base.html, the {% block extra_js %} is at line 211, but jQuery loads at line 214.\nAny template with inline $(document).ready() in extra_js fails with 'ReferenceError: $ is not defined'.\n\n## Affected Templates\n- clustering/dashboard.html - auto-refresh broken\n- clustering/run_detail.html - progress polling broken\n\n## Fix\nMove line 211 (`{% block extra_js %}{% endblock %}`) to AFTER line 227 (after all core scripts including jQuery, Bootstrap, app.js, etc.)\n\n## Verification\n1. After fix, visit /clustering/ and check browser console for JS errors\n2. Create a clustering run and verify progress auto-refresh works","status":"closed","priority":0,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T21:48:52.207508074Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:59:39.610064181Z","closed_at":"2026-01-13T23:59:39.610064181Z","close_reason":"Moved extra_js block from line 211 to line 313, after all core scripts including jQuery","dependencies":[{"issue_id":"battycoda-yf0.1","depends_on_id":"battycoda-yf0","type":"parent-child","created_at":"2026-01-13T21:48:52.210986439Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-yf0.2","title":"Fix create_run.html: Move script inside template block","description":"## Problem\nIn templates/clustering/create_run.html, lines 244-374 contain a \u003cscript\u003e block that is placed AFTER {% endblock %} (line 242).\n\nDjango template inheritance ignores content outside blocks, so this 130-line script is NEVER rendered.\n\n## Impact\nAll interactivity on the create clustering run page is broken:\n- Scope toggle (single recording vs project)\n- Project/species selection AJAX\n- Algorithm type detection (manual vs auto)\n- Form validation\n\n## Fix\n1. Add {% block extra_js %} before line 244\n2. Add {% endblock %} after line 374\n3. Or move the script inside the existing content block\n\n## Code Change\n```html\n\u003c!-- Line 242 currently --\u003e\n{% endblock %}\n\n\u003cscript\u003e  \u003c!-- THIS NEVER RENDERS --\u003e\n\n\u003c!-- Should be: --\u003e\n{% endblock %}\n\n{% block extra_js %}\n\u003cscript\u003e\n...\n\u003c/script\u003e\n{% endblock %}\n```\n\n## Verification\n1. Visit /clustering/create/\n2. Toggle between 'Single Recording' and 'Entire Project' - should animate\n3. Select a project - should fetch species via AJAX\n4. Select an algorithm - should show/hide cluster count field","status":"closed","priority":0,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T21:48:52.292853184Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:00:15.212348431Z","closed_at":"2026-01-14T00:00:15.212348431Z","close_reason":"Wrapped script block in {% block extra_js %}...{% endblock %} so it renders properly","dependencies":[{"issue_id":"battycoda-yf0.2","depends_on_id":"battycoda-yf0","type":"parent-child","created_at":"2026-01-13T21:48:52.295966283Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-yf0.3","title":"Fix ES6 module loading in cluster_mapping.js","description":"## Problem\nstatic/js/cluster_mapping.js uses ES6 import statements but is loaded as a regular script (not type='module').\n\nFiles using ES6 syntax:\n- static/js/cluster_mapping.js (line 7-10: import statements)\n- static/js/cluster_mapping/initialization.js (export statements)\n- static/js/cluster_mapping/drag_drop.js (export statements)\n- static/js/cluster_mapping/modal_handlers.js (export statements)\n- static/js/cluster_mapping/filtering.js (export statements)\n\n## Impact\nThe entire cluster mapping interface is broken. Browser throws SyntaxError on import statements.\n\n## Fix Options\n\n### Option A: Convert to IIFE pattern (Recommended - no build tools needed)\n1. Remove all import/export statements\n2. Wrap each module in an IIFE\n3. Attach functions to a global ClusterMapping namespace\n4. Load scripts in dependency order in the template\n\n### Option B: Add type='module' \n1. In mapping_interface.html, change script loading to use type='module'\n2. Ensure all import paths are correct (may need .js extensions)\n3. Note: This changes how scripts load and may have side effects\n\n## Files to Modify\n- static/js/cluster_mapping.js\n- static/js/cluster_mapping/initialization.js\n- static/js/cluster_mapping/drag_drop.js\n- static/js/cluster_mapping/modal_handlers.js\n- static/js/cluster_mapping/filtering.js\n- templates/clustering/mapping_interface.html (if using Option B)\n\n## Verification\n1. Visit /clustering/mapping/\u003crun_id\u003e/ for a completed clustering run\n2. Check browser console - should have no SyntaxError\n3. Drag a cluster to a call type - should create mapping\n4. Delete a mapping - should work (also tests yf0.4)","status":"closed","priority":0,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T21:48:52.376442449Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:04:33.546548181Z","closed_at":"2026-01-14T00:04:33.546548181Z","close_reason":"Converted ES6 modules to IIFE pattern with ClusterMapping namespace; updated template to load scripts in correct dependency order","dependencies":[{"issue_id":"battycoda-yf0.3","depends_on_id":"battycoda-yf0","type":"parent-child","created_at":"2026-01-13T21:48:52.378633343Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-yf0.4","title":"Fix URL mismatch: delete-mapping endpoint","description":"## Problem\nURL mismatch between Python backend and JavaScript frontend for delete mapping endpoint.\n\nPython (clustering_urls.py line 23):\n  path('clustering/delete-mapping/', ...)\n\nJavaScript (static/js/cluster_mapping/drag_drop.js line 186):\n  url: '/clustering/delete-cluster-mapping/'\n\n## Impact\nDeleting cluster mappings fails with 404 error. Users cannot remove mappings once created.\n\n## Fix\nChange drag_drop.js line 186 from:\n  url: '/clustering/delete-cluster-mapping/',\nto:\n  url: '/clustering/delete-mapping/',\n\n## Alternative Fix\nCould change Python URL instead, but JS fix is simpler and matches the naming pattern of other endpoints (create-mapping, update-mapping-confidence).\n\n## Related URLs (verified correct)\n- /clustering/create-mapping/ ✓\n- /clustering/update-mapping-confidence/ ✓\n- /clustering/delete-mapping/ ← JS needs to match this\n\n## Verification\n1. Go to mapping interface for a completed clustering run\n2. Create a test mapping (drag cluster to call type)\n3. Click the X button to delete the mapping\n4. Should succeed (check Network tab - should be 200, not 404)\n\n## Note\nThis fix depends on yf0.3 (ES6 modules) being fixed first, otherwise the JS won't even load.","status":"closed","priority":0,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T21:48:52.453264548Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:05:06.091652583Z","closed_at":"2026-01-14T00:05:06.091652583Z","close_reason":"Fixed URL from /clustering/delete-cluster-mapping/ to /clustering/delete-mapping/ to match Django endpoint","dependencies":[{"issue_id":"battycoda-yf0.4","depends_on_id":"battycoda-yf0","type":"parent-child","created_at":"2026-01-13T21:48:52.455332083Z","created_by":"Kevin Boergens"},{"issue_id":"battycoda-yf0.4","depends_on_id":"battycoda-yf0.3","type":"blocks","created_at":"2026-01-13T22:03:14.404435334Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-yf0.5","title":"Remove duplicate event handlers","description":"## Problem\nEvent handlers are registered twice for the same elements, causing double API calls and potential race conditions.\n\n### Duplicate 1: #save-cluster-label click\n- static/js/cluster_explorer/visualization.js line 21\n- static/js/cluster_explorer/controls.js line 46\n\n### Duplicate 2: .view-segment-btn click  \n- static/js/cluster_explorer/visualization.js line 28\n- static/js/cluster_explorer/controls.js line 51\n\n## Impact\n- Clicking 'Save' on cluster label triggers two API calls\n- Clicking 'View' on segment triggers two modal loads\n- Race conditions may cause inconsistent UI state\n\n## Fix\nRemove the duplicate handlers from controls.js (lines 46-54), keeping them in visualization.js.\n\nOr alternatively, remove from visualization.js and keep in controls.js - just pick one location.\n\n## Code to Remove (controls.js lines 44-55)\n```javascript\n// DELETE THESE LINES:\n.ready(function() {\n    // Handle save button click\n    $('#save-cluster-label').click(function() {\n        saveClusterLabel();\n    });\n\n    // Handle segment view button click\n    $(document).on('click', '.view-segment-btn', function() {\n        const segmentId = $(this).data('segment-id');\n        loadSegmentDetails(segmentId);\n    });\n    // ... keep the rest (point-size, cluster-opacity handlers)\n});\n```\n\n## Verification\n1. Go to cluster explorer for a completed run\n2. Select a cluster, edit the label, click Save\n3. Check Network tab - should see only ONE POST request\n4. Click 'View' on a segment - should see only ONE GET request","status":"closed","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T21:48:52.533134397Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:05:40.928226984Z","closed_at":"2026-01-14T00:05:40.928226984Z","close_reason":"Removed duplicate #save-cluster-label and .view-segment-btn handlers from controls.js; handlers remain in visualization.js","dependencies":[{"issue_id":"battycoda-yf0.5","depends_on_id":"battycoda-yf0","type":"parent-child","created_at":"2026-01-13T21:48:52.535484439Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-yf0.6","title":"Verify loading spinner fix in visualization.js","description":"## Problem\nIn static/js/cluster_explorer/visualization.js, when clusters exist, the code only removed existing SVG elements but not the loading spinner div.\n\n## Partial Fix Applied\nChanged line ~50 from:\n  d3.select('#cluster-visualization svg').remove();\nto:\n  $('#cluster-visualization').empty();\n\n## Status\nPartial fix was applied but needs verification after yf0.1 (base.html fix) is done.\n\n## Location\n- static/js/cluster_explorer/visualization.js (around line 44-56)\n- templates/clustering/cluster_explorer.html (spinner HTML)\n\n## Verification\n1. Complete yf0.1 first (extra_js fix)\n2. Run collectstatic\n3. Visit /clustering/explorer/\u003crun_id\u003e/ for a completed run\n4. Verify visualization renders (no infinite spinner)\n5. Check browser console for errors","status":"closed","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T22:13:04.104183097Z","created_by":"Kevin Boergens","updated_at":"2026-01-14T00:10:36.774800309Z","closed_at":"2026-01-14T00:10:36.774800309Z","close_reason":"Verified fix is in place: .empty() clears loading spinner before D3 rendering","dependencies":[{"issue_id":"battycoda-yf0.6","depends_on_id":"battycoda-yf0","type":"parent-child","created_at":"2026-01-13T22:13:04.108574366Z","created_by":"Kevin Boergens"},{"issue_id":"battycoda-yf0.6","depends_on_id":"battycoda-yf0.1","type":"blocks","created_at":"2026-01-13T22:14:41.706480628Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-zic","title":"Phase 5: New Features","description":"## Scope\nFeature additions for clustering visualization.\n\n## Tasks (from CLUSTERING_VISUALIZATION_OVERHAUL.md)\n\n### 1. Keyboard navigation for cluster explorer\n- Arrow keys to navigate clusters\n- Enter to select\n- Escape to deselect\n- Tab navigation\n\n### 2. Zoom reset button\nLocation: Cluster explorer D3 visualization\nAdd button to reset zoom to default view\n\n### 3. Bulk operations for mapping\nCurrent: Must map clusters one-by-one\nAdd: Multi-select and bulk mapping\n\n### 4. Improved error handling\nCurrent: Generic 'Failed to...' messages\nAdd: Retry buttons, specific error messages\n\n### 5. Cluster comparison view (optional)\nSide-by-side comparison of two clusters\n\n## Estimated Effort\n16-24 hours","status":"open","priority":3,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T22:24:39.577207816Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:24:39.577207816Z"}
{"id":"battycoda-zj8","title":"Convert existing JS files to ES6 modules","description":"## Task\nConvert existing JavaScript files from IIFE/global pattern to ES6 modules.\n\n## Files to Convert\n\n### Already ES6 (verify and clean up)\n- static/js/player/*.js - Already uses import/export\n- static/js/cluster_mapping/*.js - Already uses import/export\n\n### Need Conversion\n1. **static/js/app.js**\n   - Large file with Maisonnette theme code\n   - Keep as global (loaded via CDN-style)\n   - Don't convert, just ensure compatibility\n\n2. **static/js/notifications.js**\n   - Convert to module\n   - Export initialization function\n   - Import in main.js or lazy-load\n\n3. **static/js/theme-switcher.js**\n   - Convert to module\n   - Export theme switching functions\n\n4. **static/js/datetime_formatter.js**\n   - Convert to module\n   - Export formatting functions\n\n5. **static/js/task_annotation.js**\n   - Convert to module\n   - Complex file, careful conversion needed\n\n6. **static/js/batch_review.js**\n   - Convert to module\n   - Export review functions\n\n7. **static/js/waveform_viewer.js**\n   - Convert to module\n   - May have dependencies on player\n\n8. **static/js/mapping_interface.js**\n   - Convert to module\n\n9. **static/js/upload_progress.js**\n   - Convert to module\n\n10. **static/js/taskbatch/name_validator.js**\n    - Convert to module\n\n11. **static/js/auth/register.js**\n    - Convert to module\n\n## Conversion Pattern\nBefore:\n```javascript\n// Global function\nfunction doSomething() { ... }\n$(document).ready(function() { ... });\n```\n\nAfter:\n```javascript\n// ES6 module\nexport function doSomething() { ... }\nexport function initialize() { ... }\n\n// Auto-init if loaded directly\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', initialize);\n} else {\n  initialize();\n}\n```\n\n## Verification\n- Each converted file can be imported without errors\n- Existing functionality unchanged\n- No global namespace pollution\n- `npm run build` succeeds","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:05:13.936782113Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:05:13.936782113Z","dependencies":[{"issue_id":"battycoda-zj8","depends_on_id":"battycoda-lpe","type":"blocks","created_at":"2026-01-13T23:20:13.070905488Z","created_by":"Kevin Boergens"}]}
