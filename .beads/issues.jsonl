{"id":"battycoda-013","title":"Phase 3: Quality Improvements","description":"## Scope\nCode quality improvements for clustering visualization.\n\n## Tasks (from CLUSTERING_VISUALIZATION_OVERHAUL.md)\n\n### 1. Remove console.log statements (~30+)\nLocations: drag_drop.js, mapping_interface.js, create_run.html\nOption: Remove all or use DEBUG flag pattern\n\n### 2. Add debouncing\n- Cluster search: cluster_mapping.js:26\n- Confidence slider: initialization.js:74\nPattern: debounce(fn, 300)\n\n### 3. Use Django json_script for data serialization\nCurrent (fragile):\n```javascript\n{% for cluster in clusters %}\nclusters.push({...});\n{% endfor %}\n```\nBetter:\n```html\n{{ clusters_data|json_script:\"clusters-data\" }}\n```\n\n### 4. Standardize API response format\nCurrent mix:\n- {'status': 'success', 'data': ...}\n- {'error': 'message'}\n- {'status': 'error', 'message': '...'}\n\n### 5. Extract inline JS to external files\n- create_run.html: 130+ lines\n- dashboard.html: 30+ lines  \n- cluster_explorer.html: 20+ lines\n\n### 6. Hardcoded URLs → Django url tag\nPass URLs from template to JS\n\n## Estimated Effort\n16-24 hours","status":"open","priority":2,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T22:19:48.547351295Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:19:48.547351295Z"}
{"id":"battycoda-10n","title":"Update deployment and CI for Vite build","description":"## Task\nUpdate deployment scripts and CI to include Vite build step.\n\n## Steps\n\n### 1. Update systemd service files\nAdd npm build before collectstatic in deployment:\n\nUpdate `systemd/battycoda.service` ExecStartPre or create deploy script:\n```bash\n# Pre-start commands\nExecStartPre=/usr/bin/npm --prefix /home/ubuntu/battycoda run build\nExecStartPre=/home/ubuntu/battycoda/venv/bin/python manage.py collectstatic --noinput\n```\n\nOr better, create a deploy script:\n```bash\n#!/bin/bash\n# scripts/deploy.sh\nset -e\ncd /home/ubuntu/battycoda\nsource venv/bin/activate\nnpm ci\nnpm run build\npython manage.py collectstatic --noinput\npython manage.py migrate\n```\n\n### 2. Install Node.js on server\nEnsure Node.js is installed:\n```bash\n# Using nvm or system package\ncurl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -\nsudo apt-get install -y nodejs\n```\n\nDocument Node.js version requirement in README.\n\n### 3. Update .gitignore\n```\n# Node\nnode_modules/\n\n# Vite build output\nstatic/dist/\n\n# But keep source maps for debugging if needed\n!static/dist/*.map\n```\n\n### 4. Create development setup script\n```bash\n#!/bin/bash\n# scripts/dev_setup.sh\nnpm install\nnpm run dev \u0026\nVITE_PID=$!\npython manage.py runserver\nkill $VITE_PID\n```\n\n### 5. Update CLAUDE.md\nAdd section on JavaScript development:\n- How to run dev server\n- How to add new JS modules\n- Build process documentation\n\n### 6. Optional: GitHub Actions CI\nIf using CI, add:\n```yaml\n- name: Setup Node.js\n  uses: actions/setup-node@v4\n  with:\n    node-version: '20'\n    cache: 'npm'\n    \n- name: Install and build JS\n  run: |\n    npm ci\n    npm run build\n```\n\n## Files Created/Modified\n- scripts/deploy.sh (new)\n- scripts/dev_setup.sh (new)\n- systemd/battycoda.service (updated)\n- .gitignore (updated)\n- CLAUDE.md (updated)\n- README.md (updated if exists)\n\n## Verification\n- Fresh clone + npm install + npm run build works\n- Deployment script runs successfully\n- collectstatic includes built JS bundles","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:06:26.689523358Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:06:26.689523358Z","dependencies":[{"issue_id":"battycoda-10n","depends_on_id":"battycoda-c7o","type":"blocks","created_at":"2026-01-13T23:20:13.543454554Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-2h0","title":"Write E2E tests for clustering workflow","description":"## Task\nWrite Playwright E2E tests for the clustering workflow.\n\n## Test Cases\n\n### tests/e2e/specs/clustering.spec.js\n```javascript\nimport { test, expect } from '@playwright/test';\nimport { login } from '../helpers/auth.js';\nimport users from '../fixtures/users.json';\n\ntest.describe('Clustering', () =\u003e {\n  test.beforeEach(async ({ page }) =\u003e {\n    await login(page, users.testUser.email, users.testUser.password);\n  });\n  \n  test.describe('Dashboard', () =\u003e {\n    test('displays clustering runs', async ({ page }) =\u003e {\n      await page.goto('/clustering/');\n      \n      await expect(page.locator('h1, h2')).toContainText('Clustering');\n      await expect(page.locator('table, .clustering-list')).toBeVisible();\n    });\n    \n    test('create new clustering run link', async ({ page }) =\u003e {\n      await page.goto('/clustering/');\n      \n      await page.click('text=New Clustering Run');\n      \n      await expect(page).toHaveURL(/create/);\n    });\n  });\n  \n  test.describe('Create Clustering Run', () =\u003e {\n    test('form displays all required fields', async ({ page }) =\u003e {\n      await page.goto('/clustering/create/');\n      \n      await expect(page.locator('select[name=\"algorithm\"]')).toBeVisible();\n      await expect(page.locator('select[name=\"segmentation\"], select[name=\"scope\"]')).toBeVisible();\n    });\n    \n    test('create single-segmentation run', async ({ page }) =\u003e {\n      await page.goto('/clustering/create/');\n      \n      // Select algorithm\n      await page.selectOption('select[name=\"algorithm\"]', { label: 'K-Means' });\n      \n      // Set parameters\n      await page.fill('input[name=\"num_clusters\"]', '5');\n      \n      // Select segmentation\n      await page.selectOption('select[name=\"segmentation\"]', { index: 1 });\n      \n      // Submit\n      await page.click('button[type=\"submit\"]');\n      \n      // Should redirect to run detail or show success\n      await expect(page).toHaveURL(/clustering\\/\\d+|clustering\\//);\n    });\n    \n    test('create project-level run', async ({ page }) =\u003e {\n      await page.goto('/clustering/create/');\n      \n      // Select project scope\n      await page.click('input[value=\"project\"], label:has-text(\"Project\")');\n      \n      // Select project\n      await page.selectOption('select[name=\"project\"]', { label: 'E2E Test Project' });\n      \n      // Select species\n      await page.selectOption('select[name=\"species\"]', { label: 'Test Species' });\n      \n      // Submit\n      await page.click('button[type=\"submit\"]');\n      \n      await expect(page.locator('.alert-success, .toast')).toBeVisible();\n    });\n  });\n  \n  test.describe('Cluster Explorer', () =\u003e {\n    test('visualization renders', async ({ page }) =\u003e {\n      // Navigate to an existing clustering run\n      await page.goto('/clustering/');\n      await page.click('a:has-text(\"View\")');\n      \n      // Wait for visualization\n      await expect(page.locator('#cluster-visualization, .cluster-viz')).toBeVisible();\n      await expect(page.locator('svg')).toBeVisible();\n    });\n    \n    test('cluster selection updates sidebar', async ({ page }) =\u003e {\n      await page.goto('/clustering/1/explorer/');  // Assuming run ID 1\n      \n      // Click on a cluster point\n      await page.click('circle.cluster-point:first-child');\n      \n      // Sidebar should update\n      await expect(page.locator('.cluster-details, #cluster-sidebar')).toContainText('Cluster');\n    });\n    \n    test('controls affect visualization', async ({ page }) =\u003e {\n      await page.goto('/clustering/1/explorer/');\n      \n      // Adjust point size slider\n      await page.fill('input[name=\"point-size\"]', '10');\n      \n      // Points should resize (hard to verify visually, but check no errors)\n      await expect(page.locator('circle')).toBeVisible();\n    });\n  });\n  \n  test.describe('Cluster Mapping', () =\u003e {\n    test('mapping interface loads', async ({ page }) =\u003e {\n      await page.goto('/clustering/1/mapping/');\n      \n      await expect(page.locator('.call-types, .cluster-list')).toBeVisible();\n    });\n    \n    test('drag cluster to call type', async ({ page }) =\u003e {\n      await page.goto('/clustering/1/mapping/');\n      \n      // Drag and drop\n      const cluster = page.locator('.cluster-item:first-child');\n      const callType = page.locator('.call-type-drop:first-child');\n      \n      await cluster.dragTo(callType);\n      \n      // Mapping should be created\n      await expect(page.locator('.mapping-item, .alert-success')).toBeVisible();\n    });\n  });\n});\n```\n\n## Files Created\n- tests/e2e/specs/clustering.spec.js\n\n## Prerequisites\n- Test data includes at least one segmented recording\n- Test data includes at least one completed clustering run\n\n## Verification\n- All clustering tests pass\n- Visualization renders in all browsers\n- Drag-drop works correctly","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:11:03.255912476Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:11:03.255912476Z","dependencies":[{"issue_id":"battycoda-2h0","depends_on_id":"battycoda-hxh","type":"blocks","created_at":"2026-01-13T23:20:18.216994315Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-2jm","title":"Phase 1: Vite Build System Setup","description":"## Overview\nSet up Vite as the build tool for BattyCoda's JavaScript, integrating with Django's static file system.\n\n## Goals\n- Modern ES6 module support with proper bundling\n- Hot module reload in development\n- Optimized production builds\n- Seamless Django integration\n\n## Key Decisions Made\n- Build tool: Vite (faster than Webpack, better DX)\n- Testing: Vitest (unit) + Playwright (E2E)\n- Bootstrap: Stay on 4.x for now (separate decision)\n\n## Success Criteria\n- `npm run dev` starts Vite dev server with HMR\n- `npm run build` produces optimized bundles in static/dist/\n- Django templates load bundles correctly in both dev and prod\n- Existing functionality unchanged","status":"open","priority":1,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T23:02:54.724737603Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:02:54.724737603Z"}
{"id":"battycoda-2pf","title":"Write unit tests for player module","description":"## Task\nWrite comprehensive unit tests for the waveform player module.\n\n## Files to Test\n- static/js/player/player.js\n- static/js/player/data_manager.js\n- static/js/player/view_manager.js\n- static/js/player/renderer.js\n- static/js/player/seek_handler.js\n- static/js/player/play_region.js\n- static/js/player/timeline.js\n\n## Test Cases\n\n### data_manager.test.js\n```javascript\nimport { describe, it, expect, vi } from 'vitest';\nimport { DataManager } from './data_manager.js';\n\ndescribe('DataManager', () =\u003e {\n  describe('loadRecording', () =\u003e {\n    it('fetches recording metadata', async () =\u003e {\n      const manager = new DataManager();\n      fetch.mockResolvedValueOnce({\n        ok: true,\n        json: () =\u003e Promise.resolve({\n          duration: 120.5,\n          sample_rate: 44100,\n          channels: 1\n        })\n      });\n      \n      const result = await manager.loadRecording(123);\n      \n      expect(result.duration).toBe(120.5);\n      expect(result.sample_rate).toBe(44100);\n    });\n  });\n  \n  describe('getSegmentAtTime', () =\u003e {\n    it('returns segment containing timestamp', () =\u003e {\n      const manager = new DataManager();\n      manager.segments = [\n        { start: 0, end: 1.5 },\n        { start: 2.0, end: 3.5 },\n        { start: 4.0, end: 5.0 }\n      ];\n      \n      const segment = manager.getSegmentAtTime(2.5);\n      \n      expect(segment).toEqual({ start: 2.0, end: 3.5 });\n    });\n    \n    it('returns null for timestamp outside segments', () =\u003e {\n      const manager = new DataManager();\n      manager.segments = [{ start: 0, end: 1.0 }];\n      \n      expect(manager.getSegmentAtTime(1.5)).toBeNull();\n    });\n  });\n});\n```\n\n### view_manager.test.js\n```javascript\ndescribe('ViewManager', () =\u003e {\n  describe('setViewMode', () =\u003e {\n    it('switches between waveform and spectrogram', () =\u003e {\n      const vm = new ViewManager();\n      \n      vm.setViewMode('spectrogram');\n      expect(vm.getViewMode()).toBe('spectrogram');\n      \n      vm.setViewMode('waveform');\n      expect(vm.getViewMode()).toBe('waveform');\n    });\n  });\n  \n  describe('calculateVisibleRange', () =\u003e {\n    it('calculates pixel-to-time mapping', () =\u003e {\n      const vm = new ViewManager();\n      vm.duration = 60;\n      vm.width = 600;\n      \n      const range = vm.calculateVisibleRange(100, 200);\n      \n      expect(range.start).toBeCloseTo(10);\n      expect(range.end).toBeCloseTo(20);\n    });\n  });\n});\n```\n\n### seek_handler.test.js\nTest seek position calculations\n\n### play_region.test.js\nTest region selection logic\n\n### timeline.test.js\nTest time marker calculations\n\n## Test Approach\n1. Mock Audio API (HTMLAudioElement)\n2. Mock Canvas API where needed\n3. Test state management logic\n4. Test calculations (time \u003c-\u003e pixel conversions)\n5. Use dependency injection for testability\n\n## Coverage Target\n- data_manager.js: 90%+\n- view_manager.js: 85%+\n- seek_handler.js: 80%+\n- play_region.js: 80%+\n- timeline.js: 75%+\n- renderer.js: 50%+ (canvas-heavy)\n\n## Files Created\n- static/js/player/data_manager.test.js\n- static/js/player/view_manager.test.js\n- static/js/player/seek_handler.test.js\n- static/js/player/play_region.test.js\n- static/js/player/timeline.test.js\n- static/js/test/mocks/audio.js\n- static/js/test/mocks/canvas.js\n- static/js/test/fixtures/recording.json\n\n## Verification\n- All tests pass\n- Coverage meets targets\n- Player still works in browser","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:08:36.23786855Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:08:36.23786855Z","dependencies":[{"issue_id":"battycoda-2pf","depends_on_id":"battycoda-gr3","type":"blocks","created_at":"2026-01-13T23:20:15.708367416Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-3vv","title":"Configure Vite for Django integration","description":"## Task\nConfigure Vite to work seamlessly with Django's static file system.\n\n## Steps\n\n### 1. Create vite.config.js with Django-aware settings\n```javascript\nimport { defineConfig } from 'vite';\nimport { resolve } from 'path';\n\nexport default defineConfig({\n  // Use static/ as the root for source files\n  root: 'static',\n  \n  build: {\n    // Output to static/dist/ for Django to collect\n    outDir: 'dist',\n    emptyOutDir: true,\n    \n    // Generate manifest for Django to read\n    manifest: true,\n    \n    // Configure rollup\n    rollupOptions: {\n      input: {\n        // Entry points will be added here\n        main: resolve(__dirname, 'static/js/main.js'),\n      },\n      output: {\n        // Predictable filenames for Django\n        entryFileNames: 'js/[name]-[hash].js',\n        chunkFileNames: 'js/[name]-[hash].js',\n        assetFileNames: 'assets/[name]-[hash][extname]',\n      }\n    }\n  },\n  \n  // Dev server settings\n  server: {\n    port: 5173,\n    strictPort: true,\n    // Allow Django to proxy to Vite\n    origin: 'http://localhost:5173',\n  }\n});\n```\n\n### 2. Create Django template tag for Vite assets\nCreate `battycoda_app/templatetags/vite.py`:\n```python\nfrom django import template\nfrom django.conf import settings\nfrom django.templatetags.static import static\nimport json\nfrom pathlib import Path\n\nregister = template.Library()\n\n@register.simple_tag\ndef vite_asset(entry_name):\n    \"\"\"Load a Vite asset, handling dev vs prod.\"\"\"\n    if settings.DEBUG:\n        # In dev, load from Vite dev server\n        return f'http://localhost:5173/js/{entry_name}'\n    else:\n        # In prod, read from manifest\n        manifest_path = Path(settings.STATIC_ROOT) / 'dist' / '.vite' / 'manifest.json'\n        if manifest_path.exists():\n            manifest = json.loads(manifest_path.read_text())\n            if entry_name in manifest:\n                return static(f'dist/{manifest[entry_name][\"file\"]}')\n    return static(f'dist/js/{entry_name}')\n```\n\n### 3. Create __init__.py for templatetags\nEnsure `battycoda_app/templatetags/__init__.py` exists.\n\n### 4. Test dev server integration\n- Vite dev server runs on port 5173\n- Django can reference Vite assets\n- HMR works for CSS and JS changes\n\n## Files Created/Modified\n- vite.config.js (updated)\n- battycoda_app/templatetags/vite.py\n- battycoda_app/templatetags/__init__.py\n\n## Verification\n- `npm run dev` starts and serves assets\n- Django templates can load from Vite dev server\n- `npm run build` generates manifest.json","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:04:33.459031456Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:04:33.459031456Z","dependencies":[{"issue_id":"battycoda-3vv","depends_on_id":"battycoda-ehr","type":"blocks","created_at":"2026-01-13T23:20:12.667092407Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-5ko","title":"Phase 3: Playwright E2E Testing Setup","description":"## Overview\nSet up Playwright for end-to-end testing of BattyCoda. Playwright tests real user flows in a real browser against the running Django application.\n\n## Goals\n- E2E coverage for critical user journeys\n- Cross-browser testing (Chromium, Firefox, WebKit)\n- Visual regression detection\n- CI integration with test reports\n\n## What to Test with Playwright\n- User authentication flows\n- Recording upload and playback\n- Segmentation workflow\n- Classification workflow\n- Clustering workflow\n- Task annotation interface\n- Full CRUD operations\n\n## Architecture\n```\ntests/\n├── e2e/\n│   ├── playwright.config.js\n│   ├── fixtures/\n│   │   ├── test-audio.wav\n│   │   └── users.json\n│   ├── helpers/\n│   │   ├── auth.js\n│   │   └── api.js\n│   └── specs/\n│       ├── auth.spec.js\n│       ├── recordings.spec.js\n│       ├── clustering.spec.js\n│       └── tasks.spec.js\n```\n\n## Success Criteria\n- `npm run e2e` runs all E2E tests\n- Tests pass against local Django server\n- CI runs E2E tests on PR\n- Test failures produce screenshots/videos\n- Critical paths have \u003e90% coverage","status":"open","priority":1,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T23:10:49.845966632Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:10:49.845966632Z"}
{"id":"battycoda-881","title":"Write unit tests for utility modules","description":"## Task\nWrite unit tests for standalone utility modules.\n\n## Files to Test\n- static/js/datetime_formatter.js\n- static/js/theme-switcher.js\n- static/js/notifications.js\n- static/js/upload_progress.js\n- static/js/taskbatch/name_validator.js\n\n## Test Cases\n\n### datetime_formatter.test.js\n```javascript\nimport { describe, it, expect } from 'vitest';\nimport { formatDuration, formatTimestamp, formatRelativeTime } from './datetime_formatter.js';\n\ndescribe('formatDuration', () =\u003e {\n  it('formats seconds to mm:ss', () =\u003e {\n    expect(formatDuration(65)).toBe('1:05');\n    expect(formatDuration(3661)).toBe('1:01:01');\n  });\n  \n  it('handles zero', () =\u003e {\n    expect(formatDuration(0)).toBe('0:00');\n  });\n  \n  it('handles fractional seconds', () =\u003e {\n    expect(formatDuration(65.7)).toBe('1:05');\n  });\n});\n\ndescribe('formatRelativeTime', () =\u003e {\n  it('formats recent timestamps as \"just now\"', () =\u003e {\n    const now = new Date();\n    expect(formatRelativeTime(now)).toBe('just now');\n  });\n  \n  it('formats minutes ago', () =\u003e {\n    const fiveMinAgo = new Date(Date.now() - 5 * 60 * 1000);\n    expect(formatRelativeTime(fiveMinAgo)).toBe('5 minutes ago');\n  });\n});\n```\n\n### theme-switcher.test.js\n```javascript\ndescribe('ThemeSwitcher', () =\u003e {\n  describe('setTheme', () =\u003e {\n    it('updates body class', () =\u003e {\n      document.body.className = 'theme-default';\n      \n      setTheme('dark');\n      \n      expect(document.body.classList.contains('theme-dark')).toBe(true);\n      expect(document.body.classList.contains('theme-default')).toBe(false);\n    });\n    \n    it('persists theme to localStorage', () =\u003e {\n      setTheme('dark');\n      expect(localStorage.getItem('theme')).toBe('dark');\n    });\n  });\n  \n  describe('getTheme', () =\u003e {\n    it('returns current theme from body class', () =\u003e {\n      document.body.className = 'theme-ocean';\n      expect(getTheme()).toBe('ocean');\n    });\n  });\n});\n```\n\n### name_validator.test.js\n```javascript\ndescribe('TaskBatchNameValidator', () =\u003e {\n  describe('validateName', () =\u003e {\n    it('rejects empty names', () =\u003e {\n      expect(validateName('')).toEqual({\n        valid: false,\n        error: 'Name is required'\n      });\n    });\n    \n    it('rejects names over 255 chars', () =\u003e {\n      const longName = 'a'.repeat(256);\n      expect(validateName(longName).valid).toBe(false);\n    });\n    \n    it('accepts valid names', () =\u003e {\n      expect(validateName('My Batch 2024')).toEqual({\n        valid: true,\n        error: null\n      });\n    });\n  });\n});\n```\n\n## Test Approach\n- These are mostly pure functions, easy to test\n- Mock localStorage for theme tests\n- Mock DOM for some formatters\n\n## Coverage Target\n- datetime_formatter.js: 95%+\n- theme-switcher.js: 90%+\n- name_validator.js: 95%+\n- notifications.js: 70%+ (more async)\n- upload_progress.js: 75%+\n\n## Files Created\n- static/js/datetime_formatter.test.js\n- static/js/theme-switcher.test.js\n- static/js/notifications.test.js\n- static/js/upload_progress.test.js\n- static/js/taskbatch/name_validator.test.js\n\n## Verification\n- All tests pass\n- High coverage on utility functions\n- Tests document expected behavior","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:08:40.267855119Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:08:40.267855119Z","dependencies":[{"issue_id":"battycoda-881","depends_on_id":"battycoda-gr3","type":"blocks","created_at":"2026-01-13T23:20:15.818712211Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-8ra","title":"Write E2E tests for task annotation","description":"## Task\nWrite Playwright E2E tests for the task annotation workflow.\n\n## Test Cases\n\n### tests/e2e/specs/tasks.spec.js\n```javascript\nimport { test, expect } from '@playwright/test';\nimport { login } from '../helpers/auth.js';\nimport users from '../fixtures/users.json';\n\ntest.describe('Task Annotation', () =\u003e {\n  test.beforeEach(async ({ page }) =\u003e {\n    await login(page, users.testUser.email, users.testUser.password);\n  });\n  \n  test.describe('Task Batches', () =\u003e {\n    test('list task batches', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/');\n      \n      await expect(page.locator('table, .batch-list')).toBeVisible();\n    });\n    \n    test('create new task batch', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/create/');\n      \n      await page.fill('input[name=\"name\"]', 'E2E Test Batch');\n      await page.selectOption('select[name=\"segmentation\"]', { index: 1 });\n      await page.click('button[type=\"submit\"]');\n      \n      await expect(page.locator('.alert-success')).toBeVisible();\n    });\n  });\n  \n  test.describe('Task Annotation Interface', () =\u003e {\n    test('annotation page loads', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/annotate/');\n      \n      // Check main components present\n      await expect(page.locator('.waveform-player, #waveform')).toBeVisible();\n      await expect(page.locator('.call-buttons, .call-type-select')).toBeVisible();\n    });\n    \n    test('select call type for segment', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/annotate/');\n      \n      // Click a call type button\n      await page.click('.call-btn:first-child, button[data-call-type]');\n      \n      // Should show selected state\n      await expect(page.locator('.selected, .active')).toBeVisible();\n    });\n    \n    test('save annotation and advance', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/annotate/');\n      \n      // Select a call type\n      await page.click('.call-btn:first-child');\n      \n      // Save\n      await page.click('button:has-text(\"Save\"), #save-btn');\n      \n      // Should advance to next task or show completion\n      await expect(page.locator('.alert-success, .next-task')).toBeVisible();\n    });\n    \n    test('skip task', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/annotate/');\n      \n      await page.click('button:has-text(\"Skip\"), #skip-btn');\n      \n      // Should advance\n    });\n    \n    test('play audio segment', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/annotate/');\n      \n      await page.click('#play-btn, .play-button');\n      \n      // Audio should play (hard to verify, check no errors)\n    });\n    \n    test('keyboard shortcuts work', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/annotate/');\n      \n      // Press spacebar to play\n      await page.keyboard.press('Space');\n      \n      // Press number key for call type\n      await page.keyboard.press('1');\n      \n      // Press Enter to save\n      await page.keyboard.press('Enter');\n    });\n  });\n  \n  test.describe('Task Review', () =\u003e {\n    test('batch review page loads', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/review/');\n      \n      await expect(page.locator('table, .task-list')).toBeVisible();\n    });\n    \n    test('filter by status', async ({ page }) =\u003e {\n      await page.goto('/tasks/batches/1/review/');\n      \n      await page.selectOption('select[name=\"status\"]', 'completed');\n      await page.click('button:has-text(\"Filter\")');\n      \n      // Results should filter\n    });\n  });\n});\n```\n\n## Files Created\n- tests/e2e/specs/tasks.spec.js\n\n## Prerequisites\n- Test data includes at least one task batch with tasks\n\n## Verification\n- All task tests pass\n- Annotation workflow works end-to-end\n- Keyboard shortcuts function correctly","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:11:06.16396858Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:11:06.16396858Z","dependencies":[{"issue_id":"battycoda-8ra","depends_on_id":"battycoda-hxh","type":"blocks","created_at":"2026-01-13T23:20:18.334217826Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-965","title":"Install and configure Playwright","description":"## Task\nInstall Playwright and configure for testing BattyCoda.\n\n## Steps\n\n### 1. Install Playwright\n```bash\nnpm install --save-dev @playwright/test\nnpx playwright install  # Downloads browser binaries\n```\n\n### 2. Create playwright.config.js\n```javascript\n// tests/e2e/playwright.config.js\nimport { defineConfig, devices } from '@playwright/test';\n\nexport default defineConfig({\n  testDir: './tests/e2e/specs',\n  \n  // Run tests in parallel\n  fullyParallel: true,\n  \n  // Fail fast on CI\n  forbidOnly: !!process.env.CI,\n  \n  // Retry failed tests\n  retries: process.env.CI ? 2 : 0,\n  \n  // Reporter\n  reporter: [\n    ['html', { outputFolder: 'playwright-report' }],\n    ['list'],\n  ],\n  \n  // Shared settings for all projects\n  use: {\n    // Base URL for Django\n    baseURL: process.env.BASE_URL || 'http://localhost:8000',\n    \n    // Collect trace on failure\n    trace: 'on-first-retry',\n    \n    // Screenshot on failure\n    screenshot: 'only-on-failure',\n    \n    // Video on failure\n    video: 'on-first-retry',\n  },\n  \n  // Configure projects for cross-browser testing\n  projects: [\n    {\n      name: 'chromium',\n      use: { ...devices['Desktop Chrome'] },\n    },\n    {\n      name: 'firefox',\n      use: { ...devices['Desktop Firefox'] },\n    },\n    {\n      name: 'webkit',\n      use: { ...devices['Desktop Safari'] },\n    },\n  ],\n  \n  // Start Django dev server before tests\n  webServer: {\n    command: 'python manage.py runserver 8000',\n    url: 'http://localhost:8000',\n    reuseExistingServer: !process.env.CI,\n    timeout: 120000,\n  },\n});\n```\n\n### 3. Add npm scripts\n```json\n{\n  \"scripts\": {\n    \"e2e\": \"playwright test\",\n    \"e2e:headed\": \"playwright test --headed\",\n    \"e2e:ui\": \"playwright test --ui\",\n    \"e2e:report\": \"playwright show-report\"\n  }\n}\n```\n\n### 4. Create test fixtures directory\n```bash\nmkdir -p tests/e2e/specs tests/e2e/fixtures tests/e2e/helpers\n```\n\n### 5. Create test helper for authentication\n```javascript\n// tests/e2e/helpers/auth.js\nexport async function login(page, email, password) {\n  await page.goto('/accounts/login/');\n  await page.fill('input[name=\"email\"]', email);\n  await page.fill('input[name=\"password\"]', password);\n  await page.click('button[type=\"submit\"]');\n  await page.waitForURL('/');\n}\n\nexport async function createTestUser(page, userData) {\n  // Uses Django management command or API\n}\n```\n\n### 6. Create test data fixture\n```javascript\n// tests/e2e/fixtures/users.json\n{\n  \"testUser\": {\n    \"email\": \"test@example.com\",\n    \"password\": \"testpass123\",\n    \"username\": \"testuser\"\n  },\n  \"adminUser\": {\n    \"email\": \"admin@example.com\",\n    \"password\": \"adminpass123\",\n    \"username\": \"admin\"\n  }\n}\n```\n\n### 7. Add to .gitignore\n```\nplaywright-report/\ntest-results/\n```\n\n## Files Created\n- tests/e2e/playwright.config.js\n- tests/e2e/helpers/auth.js\n- tests/e2e/fixtures/users.json\n- package.json (updated scripts)\n- .gitignore (updated)\n\n## Verification\n- `npm run e2e` runs (even with no tests yet)\n- `npm run e2e:ui` opens Playwright UI\n- Browser binaries are installed","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:10:53.615891983Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:10:53.615891983Z","dependencies":[{"issue_id":"battycoda-965","depends_on_id":"battycoda-10n","type":"blocks","created_at":"2026-01-13T23:20:17.727861903Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-c7o","title":"Update Django templates to use Vite bundles","description":"## Task\nUpdate all Django templates to load JavaScript from Vite bundles instead of individual script tags.\n\n## Steps\n\n### 1. Update base.html\nReplace individual script includes with Vite bundle:\n\nBefore:\n```html\n\u003cscript src=\"{% static 'js/datetime_formatter.js' %}\"\u003e\u003c/script\u003e\n\u003cscript src=\"{% static 'js/theme-switcher.js' %}\"\u003e\u003c/script\u003e\n```\n\nAfter:\n```html\n{% load vite %}\n{% vite_asset 'main.js' %}\n```\n\n### 2. Fix extra_js block ordering (resolves yf0.1)\nMove extra_js block AFTER jQuery and other dependencies:\n\n```html\n\u003c!-- CDN scripts (jQuery, Bootstrap, etc.) --\u003e\n\u003cscript src=\"https://code.jquery.com/jquery-3.3.1.min.js\"\u003e\u003c/script\u003e\n...\n\n\u003c!-- Then extra_js block --\u003e\n{% block extra_js %}{% endblock %}\n```\n\n### 3. Update page-specific templates\nTemplates that need updates:\n\n| Template | Current Scripts | New Entry Point |\n|----------|-----------------|-----------------|\n| recording_detail.html | player/*.js | player.js |\n| cluster_explorer.html | cluster_explorer/*.js | clusterExplorer.js |\n| cluster_mapping.html | cluster_mapping/*.js | clusterMapping.js |\n| recording_upload.html | file_upload/*.js | fileUpload.js |\n| segmentation_detail.html | segmentation/*.js | segmentation.js |\n| task_*.html | task_annotation.js | taskAnnotation.js |\n\n### 4. Handle inline scripts\nMany templates have inline \u003cscript\u003e blocks. Options:\na) Keep as inline (simplest)\nb) Move to separate modules (cleaner)\nc) Use data attributes to pass Django context to JS\n\nRecommended: Use data attributes pattern:\n```html\n\u003cdiv id=\"app\" \n     data-recording-id=\"{{ recording.id }}\"\n     data-api-url=\"{% url 'api:endpoint' %}\"\u003e\n\u003c/div\u003e\n```\n\n### 5. Test each page\n- Verify all JS functionality works\n- Check browser console for errors\n- Test both dev mode (Vite server) and prod mode (built bundles)\n\n## Templates to Update (comprehensive list)\n- templates/base.html\n- templates/recordings/recording_detail.html\n- templates/recordings/recording_upload.html\n- templates/clustering/cluster_explorer.html\n- templates/clustering/cluster_mapping.html\n- templates/clustering/create_run.html\n- templates/segmentation/segmentation_detail.html\n- templates/tasks/task_detail.html\n- templates/tasks/task_annotation.html\n- templates/auth/register.html\n\n## Verification\n- All pages load without JS errors\n- All interactive features work\n- Dev server HMR works for CSS/JS changes\n- Production build works with collectstatic","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:05:15.724666217Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:05:15.724666217Z","dependencies":[{"issue_id":"battycoda-c7o","depends_on_id":"battycoda-zj8","type":"blocks","created_at":"2026-01-13T23:20:13.34700761Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-dkw","title":"Write unit tests for cluster_explorer module","description":"## Task\nWrite comprehensive unit tests for the cluster_explorer module.\n\n## Files to Test\n- static/js/cluster_explorer/data_loader.js\n- static/js/cluster_explorer/controls.js\n- static/js/cluster_explorer/interactions.js\n- static/js/cluster_explorer/visualization.js\n\n## Test Cases\n\n### data_loader.test.js\n```javascript\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { loadClusterData, parseClusterResponse } from './data_loader.js';\n\ndescribe('loadClusterData', () =\u003e {\n  beforeEach(() =\u003e {\n    fetch.mockClear();\n  });\n\n  it('fetches cluster data from correct URL', async () =\u003e {\n    fetch.mockResolvedValueOnce({\n      ok: true,\n      json: () =\u003e Promise.resolve({ clusters: [] })\n    });\n    \n    await loadClusterData(123);\n    \n    expect(fetch).toHaveBeenCalledWith(\n      expect.stringContaining('/clustering/get-cluster-data/')\n    );\n  });\n\n  it('handles API errors gracefully', async () =\u003e {\n    fetch.mockRejectedValueOnce(new Error('Network error'));\n    \n    await expect(loadClusterData(123)).rejects.toThrow('Network error');\n  });\n});\n\ndescribe('parseClusterResponse', () =\u003e {\n  it('transforms API response to internal format', () =\u003e {\n    const apiResponse = {\n      clusters: [\n        { id: 1, label: 'Call A', size: 10 }\n      ]\n    };\n    \n    const result = parseClusterResponse(apiResponse);\n    \n    expect(result).toHaveLength(1);\n    expect(result[0]).toMatchObject({\n      id: 1,\n      label: 'Call A',\n      size: 10\n    });\n  });\n\n  it('handles empty cluster list', () =\u003e {\n    const result = parseClusterResponse({ clusters: [] });\n    expect(result).toEqual([]);\n  });\n});\n```\n\n### controls.test.js\nTest slider controls, filter logic, etc.\n\n### visualization.test.js\nTest data transformations (not D3 rendering):\n- Scale calculations\n- Color assignments\n- Coordinate transformations\n\n## Test Approach\n1. Mock D3 and DOM dependencies\n2. Test data transformation logic\n3. Test event handler callbacks (not DOM events)\n4. Use fixtures for consistent test data\n\n## Coverage Target\n- data_loader.js: 90%+\n- controls.js: 80%+\n- interactions.js: 70%+ (more DOM-dependent)\n- visualization.js: 60%+ (heavy D3 usage)\n\n## Files Created\n- static/js/cluster_explorer/data_loader.test.js\n- static/js/cluster_explorer/controls.test.js\n- static/js/cluster_explorer/interactions.test.js\n- static/js/cluster_explorer/visualization.test.js\n- static/js/test/fixtures/clusters.json\n\n## Verification\n- All tests pass\n- Coverage meets targets\n- Tests are meaningful (not just for coverage)","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:08:33.527534502Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:08:33.527534502Z","dependencies":[{"issue_id":"battycoda-dkw","depends_on_id":"battycoda-gr3","type":"blocks","created_at":"2026-01-13T23:20:15.606362262Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-ehr","title":"Initialize npm project and install Vite","description":"## Task\nCreate package.json and install Vite with necessary dependencies.\n\n## Steps\n\n### 1. Initialize npm project\n```bash\nnpm init -y\n```\n\n### 2. Install Vite and plugins\n```bash\nnpm install --save-dev vite\nnpm install --save-dev vite-plugin-static-copy  # For copying assets\n```\n\n### 3. Update package.json scripts\n```json\n{\n  \"scripts\": {\n    \"dev\": \"vite\",\n    \"build\": \"vite build\",\n    \"preview\": \"vite preview\"\n  }\n}\n```\n\n### 4. Add to .gitignore\n```\nnode_modules/\nstatic/dist/\n```\n\n### 5. Create initial vite.config.js\nBasic config file pointing to static/ directory.\n\n## Files Created\n- package.json\n- package-lock.json\n- vite.config.js\n- Updates to .gitignore\n\n## Verification\n- `npm install` completes without errors\n- `npm run build` runs (even if no entry points yet)","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:04:30.352702234Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:04:30.352702234Z"}
{"id":"battycoda-gr3","title":"Install and configure Vitest","description":"## Task\nInstall Vitest and configure for the BattyCoda project.\n\n## Steps\n\n### 1. Install Vitest and dependencies\n```bash\nnpm install --save-dev vitest @vitest/coverage-v8 @vitest/ui\nnpm install --save-dev jsdom  # For DOM testing if needed\n```\n\n### 2. Update vite.config.js with test configuration\n```javascript\nimport { defineConfig } from 'vite';\n\nexport default defineConfig({\n  // ... existing config ...\n  \n  test: {\n    // Test configuration\n    globals: true,\n    environment: 'jsdom',  // or 'node' for pure logic tests\n    \n    // Test file patterns\n    include: ['static/js/**/*.test.js', 'static/js/**/*.spec.js'],\n    \n    // Coverage settings\n    coverage: {\n      provider: 'v8',\n      reporter: ['text', 'json', 'html'],\n      reportsDirectory: 'coverage',\n      include: ['static/js/**/*.js'],\n      exclude: [\n        'static/js/**/*.test.js',\n        'static/js/**/*.spec.js',\n        'static/js/app.js',  // Third-party Maisonnette\n        'node_modules/**',\n      ],\n    },\n    \n    // Setup files if needed\n    setupFiles: ['static/js/test/setup.js'],\n  }\n});\n```\n\n### 3. Add npm scripts\n```json\n{\n  \"scripts\": {\n    \"test\": \"vitest\",\n    \"test:run\": \"vitest run\",\n    \"test:coverage\": \"vitest run --coverage\",\n    \"test:ui\": \"vitest --ui\"\n  }\n}\n```\n\n### 4. Create test setup file\nCreate `static/js/test/setup.js`:\n```javascript\n/**\n * Test setup file\n * Runs before all tests\n */\n\n// Mock browser APIs if needed\nimport { vi } from 'vitest';\n\n// Mock fetch for API tests\nglobal.fetch = vi.fn();\n\n// Mock jQuery if needed for legacy code\nglobal.$ = vi.fn(() =\u003e ({\n  on: vi.fn(),\n  off: vi.fn(),\n  ready: vi.fn(cb =\u003e cb()),\n  ajax: vi.fn(),\n}));\nglobal.jQuery = global.$;\n```\n\n### 5. Create test directory structure\n```\nstatic/js/\n├── test/\n│   ├── setup.js        # Global test setup\n│   ├── mocks/          # Shared mocks\n│   │   ├── api.js\n│   │   └── audio.js\n│   └── fixtures/       # Test data\n│       ├── clusters.json\n│       └── segments.json\n```\n\n## Verification\n- `npm test` runs without errors\n- `npm run test:coverage` generates report\n- `npm run test:ui` opens Vitest UI","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:08:30.096389961Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:08:30.096389961Z","dependencies":[{"issue_id":"battycoda-gr3","depends_on_id":"battycoda-10n","type":"blocks","created_at":"2026-01-13T23:20:15.504737497Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-hb5","title":"Decide: Build tool (Vite/Webpack) vs vanilla JS","description":"## Decision Needed\nBefore Phase 2 architecture refactor, need to decide JavaScript bundling strategy.\n\n## Options\n\n### Option A: Vanilla JS (IIFE pattern)\nPros:\n- No build step needed\n- Simpler deployment\n- No new dependencies\n- Works with current Django static files\n\nCons:\n- Manual dependency management\n- No tree shaking\n- No ES6 module benefits\n- Harder to add npm packages\n\n### Option B: Build tool (Vite recommended over Webpack)\nPros:\n- Proper ES6 modules\n- Tree shaking / dead code elimination\n- Easy npm package integration\n- Hot module reload in dev\n- Modern tooling\n\nCons:\n- Build step required\n- New tooling to learn/maintain\n- Need to update deployment process\n- Adds complexity\n\n## Recommendation\nFor a Django app of this size, **vanilla JS (Option A)** is likely sufficient. The clustering code isn't complex enough to warrant build tooling overhead.\n\n## Impacts\n- Phase 2 architecture decisions\n- How to fix yf0.3 (ES6 modules)\n- Future JS development patterns","status":"open","priority":0,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T22:46:37.700681511Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:46:37.700681511Z"}
{"id":"battycoda-hxh","title":"Create Playwright test database fixtures","description":"## Task\nCreate Django fixtures and helpers for Playwright tests to use consistent test data.\n\n## Steps\n\n### 1. Create Django management command for test data\n```python\n# battycoda_app/management/commands/setup_e2e_tests.py\nfrom django.core.management.base import BaseCommand\nfrom django.contrib.auth.models import User\nfrom battycoda_app.models import Group, Species, Project\n\nclass Command(BaseCommand):\n    help = 'Set up test data for E2E tests'\n    \n    def handle(self, *args, **options):\n        # Create test user\n        user, created = User.objects.get_or_create(\n            username='e2e_testuser',\n            defaults={\n                'email': 'e2e@test.com',\n                'is_active': True\n            }\n        )\n        if created:\n            user.set_password('e2e_testpass')\n            user.save()\n        \n        # Create test group\n        group, _ = Group.objects.get_or_create(\n            name='E2E Test Group',\n            defaults={'created_by': user}\n        )\n        \n        # Create test species\n        species, _ = Species.objects.get_or_create(\n            name='Test Species',\n            group=group,\n            defaults={\n                'description': 'Species for E2E testing'\n            }\n        )\n        \n        # Create test project\n        project, _ = Project.objects.get_or_create(\n            name='E2E Test Project',\n            group=group,\n            defaults={\n                'created_by': user,\n                'species': species\n            }\n        )\n        \n        self.stdout.write(self.style.SUCCESS('E2E test data created'))\n```\n\n### 2. Create management command for cleanup\n```python\n# battycoda_app/management/commands/cleanup_e2e_tests.py\nclass Command(BaseCommand):\n    help = 'Clean up E2E test data'\n    \n    def handle(self, *args, **options):\n        # Delete test data in reverse order\n        User.objects.filter(username='e2e_testuser').delete()\n        Group.objects.filter(name='E2E Test Group').delete()\n        # ... etc\n```\n\n### 3. Create test audio file fixture\n```bash\n# Create a small test WAV file (or copy from existing test files)\n# tests/e2e/fixtures/test-audio.wav - 5 second silence or sine wave\n```\n\n### 4. Create Playwright global setup\n```javascript\n// tests/e2e/global-setup.js\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\n\nconst execAsync = promisify(exec);\n\nexport default async function globalSetup() {\n  console.log('Setting up E2E test data...');\n  await execAsync('python manage.py setup_e2e_tests');\n}\n```\n\n### 5. Create Playwright global teardown\n```javascript\n// tests/e2e/global-teardown.js\nexport default async function globalTeardown() {\n  console.log('Cleaning up E2E test data...');\n  await execAsync('python manage.py cleanup_e2e_tests');\n}\n```\n\n### 6. Update playwright.config.js\n```javascript\nexport default defineConfig({\n  globalSetup: './tests/e2e/global-setup.js',\n  globalTeardown: './tests/e2e/global-teardown.js',\n  // ... rest of config\n});\n```\n\n## Test Data to Create\n| Entity | Name | Purpose |\n|--------|------|---------|\n| User | e2e_testuser | Login tests |\n| User | e2e_adminuser | Admin tests |\n| Group | E2E Test Group | Group context |\n| Species | Test Species | Species selection |\n| Project | E2E Test Project | Project context |\n| Recording | test-recording | Playback tests |\n\n## Files Created\n- battycoda_app/management/commands/setup_e2e_tests.py\n- battycoda_app/management/commands/cleanup_e2e_tests.py\n- tests/e2e/fixtures/test-audio.wav\n- tests/e2e/global-setup.js\n- tests/e2e/global-teardown.js\n\n## Verification\n- `python manage.py setup_e2e_tests` creates data\n- `python manage.py cleanup_e2e_tests` removes data\n- Playwright runs setup before tests","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:10:55.955167615Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:10:55.955167615Z","dependencies":[{"issue_id":"battycoda-hxh","depends_on_id":"battycoda-965","type":"blocks","created_at":"2026-01-13T23:20:17.884281731Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-jwt","title":"Write E2E tests for recording workflows","description":"## Task\nWrite Playwright E2E tests for recording upload, viewing, and playback.\n\n## Test Cases\n\n### tests/e2e/specs/recordings.spec.js\n```javascript\nimport { test, expect } from '@playwright/test';\nimport { login } from '../helpers/auth.js';\nimport users from '../fixtures/users.json';\nimport path from 'path';\n\ntest.describe('Recordings', () =\u003e {\n  test.beforeEach(async ({ page }) =\u003e {\n    await login(page, users.testUser.email, users.testUser.password);\n  });\n  \n  test.describe('Upload', () =\u003e {\n    test('single file upload', async ({ page }) =\u003e {\n      await page.goto('/recordings/upload/');\n      \n      // Select project\n      await page.selectOption('select[name=\"project\"]', { label: 'E2E Test Project' });\n      \n      // Upload file\n      const fileInput = page.locator('input[type=\"file\"]');\n      await fileInput.setInputFiles(path.join(__dirname, '../fixtures/test-audio.wav'));\n      \n      // Submit\n      await page.click('button[type=\"submit\"]');\n      \n      // Wait for upload to complete\n      await expect(page.locator('.alert-success, .toast')).toContainText('uploaded');\n    });\n    \n    test('batch upload multiple files', async ({ page }) =\u003e {\n      await page.goto('/recordings/batch-upload/');\n      \n      // Similar to single upload but with multiple files\n    });\n    \n    test('upload validates file type', async ({ page }) =\u003e {\n      await page.goto('/recordings/upload/');\n      \n      // Try uploading non-audio file\n      const fileInput = page.locator('input[type=\"file\"]');\n      await fileInput.setInputFiles(path.join(__dirname, '../fixtures/users.json'));\n      \n      await expect(page.locator('.error, .invalid-feedback')).toBeVisible();\n    });\n  });\n  \n  test.describe('Recording List', () =\u003e {\n    test('displays recordings in table', async ({ page }) =\u003e {\n      await page.goto('/recordings/');\n      \n      await expect(page.locator('table, .recording-list')).toBeVisible();\n      await expect(page.locator('tr, .recording-item').first()).toBeVisible();\n    });\n    \n    test('filter by project', async ({ page }) =\u003e {\n      await page.goto('/recordings/');\n      \n      await page.selectOption('select[name=\"project\"]', { label: 'E2E Test Project' });\n      await page.click('button:has-text(\"Filter\")');\n      \n      // Verify filtered results\n    });\n    \n    test('search recordings', async ({ page }) =\u003e {\n      await page.goto('/recordings/');\n      \n      await page.fill('input[name=\"search\"]', 'test');\n      await page.click('button:has-text(\"Search\")');\n      \n      // Verify search results\n    });\n  });\n  \n  test.describe('Recording Detail', () =\u003e {\n    test('displays waveform player', async ({ page }) =\u003e {\n      await page.goto('/recordings/');\n      await page.click('.recording-link:first-child, tr:first-child a');\n      \n      // Wait for player to load\n      await expect(page.locator('#waveform-container, .waveform-player')).toBeVisible();\n    });\n    \n    test('play/pause controls work', async ({ page }) =\u003e {\n      await page.goto('/recordings/1/');  // Assuming recording ID 1 exists\n      \n      // Click play\n      await page.click('#play-btn, .play-button');\n      \n      // Verify playing state\n      await expect(page.locator('.playing, [data-playing=\"true\"]')).toBeVisible();\n      \n      // Click pause\n      await page.click('#pause-btn, .pause-button');\n    });\n    \n    test('zoom controls work', async ({ page }) =\u003e {\n      await page.goto('/recordings/1/');\n      \n      // Click zoom in\n      await page.click('#zoom-in, .zoom-in-btn');\n      \n      // Verify zoom changed (check canvas width or similar)\n    });\n  });\n});\n```\n\n## Files Created\n- tests/e2e/specs/recordings.spec.js\n- tests/e2e/fixtures/test-audio.wav (small test WAV file)\n\n## Verification\n- All recording tests pass\n- Upload actually creates recording in DB\n- Player renders correctly","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:11:00.798820757Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:11:00.798820757Z","dependencies":[{"issue_id":"battycoda-jwt","depends_on_id":"battycoda-hxh","type":"blocks","created_at":"2026-01-13T23:20:18.095931983Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-kmg","title":"Decide: Standardize on Bootstrap 4 or upgrade to 5","description":"## Decision Needed\nCodebase currently uses Bootstrap 4.3.1 but some templates have Bootstrap 5 classes mixed in.\n\n## Current State\n- base.html loads Bootstrap 4.3.1 CSS and JS\n- Some templates use BS4 classes: float-right, mr-2, ml-2, badge-success\n- Some templates use BS5 classes: float-end, me-2, ms-2 (these don't work\\!)\n\n## Options\n\n### Option A: Stay on Bootstrap 4\nPros:\n- No migration effort\n- Just fix the BS5 classes to BS4 equivalents\n- Maisonnette theme is built for BS4\n\nCons:\n- BS4 is older, fewer updates\n- Missing some BS5 features\n\n### Option B: Upgrade to Bootstrap 5\nPros:\n- Modern, actively maintained\n- Better utilities\n- Dropped jQuery dependency (though we still use jQuery)\n\nCons:\n- Significant migration effort\n- Maisonnette theme may need updates\n- Many class name changes (mr→me, ml→ms, etc.)\n- May break existing styling\n\n## Recommendation\n**Stay on Bootstrap 4 (Option A)** - The migration effort isn't worth it. Just fix the incorrectly used BS5 classes.\n\n## Class Mapping (if staying BS4)\n| Wrong (BS5) | Correct (BS4) |\n|-------------|---------------|\n| float-end | float-right |\n| float-start | float-left |\n| me-2 | mr-2 |\n| ms-2 | ml-2 |\n| mb-0 | mb-0 (same) |\n\n## Impacts\n- All templates with mixed classes\n- Phase 2 CSS consolidation\n- Future UI development","status":"closed","priority":0,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T22:46:52.614246299Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:20:38.516910763Z","closed_at":"2026-01-13T23:20:38.516910763Z","close_reason":"Standardized on Bootstrap 4: converted float-end→float-right, me-*→mr-*, ms-*→ml-*, text-end→text-right, text-start→text-left, border-start→border-left, ps-*→pl-*, visually-hidden→sr-only across 46 files"}
{"id":"battycoda-lmk","title":"Write E2E tests for authentication flows","description":"## Task\nWrite Playwright E2E tests for authentication flows.\n\n## Test Cases\n\n### tests/e2e/specs/auth.spec.js\n```javascript\nimport { test, expect } from '@playwright/test';\nimport { login } from '../helpers/auth.js';\nimport users from '../fixtures/users.json';\n\ntest.describe('Authentication', () =\u003e {\n  test.describe('Login', () =\u003e {\n    test('successful login redirects to home', async ({ page }) =\u003e {\n      await page.goto('/accounts/login/');\n      await page.fill('input[name=\"email\"]', users.testUser.email);\n      await page.fill('input[name=\"password\"]', users.testUser.password);\n      await page.click('button[type=\"submit\"]');\n      \n      await expect(page).toHaveURL('/');\n      await expect(page.locator('.navbar')).toContainText(users.testUser.username);\n    });\n    \n    test('invalid credentials shows error', async ({ page }) =\u003e {\n      await page.goto('/accounts/login/');\n      await page.fill('input[name=\"email\"]', 'wrong@email.com');\n      await page.fill('input[name=\"password\"]', 'wrongpassword');\n      await page.click('button[type=\"submit\"]');\n      \n      await expect(page.locator('.alert-danger, .error')).toBeVisible();\n      await expect(page).toHaveURL(/login/);\n    });\n    \n    test('login with email code', async ({ page }) =\u003e {\n      // Test passwordless login flow\n      await page.goto('/accounts/login/');\n      await page.click('text=Login with email');\n      await page.fill('input[name=\"email\"]', users.testUser.email);\n      await page.click('button[type=\"submit\"]');\n      \n      await expect(page.locator('.alert-success, .message')).toContainText('code sent');\n    });\n  });\n  \n  test.describe('Registration', () =\u003e {\n    test('new user registration flow', async ({ page }) =\u003e {\n      const uniqueEmail = `test-${Date.now()}@example.com`;\n      \n      await page.goto('/accounts/register/');\n      await page.fill('input[name=\"username\"]', 'newuser' + Date.now());\n      await page.fill('input[name=\"email\"]', uniqueEmail);\n      await page.fill('input[name=\"password1\"]', 'SecurePass123!');\n      await page.fill('input[name=\"password2\"]', 'SecurePass123!');\n      await page.click('button[type=\"submit\"]');\n      \n      // Should redirect to login or verification page\n      await expect(page).toHaveURL(/login|verify/);\n    });\n    \n    test('registration validates password requirements', async ({ page }) =\u003e {\n      await page.goto('/accounts/register/');\n      await page.fill('input[name=\"password1\"]', '123');  // Too short\n      await page.fill('input[name=\"password2\"]', '123');\n      await page.click('button[type=\"submit\"]');\n      \n      await expect(page.locator('.error, .invalid-feedback')).toBeVisible();\n    });\n  });\n  \n  test.describe('Logout', () =\u003e {\n    test('logout clears session', async ({ page }) =\u003e {\n      await login(page, users.testUser.email, users.testUser.password);\n      \n      await page.click('text=Logout');\n      \n      await expect(page).toHaveURL(/login/);\n      // Verify navbar shows login button, not username\n      await expect(page.locator('text=Login')).toBeVisible();\n    });\n  });\n  \n  test.describe('Protected routes', () =\u003e {\n    test('unauthenticated user redirected to login', async ({ page }) =\u003e {\n      await page.goto('/recordings/');\n      \n      await expect(page).toHaveURL(/login/);\n    });\n  });\n});\n```\n\n## Files Created\n- tests/e2e/specs/auth.spec.js\n- tests/e2e/helpers/auth.js (updated)\n\n## Verification\n- All auth tests pass\n- Tests work in all three browsers\n- Screenshots captured on failure","status":"open","priority":2,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:10:58.513208044Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:10:58.513208044Z","dependencies":[{"issue_id":"battycoda-lmk","depends_on_id":"battycoda-hxh","type":"blocks","created_at":"2026-01-13T23:20:17.983965839Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-lpe","title":"Create main.js entry point and module structure","description":"## Task\nCreate the main JavaScript entry point that imports and initializes all modules.\n\n## Steps\n\n### 1. Create static/js/main.js entry point\n```javascript\n/**\n * BattyCoda Main Entry Point\n * \n * This file is the main entry point for Vite bundling.\n * It imports and initializes all JavaScript modules.\n */\n\n// Core utilities\nimport './datetime_formatter.js';\nimport './theme-switcher.js';\n\n// Feature modules (conditionally loaded based on page)\n// These will be dynamically imported where needed\n```\n\n### 2. Create module index files for each feature area\nCreate index.js files that re-export module contents:\n- static/js/player/index.js (already exists, verify)\n- static/js/cluster_explorer/index.js\n- static/js/cluster_mapping/index.js\n- static/js/file_upload/index.js\n- static/js/segmentation/index.js\n\n### 3. Update vite.config.js with all entry points\n```javascript\nrollupOptions: {\n  input: {\n    main: resolve(__dirname, 'static/js/main.js'),\n    player: resolve(__dirname, 'static/js/player/index.js'),\n    clusterExplorer: resolve(__dirname, 'static/js/cluster_explorer/index.js'),\n    clusterMapping: resolve(__dirname, 'static/js/cluster_mapping/index.js'),\n    fileUpload: resolve(__dirname, 'static/js/file_upload/index.js'),\n    segmentation: resolve(__dirname, 'static/js/segmentation/index.js'),\n  }\n}\n```\n\n### 4. Document module structure in code comments\nEach index.js should have a header comment explaining what the module provides.\n\n## Files Created/Modified\n- static/js/main.js (new)\n- static/js/cluster_explorer/index.js (new)\n- static/js/cluster_mapping/index.js (already exists, verify exports)\n- static/js/file_upload/index.js (new)\n- static/js/segmentation/index.js (verify)\n- vite.config.js (updated)\n\n## Verification\n- `npm run build` produces separate chunks for each entry point\n- No duplicate code between chunks (proper code splitting)\n- Build output size is reasonable","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:04:36.694183008Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:04:36.694183008Z","dependencies":[{"issue_id":"battycoda-lpe","depends_on_id":"battycoda-3vv","type":"blocks","created_at":"2026-01-13T23:20:12.873764556Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-nfp","title":"Phase 4: Performance","description":"## Scope\nPerformance optimizations for clustering system.\n\n## Tasks (from CLUSTERING_VISUALIZATION_OVERHAUL.md)\n\n### 1. Fix N+1 Query in export_clusters\nLocation: mappings.py:46-58\nProblem:\n```python\nfor sc in segment_clusters:\n    segment = sc.segment  # Query\n    recording = segment.segmentation.recording  # Query\n```\nFix: Use select_related properly\n\n### 2. Streaming CSV exports\nLocation: mappings.py:14-62\nProblem: Large exports build entire CSV in memory\nFix: Use StreamingHttpResponse with generator\n\n### 3. Add pagination\nAffected areas:\n- Dashboard (all runs shown)\n- Cluster members list\n- Segment lists\n\n## Estimated Effort\n4-8 hours","status":"open","priority":3,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T22:23:32.098076139Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:23:32.098076139Z"}
{"id":"battycoda-pwr","title":"Phase 2: Vitest Unit Testing Setup","description":"## Overview\nSet up Vitest for unit testing JavaScript modules. Vitest integrates natively with Vite and provides fast, modern testing.\n\n## Goals\n- Unit test coverage for core JS logic\n- Fast test execution (watch mode)\n- Coverage reporting\n- CI integration\n\n## What to Test\n- Pure functions (data transformations, calculations)\n- State management logic\n- API response parsing\n- Utility functions\n- Event handlers (in isolation)\n\n## What NOT to Test with Vitest\n- DOM manipulation (use Playwright)\n- Full user flows (use Playwright)\n- Django template integration (use Playwright)\n\n## Success Criteria\n- `npm test` runs all unit tests\n- `npm run test:coverage` generates coverage report\n- Tests run in CI pipeline\n- \u003e80% coverage on utility modules","status":"open","priority":1,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T23:08:25.942118708Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:08:25.942118708Z"}
{"id":"battycoda-qky","title":"Phase 2: Architecture Refactor","description":"## Scope\nRefactor clustering JS/CSS architecture for maintainability.\n\n## Tasks (from CLUSTERING_VISUALIZATION_OVERHAUL.md)\n1. Consolidate 3 JS loading patterns into single IIFE pattern\n2. Create centralized ClusteringApp state management object\n3. Extract permission checks to decorator/mixin in views_clustering/\n4. Consolidate duplicate CSS (cluster_explorer.css + mapping_interface.css → clustering.css)\n\n## Details\n\n### JS Loading Patterns to Consolidate\n- cluster_explorer.js: Custom dynamic script loader\n- cluster_mapping.js: ES6 imports (broken)\n- mapping_interface.js: setTimeout + script injection\n\n### State Variables to Centralize\n- selectedClusterId (in 3+ files)\n- clusters array\n- clusteringRunId\n\n### Permission Check Pattern (repeated 12+ times)\n```python\nif not request.user.is_staff:\n    if clustering_run.group and clustering_run.group != request.user.profile.group:\n        return JsonResponse({'status': 'error', ...})\n```\n\n## Estimated Effort\n8-16 hours","status":"open","priority":2,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T22:14:59.290027423Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:14:59.290027423Z"}
{"id":"battycoda-yf0","title":"Clustering Visualization Overhaul","description":"## Overview\nComplete overhaul of the clustering visualization system. The current implementation has multiple critical bugs that prevent basic functionality from working.\n\nSee CLUSTERING_VISUALIZATION_OVERHAUL.md for the full analysis including:\n- Red team review findings\n- Architecture issues  \n- Quality improvements needed\n- Accessibility gaps\n\n## Critical Path (Priority Order)\n1. yf0.1 - Fix base.html extra_js placement (affects ALL clustering pages)\n2. yf0.2 - Fix create_run.html script block (can't create new runs)\n3. yf0.3 - Fix ES6 modules (mapping interface completely broken)\n4. yf0.4 - Fix delete URL mismatch (depends on yf0.3)\n5. yf0.5 - Remove duplicate handlers (causes double API calls)\n\n## Testing Checklist\nAfter all fixes:\n- [ ] /clustering/ dashboard loads, auto-refresh works\n- [ ] /clustering/create/ form is interactive\n- [ ] /clustering/run/\u003cid\u003e/ progress updates\n- [ ] /clustering/explorer/\u003cid\u003e/ visualization renders\n- [ ] /clustering/mapping/\u003cid\u003e/ drag-drop works, delete works\n\n## Future Work (not in this epic)\n- Consolidate JS to single loading pattern\n- Add proper error handling\n- Fix Bootstrap 4/5 class inconsistencies\n- Add keyboard navigation\n- Accessibility improvements","status":"open","priority":1,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T21:48:05.19951375Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:03:06.936402762Z"}
{"id":"battycoda-yf0.1","title":"Fix base.html: Move extra_js block after jQuery","description":"## Problem\nIn templates/base.html, the {% block extra_js %} is at line 211, but jQuery loads at line 214.\nAny template with inline $(document).ready() in extra_js fails with 'ReferenceError: $ is not defined'.\n\n## Affected Templates\n- clustering/dashboard.html - auto-refresh broken\n- clustering/run_detail.html - progress polling broken\n\n## Fix\nMove line 211 (`{% block extra_js %}{% endblock %}`) to AFTER line 227 (after all core scripts including jQuery, Bootstrap, app.js, etc.)\n\n## Verification\n1. After fix, visit /clustering/ and check browser console for JS errors\n2. Create a clustering run and verify progress auto-refresh works","status":"open","priority":0,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T21:48:52.207508074Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:01:52.327047038Z","dependencies":[{"issue_id":"battycoda-yf0.1","depends_on_id":"battycoda-yf0","type":"parent-child","created_at":"2026-01-13T21:48:52.210986439Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-yf0.2","title":"Fix create_run.html: Move script inside template block","description":"## Problem\nIn templates/clustering/create_run.html, lines 244-374 contain a \u003cscript\u003e block that is placed AFTER {% endblock %} (line 242).\n\nDjango template inheritance ignores content outside blocks, so this 130-line script is NEVER rendered.\n\n## Impact\nAll interactivity on the create clustering run page is broken:\n- Scope toggle (single recording vs project)\n- Project/species selection AJAX\n- Algorithm type detection (manual vs auto)\n- Form validation\n\n## Fix\n1. Add {% block extra_js %} before line 244\n2. Add {% endblock %} after line 374\n3. Or move the script inside the existing content block\n\n## Code Change\n```html\n\u003c!-- Line 242 currently --\u003e\n{% endblock %}\n\n\u003cscript\u003e  \u003c!-- THIS NEVER RENDERS --\u003e\n\n\u003c!-- Should be: --\u003e\n{% endblock %}\n\n{% block extra_js %}\n\u003cscript\u003e\n...\n\u003c/script\u003e\n{% endblock %}\n```\n\n## Verification\n1. Visit /clustering/create/\n2. Toggle between 'Single Recording' and 'Entire Project' - should animate\n3. Select a project - should fetch species via AJAX\n4. Select an algorithm - should show/hide cluster count field","status":"open","priority":0,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T21:48:52.292853184Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:02:05.491461424Z","dependencies":[{"issue_id":"battycoda-yf0.2","depends_on_id":"battycoda-yf0","type":"parent-child","created_at":"2026-01-13T21:48:52.295966283Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-yf0.3","title":"Fix ES6 module loading in cluster_mapping.js","description":"## Problem\nstatic/js/cluster_mapping.js uses ES6 import statements but is loaded as a regular script (not type='module').\n\nFiles using ES6 syntax:\n- static/js/cluster_mapping.js (line 7-10: import statements)\n- static/js/cluster_mapping/initialization.js (export statements)\n- static/js/cluster_mapping/drag_drop.js (export statements)\n- static/js/cluster_mapping/modal_handlers.js (export statements)\n- static/js/cluster_mapping/filtering.js (export statements)\n\n## Impact\nThe entire cluster mapping interface is broken. Browser throws SyntaxError on import statements.\n\n## Fix Options\n\n### Option A: Convert to IIFE pattern (Recommended - no build tools needed)\n1. Remove all import/export statements\n2. Wrap each module in an IIFE\n3. Attach functions to a global ClusterMapping namespace\n4. Load scripts in dependency order in the template\n\n### Option B: Add type='module' \n1. In mapping_interface.html, change script loading to use type='module'\n2. Ensure all import paths are correct (may need .js extensions)\n3. Note: This changes how scripts load and may have side effects\n\n## Files to Modify\n- static/js/cluster_mapping.js\n- static/js/cluster_mapping/initialization.js\n- static/js/cluster_mapping/drag_drop.js\n- static/js/cluster_mapping/modal_handlers.js\n- static/js/cluster_mapping/filtering.js\n- templates/clustering/mapping_interface.html (if using Option B)\n\n## Verification\n1. Visit /clustering/mapping/\u003crun_id\u003e/ for a completed clustering run\n2. Check browser console - should have no SyntaxError\n3. Drag a cluster to a call type - should create mapping\n4. Delete a mapping - should work (also tests yf0.4)","status":"open","priority":0,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T21:48:52.376442449Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:02:20.07540135Z","dependencies":[{"issue_id":"battycoda-yf0.3","depends_on_id":"battycoda-yf0","type":"parent-child","created_at":"2026-01-13T21:48:52.378633343Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-yf0.4","title":"Fix URL mismatch: delete-mapping endpoint","description":"## Problem\nURL mismatch between Python backend and JavaScript frontend for delete mapping endpoint.\n\nPython (clustering_urls.py line 23):\n  path('clustering/delete-mapping/', ...)\n\nJavaScript (static/js/cluster_mapping/drag_drop.js line 186):\n  url: '/clustering/delete-cluster-mapping/'\n\n## Impact\nDeleting cluster mappings fails with 404 error. Users cannot remove mappings once created.\n\n## Fix\nChange drag_drop.js line 186 from:\n  url: '/clustering/delete-cluster-mapping/',\nto:\n  url: '/clustering/delete-mapping/',\n\n## Alternative Fix\nCould change Python URL instead, but JS fix is simpler and matches the naming pattern of other endpoints (create-mapping, update-mapping-confidence).\n\n## Related URLs (verified correct)\n- /clustering/create-mapping/ ✓\n- /clustering/update-mapping-confidence/ ✓\n- /clustering/delete-mapping/ ← JS needs to match this\n\n## Verification\n1. Go to mapping interface for a completed clustering run\n2. Create a test mapping (drag cluster to call type)\n3. Click the X button to delete the mapping\n4. Should succeed (check Network tab - should be 200, not 404)\n\n## Note\nThis fix depends on yf0.3 (ES6 modules) being fixed first, otherwise the JS won't even load.","status":"open","priority":0,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T21:48:52.453264548Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:02:32.5981316Z","dependencies":[{"issue_id":"battycoda-yf0.4","depends_on_id":"battycoda-yf0","type":"parent-child","created_at":"2026-01-13T21:48:52.455332083Z","created_by":"Kevin Boergens"},{"issue_id":"battycoda-yf0.4","depends_on_id":"battycoda-yf0.3","type":"blocks","created_at":"2026-01-13T22:03:14.404435334Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-yf0.5","title":"Remove duplicate event handlers","description":"## Problem\nEvent handlers are registered twice for the same elements, causing double API calls and potential race conditions.\n\n### Duplicate 1: #save-cluster-label click\n- static/js/cluster_explorer/visualization.js line 21\n- static/js/cluster_explorer/controls.js line 46\n\n### Duplicate 2: .view-segment-btn click  \n- static/js/cluster_explorer/visualization.js line 28\n- static/js/cluster_explorer/controls.js line 51\n\n## Impact\n- Clicking 'Save' on cluster label triggers two API calls\n- Clicking 'View' on segment triggers two modal loads\n- Race conditions may cause inconsistent UI state\n\n## Fix\nRemove the duplicate handlers from controls.js (lines 46-54), keeping them in visualization.js.\n\nOr alternatively, remove from visualization.js and keep in controls.js - just pick one location.\n\n## Code to Remove (controls.js lines 44-55)\n```javascript\n// DELETE THESE LINES:\n.ready(function() {\n    // Handle save button click\n    $('#save-cluster-label').click(function() {\n        saveClusterLabel();\n    });\n\n    // Handle segment view button click\n    $(document).on('click', '.view-segment-btn', function() {\n        const segmentId = $(this).data('segment-id');\n        loadSegmentDetails(segmentId);\n    });\n    // ... keep the rest (point-size, cluster-opacity handlers)\n});\n```\n\n## Verification\n1. Go to cluster explorer for a completed run\n2. Select a cluster, edit the label, click Save\n3. Check Network tab - should see only ONE POST request\n4. Click 'View' on a segment - should see only ONE GET request","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T21:48:52.533134397Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:02:51.382394165Z","dependencies":[{"issue_id":"battycoda-yf0.5","depends_on_id":"battycoda-yf0","type":"parent-child","created_at":"2026-01-13T21:48:52.535484439Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-yf0.6","title":"Verify loading spinner fix in visualization.js","description":"## Problem\nIn static/js/cluster_explorer/visualization.js, when clusters exist, the code only removed existing SVG elements but not the loading spinner div.\n\n## Partial Fix Applied\nChanged line ~50 from:\n  d3.select('#cluster-visualization svg').remove();\nto:\n  $('#cluster-visualization').empty();\n\n## Status\nPartial fix was applied but needs verification after yf0.1 (base.html fix) is done.\n\n## Location\n- static/js/cluster_explorer/visualization.js (around line 44-56)\n- templates/clustering/cluster_explorer.html (spinner HTML)\n\n## Verification\n1. Complete yf0.1 first (extra_js fix)\n2. Run collectstatic\n3. Visit /clustering/explorer/\u003crun_id\u003e/ for a completed run\n4. Verify visualization renders (no infinite spinner)\n5. Check browser console for errors","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T22:13:04.104183097Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:13:04.104183097Z","dependencies":[{"issue_id":"battycoda-yf0.6","depends_on_id":"battycoda-yf0","type":"parent-child","created_at":"2026-01-13T22:13:04.108574366Z","created_by":"Kevin Boergens"},{"issue_id":"battycoda-yf0.6","depends_on_id":"battycoda-yf0.1","type":"blocks","created_at":"2026-01-13T22:14:41.706480628Z","created_by":"Kevin Boergens"}]}
{"id":"battycoda-zic","title":"Phase 5: New Features","description":"## Scope\nFeature additions for clustering visualization.\n\n## Tasks (from CLUSTERING_VISUALIZATION_OVERHAUL.md)\n\n### 1. Keyboard navigation for cluster explorer\n- Arrow keys to navigate clusters\n- Enter to select\n- Escape to deselect\n- Tab navigation\n\n### 2. Zoom reset button\nLocation: Cluster explorer D3 visualization\nAdd button to reset zoom to default view\n\n### 3. Bulk operations for mapping\nCurrent: Must map clusters one-by-one\nAdd: Multi-select and bulk mapping\n\n### 4. Improved error handling\nCurrent: Generic 'Failed to...' messages\nAdd: Retry buttons, specific error messages\n\n### 5. Cluster comparison view (optional)\nSide-by-side comparison of two clusters\n\n## Estimated Effort\n16-24 hours","status":"open","priority":3,"issue_type":"epic","owner":"boergens@uic.edu","created_at":"2026-01-13T22:24:39.577207816Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T22:24:39.577207816Z"}
{"id":"battycoda-zj8","title":"Convert existing JS files to ES6 modules","description":"## Task\nConvert existing JavaScript files from IIFE/global pattern to ES6 modules.\n\n## Files to Convert\n\n### Already ES6 (verify and clean up)\n- static/js/player/*.js - Already uses import/export\n- static/js/cluster_mapping/*.js - Already uses import/export\n\n### Need Conversion\n1. **static/js/app.js**\n   - Large file with Maisonnette theme code\n   - Keep as global (loaded via CDN-style)\n   - Don't convert, just ensure compatibility\n\n2. **static/js/notifications.js**\n   - Convert to module\n   - Export initialization function\n   - Import in main.js or lazy-load\n\n3. **static/js/theme-switcher.js**\n   - Convert to module\n   - Export theme switching functions\n\n4. **static/js/datetime_formatter.js**\n   - Convert to module\n   - Export formatting functions\n\n5. **static/js/task_annotation.js**\n   - Convert to module\n   - Complex file, careful conversion needed\n\n6. **static/js/batch_review.js**\n   - Convert to module\n   - Export review functions\n\n7. **static/js/waveform_viewer.js**\n   - Convert to module\n   - May have dependencies on player\n\n8. **static/js/mapping_interface.js**\n   - Convert to module\n\n9. **static/js/upload_progress.js**\n   - Convert to module\n\n10. **static/js/taskbatch/name_validator.js**\n    - Convert to module\n\n11. **static/js/auth/register.js**\n    - Convert to module\n\n## Conversion Pattern\nBefore:\n```javascript\n// Global function\nfunction doSomething() { ... }\n$(document).ready(function() { ... });\n```\n\nAfter:\n```javascript\n// ES6 module\nexport function doSomething() { ... }\nexport function initialize() { ... }\n\n// Auto-init if loaded directly\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', initialize);\n} else {\n  initialize();\n}\n```\n\n## Verification\n- Each converted file can be imported without errors\n- Existing functionality unchanged\n- No global namespace pollution\n- `npm run build` succeeds","status":"open","priority":1,"issue_type":"task","owner":"boergens@uic.edu","created_at":"2026-01-13T23:05:13.936782113Z","created_by":"Kevin Boergens","updated_at":"2026-01-13T23:05:13.936782113Z","dependencies":[{"issue_id":"battycoda-zj8","depends_on_id":"battycoda-lpe","type":"blocks","created_at":"2026-01-13T23:20:13.070905488Z","created_by":"Kevin Boergens"}]}
